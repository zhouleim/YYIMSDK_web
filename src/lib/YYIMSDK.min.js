function BaseList(){this.list={},this.array=[]}function IMFile(e){this.build(e)}BaseList.prototype.set=function(e,t,n){if(e&&t){var r,i=this.get(e);return i&&(r=this.array.indexOf(i)),-1<r&&i?this.array.splice(r,1,t):this.array.push(t),this.list[e]=t,"function"==typeof n&&this.array.sort.call(this.array,n),t}},BaseList.prototype.get=function(e){if(e)return this.list[e]},BaseList.prototype.getAll=function(){return this.array},BaseList.prototype.getFirst=function(){return this.array.slice(0,1)[0]},BaseList.prototype.getLast=function(){return this.array.slice(-1)[0]},BaseList.prototype.getPrev=function(e){if(this.get(e)){var t=this.array.indexOf(this.get(e));if(0<t)return this.array[t-1]}},BaseList.prototype.getNext=function(e){if(this.get(e)){var t=this.array.indexOf(this.get(e));if(-1<t)return this.array[t+1]}},BaseList.prototype.remove=function(e){if(e){var t,n=this.get(e);return this.list[e]=null,delete this.list[e],n&&-1<(t=this.array.indexOf(n))?this.array.splice(t,1)[0]:[]}},BaseList.prototype.update=function(e,t){return this.set.apply(this,arguments)},BaseList.prototype.length=function(){return this.array.length},BaseList.prototype.clear=function(){for(var e in this.list)this.list.hasOwnProperty(e)&&(this.list[e]=null,delete this.list[e]);this.array.splice(0,this.array.length),this.array.length=0},BaseList.prototype.indexOf=function(){return this.array.indexOf.apply(this.array,arguments)},BaseList.prototype.includes=function(){return this.array.includes.apply(this.array,arguments)},BaseList.prototype.lastIndexOf=function(){return this.array.lastIndexOf.apply(this.array,arguments)},BaseList.prototype.sort=function(){return this.array.sort.apply(this.array,arguments)},BaseList.prototype.some=function(){return this.array.some.apply(this.array,arguments)},BaseList.prototype.every=function(){return this.array.every.apply(this.array,arguments)},BaseList.prototype.map=function(){return this.array.map.apply(this.array,arguments)},BaseList.prototype.filter=function(){return this.array.filter.apply(this.array,arguments)},BaseList.prototype.forEach=function(){return this.array.forEach.apply(this.array,arguments)},BaseList.prototype.keys=function(){if(Object.keys)return Object.keys(this.list);var e=[];for(var t in this.list)this.list.hasOwnProperty(t)&&e.push(t);return e},IMFile.prototype.build=function(e){if(e=e||{},this.path=e.path||this.path||"",this.name=e.name||this.name||"",this.size=e.size||this.size||0,this.from=0,e.location&&(this.location=e.location||this.location),e.id&&(this.id=e.id||this.id),this.fid=e.fid||0,0!==e.original&&1!==e.original||(this.original=e.original),this.name&&!this.type){this.name=this.name.trim();var t=/.+\.(\w+)$/.exec(this.name);t&&t[1]&&(this.type=t[1])}},Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var n,r,i=s,o=[];if(t=t||i.length,e)for(n=0;n<e;n++)o[n]=i[0|Math.random()*t];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(r=0|16*Math.random(),o[n]=i[19==n?3&r|8:r]);return o.join("")},Math.uuidFast=function(){for(var e,t=s,n=new Array(36),r=0,i=0;i<36;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,n[i]=t[19==i?3&e|8:e]);return n.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),Object.clone=function(e){if("object"!=typeof e)return e;var t={};for(var n in e.constructor==Array&&(t=[]),e)t[n]=e[n]?Object.clone(e[n]):null;return t},Array.prototype.every||(Array.prototype.every=function(e,t){"use strict";var n,r;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError;for(1<arguments.length&&(n=t),r=0;r<o;){var s;if(r in i)if(s=i[r],!e.call(n,s,r,i))return!1;r++}return!0}),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),n=t.length>>>0,r=2<=arguments.length?arguments[1]:void 0,i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(n=t),r=new Array(s),i=0;i<s;){var a,c;i in o&&(a=o[i],c=e.call(n,a,i,o),r[i]=c),i++}return r}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=2<=arguments.length?arguments[1]:void 0,o=0;o<n;o++)if(o in t){var s=t[o];e.call(i,s,o,t)&&r.push(s)}return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0===i)return-1;var o=+t||0;if(Math.abs(o)===1/0&&(o=0),i<=o)return-1;for(n=Math.max(0<=o?o:i-Math.abs(o),0);n<i;){if(n in r&&r[n]===e)return n;n++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(n=t),r=0;r<o;){var s;r in i&&(s=i[r],e.call(n,s,r,i)),r++}}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(null==this)throw new TypeError;var t,n,r=Object(this),i=r.length>>>0;if(0===i)return-1;for(t=i-1,1<arguments.length&&((t=Number(arguments[1]))!=t?t=0:0!=t&&t!=1/0&&t!=-1/0&&(t=(0<t||-1)*Math.floor(Math.abs(t)))),n=0<=t?Math.min(t,i-1):i-Math.abs(t);0<=n;n--)if(n in r&&r[n]===e)return n;return-1}),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.notEmpty=function(){return null!=this&&""!=this.trim()},String.prototype.isEmpty=function(){return!this.notEmpty()},String.prototype.endWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substring(this.length-e.length)==e},String.prototype.startWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substr(0,e.length)==e};var YYIMCommonUtil={isFunction:function(e){return"function"==typeof e},isStringAndNotEmpty:function(e){return"string"==typeof e&&e.notEmpty()},chatNumInString:function(e,t){if("string"==typeof e&&"string"==typeof t){var n=new RegExp("\\"+t,"gi"),r=e.match(n);if(r)return r.length}return 0},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)}},YYIMArrayUtil={contains:function(e,t){if("[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}return!1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},unique:function(e){e.sort();for(var t=[e[0]],n=1;n<e.length;n++)e[n]!==t[t.length-1]&&t.push(e[n]);return t},insert:function(e,t,n){e.splice(t,0,n)}},YYIMUtil={localstorage:function(){var t=!1,i=e();function e(){try{return t=!0,window.localStorage}catch(e){throw t=!1,new Error(e.message)}}function o(e){if(i)return i.getItem(e)}return{enable:t,getLocalStorage:e,setItem:function(e,t){i&&i.setItem(e,t)},getItem:o,removeItem:function(e){i&&i.removeItem(e)},clear:function(){i&&i.clear()},getSpace:function(e){var t;if(YYIMUtil.isWhateType(e,"Array"))for(var n in t={},e)o(e[n])&&(t[e[n]]=o(e[n]));var r={total:YYIMUtil.getSpace(i)};return t&&(r.expect=YYIMUtil.getSpace(t),t=null),r}}}(),getSpace:function(e){try{return{size:unescape(encodeURIComponent(JSON.stringify(e))).length,space:YYIMUtil.bytesToSize(unescape(encodeURIComponent(JSON.stringify(e))).length)}}catch(e){return{size:0,space:"0 B"}}},cookie:{get:function(e){if(e)for(var t=document.cookie.split(";"),n=t.length,r=0;r<n;r++){var i=t[r].split("=");if(i[0].replace(/(^\s+)|(\s+$)/g,"")==e)return unescape(i[1])}return null},set:function(e,t,n,r,i,o){if(e&&t){var s=encodeURIComponent(e)+"="+encodeURIComponent(t);if(n)s+=";expires="+new Date((new Date).getTime()+6e4*n).toGMTString();r&&(s+=";path="+r),i&&(s+=";domain="+i),o&&(s+=";secure"),document.cookie=s}},delete:function(e,t,n){if(e&&this.get(e)){var r=encodeURIComponent(e)+"=;expires=Fri, 02-Jan-1970 00:00:00 GMT";t&&(r+=";path="+t),n&&(r+=";domain="+n),document.cookie=r}}},array:{comparisonAsc:function(n){return function(e,t){return e[n]-t[n]}},comparisonDesc:function(n){return function(e,t){return t[n]-e[n]}}},isWhateType:function(e,t){return"Null"===t&&null===e||"Undefined"===t&&void 0===e||"Number"===t&&isFinite(e)||Object.prototype.toString.call(e).slice(8,-1)===t},dom:{convertToArray:function(t){var n=null;try{n=Array.prototype.slice.call(t,0)}catch(e){n=[];for(var r=0,i=t.length;r<i;r++)n.push(t[r])}return n}},bytesToSize:function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},extend:function(t,e,n){if("[object Object]"===Object.prototype.toString.call(t)){if("[object Array]"===Object.prototype.toString.call(e))for(var r=0,i=e.length;r<i;r++)arguments.callee(t,e[r],n);try{if(e)for(var r in e)!0!==n&&t[r]||(t[r]=e[r]);return t}catch(e){return t}}return t},html:{removeHtmlTab:function(e){return e.replace(/<[^<>]+?>/g,"")},htmlEscape:function(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})},escapeHtml:function(e){var n={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(e,t){return n[t]})},nbspSpace:function(e){var n={nbsp:" "};return e.replace(/&(nbsp);/gi,function(e,t){return n[t]})},spaceNbsp:function(e){return e.replace(/\s/gi,"&nbsp;")},returnBr:function(e){return e.replace(/\r?\n/g,"<br />")},trimBr:function(e){return e=(e=(e=e.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n")).replace(/^((\s|&nbsp;)*\r?\n)+/g,"")).replace(/((\s|&nbsp;)*\r?\n)+$/g,"")},mergeSpace:function(e){return e=e.replace(/(\s|&nbsp;)+/g," ")}},function:{bind:function(e,t){if("Function"==Object.prototype.toString.call(e).slice(8,-1))return function(){return e.apply(t,arguments)}},curry:function(t){if("Function"==Object.prototype.toString.call(t).slice(8,-1)){var n=Array.prototype.slice.call(arguments,1);return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,n.concat(e))}}}},transcoding:{base64ToDataUrl:function(e){return e&&!/data\:image\/png\;base64\,/.test(e)?"data:image/png;base64,"+e:e},dataUrlToBase64:function(e){return e&&e.replace(/data\:image\/png\;base64\,/g,""),e},base64ToBlob:function(e){if(e){var t=window.atob(e.split(",")[1]||e),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(var i in t)t.hasOwnProperty(i)&&(r[i]=t.charCodeAt(i));return new Blob([n],{type:"image/png"})}},base64ToFormData:function(e){if(e){var t=new FormData;return t.append("file",this.base64ToBlob(e)),t}}}},YYIMRegExp={mobile:/^1[3578][0-9]{9}$/,phone:/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/};!function(s,E){"use strict";function e(e,t,n){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(t===E)throw"invalid module definition, dependencies must be specified";if(n===E)throw"invalid module definition, definition function must be specified";!function(e,t){for(var n,r=[],i=0;i<e.length;++i){if(!(n=a[e[i]]||o(e[i])))throw"module definition dependecy not found: "+e[i];r.push(n)}t.apply(null,r)}(t,function(){a[e]=n.apply(null,arguments)})}function o(e){for(var t=s,n=e.split(/[.\/]/),r=0;r<n.length;++r){if(!t[n[r]])return;t=t[n[r]]}return t}var a={},t="moxie/core/utils/Basic",n="moxie/core/utils/Env",r="moxie/core/I18n",i="moxie/core/utils/Mime",c="moxie/core/utils/Dom",u="moxie/core/Exceptions",l="moxie/core/EventTarget",h="moxie/runtime/Runtime",d="moxie/runtime/RuntimeClient",p="moxie/file/FileInput",g="moxie/core/utils/Encode",f="moxie/file/Blob",m="moxie/file/File",_="moxie/file/FileDrop",C="moxie/file/FileReader",I="moxie/core/utils/Url",y="moxie/runtime/RuntimeTarget",S="moxie/file/FileReaderSync",T="moxie/xhr/FormData",v="moxie/xhr/XMLHttpRequest",Y="moxie/runtime/Transporter",b="moxie/image/Image",R="moxie/runtime/html5/Runtime",M="moxie/core/utils/Events",A="moxie/runtime/html5/file/FileReader",N="moxie/runtime/html5/utils/BinaryReader",D="moxie/runtime/html5/image/JPEGHeaders",O="moxie/runtime/html5/image/ExifParser",w="moxie/runtime/html5/image/JPEG",J="moxie/runtime/html5/image/PNG",U="moxie/runtime/html5/image/ImageInfo",P="moxie/runtime/html5/image/MegaPixel",x="moxie/runtime/html5/image/Image",L="moxie/runtime/flash/Runtime",k="moxie/runtime/flash/file/Blob",H="moxie/runtime/flash/file/FileReader",F="moxie/runtime/flash/file/FileReaderSync",B="moxie/runtime/flash/xhr/XMLHttpRequest",j="moxie/runtime/flash/runtime/Transporter",G="moxie/runtime/flash/image/Image",V="moxie/runtime/silverlight/Runtime",q="moxie/runtime/html4/Runtime";e(t,[],function(){var r,o=function(e){return void 0===e?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},i=function(n){return a(arguments,function(e,t){0<t&&a(e,function(e,t){void 0!==e&&(o(n[t])===o(e)&&~s(o(e),["array","object"])?i(n[t],e):n[t]=e)})}),n},a=function(e,t){var n,r,i;if(e)if("number"===o(e.length)){for(i=0,n=e.length;i<n;i++)if(!1===t(e[i],i))return}else if("object"===o(e))for(r in e)if(e.hasOwnProperty(r)&&!1===t(e[r],r))return},s=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n}return-1};return{guid:(r=0,function(e){var t,n=(new Date).getTime().toString(32);for(t=0;t<5;t++)n+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+n+(r++).toString(32)}),typeOf:o,extend:i,each:a,isEmptyObj:function(e){var t;if(!e||"object"!==o(e))return!0;for(t in e)return!1;return!0},inSeries:function(e,r){var i=e.length;"function"!==o(r)&&(r=function(){}),e&&e.length||r(),function t(n){"function"===o(e[n])&&e[n](function(e){++n<i&&!e?t(n):r(e)})}(0)},inParallel:function(e,r){var i=0,o=e.length,s=new Array(o);a(e,function(e,n){e(function(e){if(e)return r(e);var t=[].slice.call(arguments);t.shift(),s[n]=t,++i===o&&(s.unshift(null),r.apply(this,s))})})},inArray:s,arrayDiff:function(e,t){var n=[];for(var r in"array"!==o(e)&&(e=[e]),"array"!==o(t)&&(t=[t]),e)-1===s(e[r],t)&&n.push(e[r]);return!!n.length&&n},arrayIntersect:function(e,t){var n=[];return a(e,function(e){-1!==s(e,t)&&n.push(e)}),n.length?n:null},toArray:function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},trim:function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},sprintf:function(e){var t=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=t.shift();return"undefined"!==o(e)?e:""})},parseSizeStr:function(e){if("string"!=typeof e)return e;var t,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return t=(e=/^([0-9\.]+)([tmgk]?)$/.exec(e.toLowerCase().replace(/[^0-9\.tmkg]/g,"")))[2],e=+e[1],n.hasOwnProperty(t)&&(e*=n[t]),Math.floor(e)}}}),e(n,[t],function(n){var e,t,r,h,d,p,i,o,s,a,c,u,l=(d="function",p="object",s=function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},u={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[i="name",o="version"],[/\s(opr)\/([\w\.]+)/i],[[i,"Opera"],o],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[i,o],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[i,"IE"],o],[/(edge)\/((\d+)?[\w\.]+)/i],[i,o],[/(yabrowser)\/([\w\.]+)/i],[[i,"Yandex"],o],[/(comodo_dragon)\/([\w\.]+)/i],[[i,/_/g," "],o],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[i,o],[/(dolfin)\/([\w\.]+)/i],[[i,"Dolphin"],o],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[i,"Chrome"],o],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[o,[i,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[o,[i,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[o,[i,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[o,[i,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[o,i],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[i,[o,(a={rgx:function(){for(var e,t,n,r,i,o,s,a=0,c=arguments;a<c.length;a+=2){var u=c[a],l=c[a+1];if(void 0===e)for(r in e={},l)typeof(i=l[r])===p?e[i[0]]=h:e[i]=h;for(t=n=0;t<u.length;t++)if(o=u[t].exec(this.getUA())){for(r=0;r<l.length;r++)s=o[++n],typeof(i=l[r])===p&&0<i.length?2==i.length?typeof i[1]==d?e[i[0]]=i[1].call(this,s):e[i[0]]=i[1]:3==i.length?typeof i[1]!==d||i[1].exec&&i[1].test?e[i[0]]=s?s.replace(i[1],i[2]):h:e[i[0]]=s?i[1].call(this,s,i[2]):h:4==i.length&&(e[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):h):e[i]=s||h;break}if(o)break}return e},str:function(e,t){for(var n in t)if(typeof t[n]===p&&0<t[n].length){for(var r=0;r<t[n].length;r++)if(s(t[n][r],e))return"?"===n?h:n}else if(s(t[n],e))return"?"===n?h:n;return e}}).str,(c={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}}).browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[i,o],[/(navigator|netscape)\/([\w\.-]+)/i],[[i,"Netscape"],o],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[i,o]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[o,[i,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,o],[/rv\:([\w\.]+).*(gecko)/i],[o,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,o],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[o,a.str,c.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[o,a.str,c.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],o],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,o],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],o],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],o],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,o],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],o],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],o],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,o],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[i,"iOS"],[o,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[i,"Mac OS"],[o,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[i,o]]},function(e){var t=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return a.rgx.apply(this,u.browser)},this.getEngine=function(){return a.rgx.apply(this,u.engine)},this.getOS=function(){return a.rgx.apply(this,u.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return t},this.setUA=function(e){return t=e,this},this.setUA(t)}),g=(r={define_property:!1,create_canvas:(t=document.createElement("canvas"),!(!t.getContext||!t.getContext("2d"))),return_response_type:function(e){try{if(-1!==n.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var t=new XMLHttpRequest;if(t.open("get","/"),"responseType"in t)return t.responseType=e,t.responseType===e}}catch(e){}return!1},use_data_uri:(e=new Image,e.onload=function(){r.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1),use_data_uri_over32kb:function(){return r.use_data_uri&&("IE"!==m.browser||9<=m.version)},use_data_uri_of:function(e){return r.use_data_uri&&e<33e3||r.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}},function(e){var t=[].slice.call(arguments);return t.shift(),"function"===n.typeOf(r[e])?r[e].apply(this,t):!!r[e]}),f=(new l).getResult(),m={can:g,uaParser:l,browser:f.browser.name,version:f.browser.version,os:f.os.name,osVersion:f.os.version,verComp:function(e,t,n){var r,i=0,o=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},a=function(e){return(e=(e=(""+e).replace(/[_\-+]/g,".")).replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".")).length?e.split("."):[-8]},c=function(e){return e?isNaN(e)?s[e]||-7:parseInt(e,10):0};for(e=a(e),t=a(t),r=Math.max(e.length,t.length),i=0;i<r;i++)if(e[i]!=t[i]){if(e[i]=c(e[i]),t[i]=c(t[i]),e[i]<t[i]){o=-1;break}if(e[i]>t[i]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return 0<o;case">=":case"ge":return 0<=o;case"<=":case"le":return o<=0;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return o<0;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return m.OS=m.os,m}),e(r,[t],function(n){var t={};return{addI18n:function(e){return n.extend(t,e)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(e){var t=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=t.shift();return"undefined"!==n.typeOf(e)?e:""})}}}),e(i,[t,r],function(a,r){var e={mimes:{},extensions:{},addMimeType:function(e){var t,n,r,i=e.split(/,/);for(t=0;t<i.length;t+=2){for(r=i[t+1].split(/ /),n=0;n<r.length;n++)this.mimes[r[n]]=i[t];this.extensions[i[t]]=r}},extList2mimes:function(e,t){var n,r,i,o,s=[];for(r=0;r<e.length;r++)for(n=e[r].extensions.split(/\s*,\s*/),i=0;i<n.length;i++){if("*"===n[i])return[];if((o=this.mimes[n[i]])&&-1===a.inArray(o,s)&&s.push(o),t&&/^\w+$/.test(n[i]))s.push("."+n[i]);else if(!o)return[]}return s},mimes2exts:function(e){var r=this,i=[];return a.each(e,function(e){if("*"===e)return!(i=[]);var n=e.match(/^(\w+)\/(\*|\w+)$/);n&&("*"===n[2]?a.each(r.extensions,function(e,t){new RegExp("^"+n[1]+"/").test(t)&&[].push.apply(i,r.extensions[t])}):r.extensions[e]&&[].push.apply(i,r.extensions[e]))}),i},mimes2extList:function(e){var t=[],n=[];return"string"===a.typeOf(e)&&(e=a.trim(e).split(/\s*,\s*/)),n=this.mimes2exts(e),t.push({title:r.translate("Files"),extensions:n.length?n.join(","):"*"}),t.mimes=e,t},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return e.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),e}),e(c,[n],function(u){var n=function(e,t){return!!e.className&&new RegExp("(^|\\s+)"+t+"(\\s+|$)").test(e.className)};return{get:function(e){return"string"!=typeof e?e:document.getElementById(e)},hasClass:n,addClass:function(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t)},removeClass:function(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})}},getStyle:function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},getPos:function(e,t){function n(e){var t,n,r=0,i=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===c.compatMode?c.documentElement:c.body,r=n.left+t.scrollLeft,i=n.top+t.scrollTop),{x:r,y:i}}var r,i,o,s=0,a=0,c=document;if(e=e,t=t||c.body,e&&e.getBoundingClientRect&&"IE"===u.browser&&(!c.documentMode||c.documentMode<8))return i=n(e),o=n(t),{x:i.x-o.x,y:i.y-o.y};for(r=e;r&&r!=t&&r.nodeType;)s+=r.offsetLeft||0,a+=r.offsetTop||0,r=r.offsetParent;for(r=e.parentNode;r&&r!=t&&r.nodeType;)s-=r.scrollLeft||0,a-=r.scrollTop||0,r=r.parentNode;return{x:s,y:a}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}}}}),e(u,[t],function(n){function r(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function e(e){this.code=e,this.name=r(t,e),this.message=this.name+": RuntimeError "+this.code}var t={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return n.extend(e,t),e.prototype=Error.prototype,e}(),OperationNotAllowedException:function(){function e(e){this.code=e,this.name="OperationNotAllowedException"}return n.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function e(e){this.code=e,this.name=r(t,e),this.message=this.name+": ImageError "+this.code}var t={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return n.extend(e,t),e.prototype=Error.prototype,e}(),FileException:function(){function e(e){this.code=e,this.name=r(t,e),this.message=this.name+": FileException "+this.code}var t={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return n.extend(e,t),e.prototype=Error.prototype,e}(),DOMException:function(){function e(e){this.code=e,this.name=r(t,e),this.message=this.name+": DOMException "+this.code}var t={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return n.extend(e,t),e.prototype=Error.prototype,e}(),EventException:function(){function e(e){this.code=e,this.name="EventException"}return n.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}}),e(l,[n,u,t],function(e,l,h){function t(){var u={};h.extend(this,{uid:null,init:function(){this.uid||(this.uid=h.guid("uid_"))},addEventListener:function(e,t,n,r){var i,o=this;return this.hasOwnProperty("uid")||(this.uid=h.guid("uid_")),e=h.trim(e),/\s/.test(e)?void h.each(e.split(/\s+/),function(e){o.addEventListener(e,t,n,r)}):(e=e.toLowerCase(),n=parseInt(n,10)||0,(i=u[this.uid]&&u[this.uid][e]||[]).push({fn:t,priority:n,scope:r||this}),u[this.uid]||(u[this.uid]={}),void(u[this.uid][e]=i))},hasEventListener:function(e){var t=e?u[this.uid]&&u[this.uid][e]:u[this.uid];return t||!1},removeEventListener:function(e,t){e=e.toLowerCase();var n,r=u[this.uid]&&u[this.uid][e];if(r){if(t){for(n=r.length-1;0<=n;n--)if(r[n].fn===t){r.splice(n,1);break}}else r=[];r.length||(delete u[this.uid][e],h.isEmptyObj(u[this.uid])&&delete u[this.uid])}},removeAllEventListeners:function(){u[this.uid]&&delete u[this.uid]},dispatchEvent:function(e){var t,n,r,i,o,s={},a=!0;if("string"!==h.typeOf(e)){if(i=e,"string"!==h.typeOf(i.type))throw new l.EventException(l.EventException.UNSPECIFIED_EVENT_TYPE_ERR);e=i.type,void 0!==i.total&&void 0!==i.loaded&&(s.total=i.total,s.loaded=i.loaded),s.async=i.async||!1}if(-1!==e.indexOf("::")?(o=e.split("::"),t=o[0],e=o[1]):t=this.uid,e=e.toLowerCase(),n=u[t]&&u[t][e]){n.sort(function(e,t){return t.priority-e.priority}),(r=[].slice.call(arguments)).shift(),s.type=e,r.unshift(s);var c=[];h.each(n,function(t){r[0].target=t.scope,s.async?c.push(function(e){setTimeout(function(){e(!1===t.fn.apply(t.scope,r))},1)}):c.push(function(e){e(!1===t.fn.apply(t.scope,r))})}),c.length&&h.inSeries(c,function(e){a=!e})}return a},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(e){var t=this;this.bind(e.join(" "),function(e){var t="on"+e.type.toLowerCase();"function"===h.typeOf(this[t])&&this[t].apply(this,arguments)}),h.each(e,function(e){e="on"+e.toLowerCase(e),"undefined"===h.typeOf(t[e])&&(t[e]=null)})}})}return t.instance=new t,t}),e(h,[n,t,c,l],function(e,l,h,n){function d(e,t,i,n,r){var o,s,a=this,c=l.guid(t+"_"),u=r||"browser";e=e||{},p[c]=this,i=l.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},i),e.preferred_caps&&(u=d.getMode(n,e.preferred_caps,u)),s={},o={exec:function(e,t,n,r){return o[t]&&(s[e]||(s[e]={context:this,instance:new o[t]}),s[e].instance[n])?s[e].instance[n].apply(this,r):void 0},removeInstance:function(e){delete s[e]},removeAllInstances:function(){var n=this;l.each(s,function(e,t){"function"===l.typeOf(e.instance.destroy)&&e.instance.destroy.call(e.context),n.removeInstance(t)})}},l.extend(this,{initialized:!1,uid:c,type:t,mode:d.getMode(n,e.required_caps,u),shimid:c+"_container",clients:0,options:e,can:function(e,t){var n=arguments[2]||i;if("string"===l.typeOf(e)&&"undefined"===l.typeOf(t)&&(e=d.parseCaps(e)),"object"===l.typeOf(e)){for(var r in e)if(!this.can(r,e[r],n))return!1;return!0}return"function"===l.typeOf(n[e])?n[e].call(this,t):t===n[e]},getShimContainer:function(){var e,t=h.get(this.shimid);return t||(e=this.options.container?h.get(this.options.container):document.body,(t=document.createElement("div")).id=this.shimid,t.className="moxie-shim moxie-shim-"+this.type,l.extend(t.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.appendChild(t),e=null),t},getShim:function(){return o},shimExec:function(e,t){var n=[].slice.call(arguments,2);return a.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return a[e]&&a[e][t]?a[e][t].apply(this,n):a.shimExec.apply(this,arguments)},destroy:function(){if(a){var e=h.get(this.shimid);e&&e.parentNode.removeChild(e),o&&o.removeAllInstances(),this.unbindAll(),delete p[this.uid],this.uid=null,c=a=o=e=null}}}),this.mode&&e.required_caps&&!this.can(e.required_caps)&&(this.mode=!1)}var r={},p={};return d.order="html5,flash,silverlight,html4",d.getRuntime=function(e){return!!p[e]&&p[e]},d.addConstructor=function(e,t){t.prototype=n.instance,r[e]=t},d.getConstructor=function(e){return r[e]||null},d.getInfo=function(e){var t=d.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},d.parseCaps=function(e){var t={};return"string"!==l.typeOf(e)?e||{}:(l.each(e.split(","),function(e){t[e]=!0}),t)},d.can=function(e,t){var n,r,i=d.getConstructor(e);return!!i&&(r=(n=new i({required_caps:t})).mode,n.destroy(),!!r)},d.thatCan=function(e,t){var n=(t||d.order).split(/\s*,\s*/);for(var r in n)if(d.can(n[r],e))return n[r];return null},d.getMode=function(r,e,t){var i=null;if("undefined"===l.typeOf(t)&&(t="browser"),e&&!l.isEmptyObj(r)){if(l.each(e,function(e,t){if(r.hasOwnProperty(t)){var n=r[t](e);if("string"==typeof n&&(n=[n]),i){if(!(i=l.arrayIntersect(i,n)))return i=!1}else i=n}}),i)return-1!==l.inArray(t,i)?t:i[0];if(!1===i)return!1}return t},d.capTrue=function(){return!0},d.capFalse=function(){return!1},d.capTest=function(e){return function(){return!!e}},d}),e(d,[n,u,t,h],function(e,a,t,c){return function(){var s;t.extend(this,{connectRuntime:function(i){var e,o=this;if("string"===t.typeOf(i)?e=i:"string"===t.typeOf(i.ruid)&&(e=i.ruid),e){if(s=c.getRuntime(e))return s.clients++,s;throw new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR)}!function e(t){var n,r;return t.length?(n=t.shift().toLowerCase(),(r=c.getConstructor(n))?((s=new r(i)).bind("Init",function(){s.initialized=!0,setTimeout(function(){s.clients++,o.trigger("RuntimeInit",s)},1)}),s.bind("Error",function(){s.destroy(),e(t)}),s.mode?void s.init():void s.trigger("Error")):void e(t)):(o.trigger("RuntimeError",new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR)),void(s=null))}((i.runtime_order||c.order).split(/\s*,\s*/))},disconnectRuntime:function(){s&&--s.clients<=0&&s.destroy(),s=null},getRuntime:function(){return s&&s.uid?s:s=null},exec:function(){return s?s.exec.apply(this,arguments):null}})}}),e(p,[t,n,i,c,u,l,r,h,d],function(s,e,i,a,c,t,u,l,h){function n(o){var e,t,n,r=this;if(-1!==s.inArray(s.typeOf(o),["string","node"])&&(o={browse_button:o}),!(t=a.get(o.browse_button)))throw new c.DOMException(c.DOMException.NOT_FOUND_ERR);n={accept:[{title:u.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:t.parentNode||document.body},"string"==typeof(o=s.extend({},n,o)).required_caps&&(o.required_caps=l.parseCaps(o.required_caps)),"string"==typeof o.accept&&(o.accept=i.mimes2extList(o.accept)),(e=a.get(o.container))||(e=document.body),"static"===a.getStyle(e,"position")&&(e.style.position="relative"),e=t=null,h.call(r),s.extend(r,{uid:s.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){r.bind("RuntimeInit",function(e,i){r.ruid=i.uid,r.shimid=i.shimid,r.bind("Ready",function(){r.trigger("Refresh")},999),r.bind("Refresh",function(){var e,t,n,r;n=a.get(o.browse_button),r=a.get(i.shimid),n&&(e=a.getPos(n,a.get(o.container)),t=a.getSize(n),r&&s.extend(r.style,{top:e.y+"px",left:e.x+"px",width:t.w+"px",height:t.h+"px"})),r=n=null}),i.exec.call(r,"FileInput","init",o)}),r.connectRuntime(s.extend({},o,{required_caps:{select_file:!0}}))},disable:function(e){var t=this.getRuntime();t&&t.exec.call(this,"FileInput","disable","undefined"===s.typeOf(e)||e)},refresh:function(){r.trigger("Refresh")},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===s.typeOf(this.files)&&s.each(this.files,function(e){e.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(d)}var d=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return n.prototype=t.instance,n}),e(g,[],function(){var p=function(e){return unescape(encodeURIComponent(e))},g=function(e){return decodeURIComponent(escape(e))};return{utf8_encode:p,utf8_decode:g,atob:function(e,t){if("function"==typeof window.atob)return t?g(window.atob(e)):window.atob(e);var n,r,i,o,s,a,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,h=0,d=[];if(!e)return e;for(e+="";n=(a=u.indexOf(e.charAt(l++))<<18|u.indexOf(e.charAt(l++))<<12|(o=u.indexOf(e.charAt(l++)))<<6|(s=u.indexOf(e.charAt(l++))))>>16&255,r=a>>8&255,i=255&a,d[h++]=64==o?String.fromCharCode(n):64==s?String.fromCharCode(n,r):String.fromCharCode(n,r,i),l<e.length;);return c=d.join(""),t?g(c):c},btoa:function(e,t){if(t&&(e=p(e)),"function"==typeof window.btoa)return window.btoa(e);var n,r,i,o,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,l="",h=[];if(!e)return e;for(;n=(s=e.charCodeAt(c++)<<16|e.charCodeAt(c++)<<8|e.charCodeAt(c++))>>18&63,r=s>>12&63,i=s>>6&63,o=63&s,h[u++]=a.charAt(n)+a.charAt(r)+a.charAt(i)+a.charAt(o),c<e.length;);l=h.join("");var d=e.length%3;return(d?l.slice(0,d-3):l)+"===".slice(d||3)}}}),e(f,[t,g,d],function(s,n,r){var a={};return function o(e,t){r.call(this),e&&this.connectRuntime(e),t?"string"===s.typeOf(t)&&(t={data:t}):t={},s.extend(this,{uid:t.uid||s.guid("uid_"),ruid:e,size:t.size||0,type:t.type||"",slice:function(e,t,n){return this.isDetached()?function(e,t,n){var r,i=a[this.uid];return"string"===s.typeOf(i)&&i.length?((r=new o(null,{type:n,size:t-e})).detach(i.substr(e,r.size)),r):null}.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(e){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),"data:"==(e=e||"").substr(0,5)){var t=e.indexOf(";base64,");this.type=e.substring(5,t),e=n.atob(e.substring(t+8))}this.size=e.length,a[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===s.typeOf(a[this.uid])},destroy:function(){this.detach(),delete a[this.uid]}}),t.data?this.detach(t.data):a[this.uid]=t}}),e(m,[t,i,f],function(i,o,s){function e(e,t){var n;if(t||(t={}),s.apply(this,arguments),this.type||(this.type=o.getFileMime(t.name)),t.name)n=(n=t.name.replace(/\\/g,"/")).substr(n.lastIndexOf("/")+1);else if(this.type){var r=this.type.split("/")[0];n=i.guid((""!==r?r:"file")+"_"),o.extensions[this.type]&&(n+="."+o.extensions[this.type][0])}i.extend(this,{name:n||i.guid("file_"),relativePath:"",lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString()})}return e.prototype=s.prototype,e}),e(_,[r,c,u,t,n,m,d,l,i],function(t,i,e,o,n,r,s,a,c){function u(n){var e,r=this;"string"==typeof n&&(n={drop_zone:n}),e={accept:[{title:t.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},(n="object"==typeof n?o.extend({},e,n):e).container=i.get(n.drop_zone)||document.body,"static"===i.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=c.mimes2extList(n.accept)),s.call(r),o.extend(r,{uid:o.guid("uid_"),ruid:null,files:null,init:function(){r.bind("RuntimeInit",function(e,t){r.ruid=t.uid,t.exec.call(r,"FileDrop","init",n),r.dispatchEvent("ready")}),r.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(l)}var l=["ready","dragenter","dragleave","drop","error"];return u.prototype=a.instance,u}),e(C,[t,g,u,l,f,d],function(e,r,i,t,o,n){function s(){function t(e,t){if(this.trigger("loadstart"),this.readyState===s.LOADING)return this.trigger("error",new i.DOMException(i.DOMException.INVALID_STATE_ERR)),void this.trigger("loadend");if(!(t instanceof o))return this.trigger("error",new i.DOMException(i.DOMException.NOT_FOUND_ERR)),void this.trigger("loadend");if(this.result=null,this.readyState=s.LOADING,t.isDetached()){var n=t.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=n;break;case"readAsDataURL":this.result="data:"+t.type+";base64,"+r.btoa(n)}this.readyState=s.DONE,this.trigger("load"),this.trigger("loadend")}else this.connectRuntime(t.ruid),this.exec("FileReader","read",e,t)}n.call(this),e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){t.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){t.call(this,"readAsDataURL",e)},readAsText:function(e){t.call(this,"readAsText",e)},abort:function(){this.result=null,-1===e.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(a),this.bind("Error",function(e,t){this.readyState=s.DONE,this.error=t},999),this.bind("Load",function(e){this.readyState=s.DONE},999)}var a=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=t.instance,s}),e(I,[],function(){var a=function(e,t){for(var n=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=n.length,i={},o=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(e||"");r--;)o[r]&&(i[n[r]]=o[r]);if(!i.scheme){t&&"string"!=typeof t||(t=a(t||document.location.href)),i.scheme=t.scheme,i.host=t.host,i.port=t.port;var s="";/^[^\/]/.test(i.path)&&(s=t.path,s=/\/[^\/]*\.[^\/]*$/.test(s)?s.replace(/\/[^\/]+$/,"/"):s.replace(/\/?$/,"/")),i.path=s+(i.path||"")}return i.port||(i.port={http:80,https:443}[i.scheme]||80),i.port=parseInt(i.port,10),i.path||(i.path="/"),delete i.source,i};return{parseUrl:a,resolveUrl:function(e){var t="object"==typeof e?e:a(e);return t.scheme+"://"+t.host+(t.port!=={http:80,https:443}[t.scheme]?":"+t.port:"")+t.path+(t.query?t.query:"")},hasSameOrigin:function(e){function t(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof e&&(e=a(e)),t(a())===t(e)}}}),e(y,[t,d,l],function(e,t,n){function r(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return r.prototype=n.instance,r}),e(S,[t,d,g],function(e,n,a){return function(){function t(e,t){if(!t.isDetached()){var n=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),n}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+a.btoa(r);case"readAsText":for(var i="",o=0,s=r.length;o<s;o++)i+=String.fromCharCode(r[o]);return i}}n.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return t.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return t.call(this,"readAsDataURL",e)},readAsText:function(e){return t.call(this,"readAsText",e)}})}}),e(T,[u,t,f],function(e,s,a){return function(){var i,o=[];s.extend(this,{append:function(n,e){var r=this,t=s.typeOf(e);e instanceof a?i={name:n,value:e}:"array"===t?(n+="[]",s.each(e,function(e){r.append(n,e)})):"object"===t?s.each(e,function(e,t){r.append(n+"["+t+"]",e)}):"null"===t||"undefined"===t||"number"===t&&isNaN(e)?r.append(n,"false"):o.push({name:n,value:e.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return i&&i.value||null},getBlobName:function(){return i&&i.name||null},each:function(t){s.each(o,function(e){t(e.value,e.name)}),i&&t(i.value,i.name)},destroy:function(){i=null,o=[]}})}}),e(v,[t,u,l,g,I,h,y,f,S,T,n,i],function(T,v,e,Y,b,R,M,A,t,N,D,O){function w(){this.uid=T.guid("uid_")}function J(){function s(e,t){return i.hasOwnProperty(e)?1===arguments.length?D.can("define_property")?i[e]:r[e]:void(D.can("define_property")?i[e]=t:r[e]=t):void 0}var a,c,u,l,o,n,r=this,i={timeout:0,readyState:J.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},h=!0,d={},p=null,g=null,f=!1,m=!1,_=!1,C=!1,E=!1,I=!1,y={},S="";T.extend(this,i,{uid:T.guid("uid_"),upload:new w,open:function(e,t,n,r,i){var o;if(!e||!t)throw new v.DOMException(v.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(e)||Y.utf8_encode(e)!==e)throw new v.DOMException(v.DOMException.SYNTAX_ERR);if(~T.inArray(e.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(c=e.toUpperCase()),~T.inArray(c,["CONNECT","TRACE","TRACK"]))throw new v.DOMException(v.DOMException.SECURITY_ERR);if(t=Y.utf8_encode(t),o=b.parseUrl(t),I=b.hasSameOrigin(o),a=b.resolveUrl(t),(r||i)&&!I)throw new v.DOMException(v.DOMException.INVALID_ACCESS_ERR);if(u=r||o.user,l=i||o.pass,!1===(h=n||!0)&&(s("timeout")||s("withCredentials")||""!==s("responseType")))throw new v.DOMException(v.DOMException.INVALID_ACCESS_ERR);f=!h,m=!1,d={},function(){s("responseText",""),s("responseXML",null),s("response",null),s("status",0),s("statusText",""),null}.call(this),s("readyState",J.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(e,t){if(s("readyState")!==J.OPENED||m)throw new v.DOMException(v.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(e)||Y.utf8_encode(e)!==e)throw new v.DOMException(v.DOMException.SYNTAX_ERR);return e=T.trim(e).toLowerCase(),!~T.inArray(e,["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"])&&!/^(proxy\-|sec\-)/.test(e)&&(d[e]?d[e]+=", "+t:d[e]=t,!0)},getAllResponseHeaders:function(){return S||""},getResponseHeader:function(e){return e=e.toLowerCase(),E||~T.inArray(e,["set-cookie","set-cookie2"])?null:S&&""!==S&&(n||(n={},T.each(S.split(/\r\n/),function(e){var t=e.split(/:\s+/);2===t.length&&(t[0]=T.trim(t[0]),n[t[0].toLowerCase()]={header:t[0],value:T.trim(t[1])})})),n.hasOwnProperty(e))?n[e].header+": "+n[e].value:null},overrideMimeType:function(e){var t,n;if(~T.inArray(s("readyState"),[J.LOADING,J.DONE]))throw new v.DOMException(v.DOMException.INVALID_STATE_ERR);if(e=T.trim(e.toLowerCase()),/;/.test(e)&&(t=e.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(e=t[1],t[2]&&(n=t[2])),!O.mimes[e])throw new v.DOMException(v.DOMException.SYNTAX_ERR);e,n},send:function(e,t){if(y="string"===T.typeOf(t)?{ruid:t}:t||{},this.readyState!==J.OPENED||m)throw new v.DOMException(v.DOMException.INVALID_STATE_ERR);if(e instanceof A)y.ruid=e.ruid,g=e.type||"application/octet-stream";else if(e instanceof N){if(e.hasBlob()){var n=e.getBlob();y.ruid=n.ruid,g=n.type||"application/octet-stream"}}else"string"==typeof e&&(p="UTF-8",g="text/plain;charset=UTF-8",e=Y.utf8_encode(e));this.withCredentials||(this.withCredentials=y.required_caps&&y.required_caps.send_browser_cookies&&!I),_=!f&&this.upload.hasEventListener(),E=!1,C=!e,f||(m=!0),function(e){function n(){o&&(o.destroy(),o=null),i.dispatchEvent("loadend"),i=null}function r(t){o.bind("LoadStart",function(e){s("readyState",J.LOADING),i.dispatchEvent("readystatechange"),i.dispatchEvent(e),_&&i.upload.dispatchEvent(e)}),o.bind("Progress",function(e){s("readyState")!==J.LOADING&&(s("readyState",J.LOADING),i.dispatchEvent("readystatechange")),i.dispatchEvent(e)}),o.bind("UploadProgress",function(e){_&&i.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),o.bind("Load",function(e){s("readyState",J.DONE),s("status",Number(t.exec.call(o,"XMLHttpRequest","getStatus")||0)),s("statusText",U[s("status")]||""),s("response",t.exec.call(o,"XMLHttpRequest","getResponse",s("responseType"))),~T.inArray(s("responseType"),["text",""])?s("responseText",s("response")):"document"===s("responseType")&&s("responseXML",s("response")),S=t.exec.call(o,"XMLHttpRequest","getAllResponseHeaders"),i.dispatchEvent("readystatechange"),0<s("status")?(_&&i.upload.dispatchEvent(e),i.dispatchEvent(e)):(E=!0,i.dispatchEvent("error")),n()}),o.bind("Abort",function(e){i.dispatchEvent(e),n()}),o.bind("Error",function(e){E=!0,s("readyState",J.DONE),i.dispatchEvent("readystatechange"),C=!0,i.dispatchEvent(e),n()}),t.exec.call(o,"XMLHttpRequest","send",{url:a,method:c,async:h,user:u,password:l,headers:d,mimeType:g,encoding:p,responseType:i.responseType,withCredentials:i.withCredentials,options:y},e)}var i=this;(new Date).getTime(),o=new M,"string"==typeof y.required_caps&&(y.required_caps=R.parseCaps(y.required_caps)),y.required_caps=T.extend({},y.required_caps,{return_response_type:i.responseType}),e instanceof N&&(y.required_caps.send_multipart=!0),T.isEmptyObj(d)||(y.required_caps.send_custom_headers=!0),I||(y.required_caps.do_cors=!0),y.ruid?r(o.connectRuntime(y)):(o.bind("RuntimeInit",function(e,t){r(t)}),o.bind("RuntimeError",function(e,t){i.dispatchEvent("RuntimeError",t)}),o.connectRuntime(y))}.call(this,e)},abort:function(){if(f=!(E=!0),~T.inArray(s("readyState"),[J.UNSENT,J.OPENED,J.DONE]))s("readyState",J.UNSENT);else{if(s("readyState",J.DONE),m=!1,!o)throw new v.DOMException(v.DOMException.INVALID_STATE_ERR);o.getRuntime().exec.call(o,"XMLHttpRequest","abort",C),C=!0}},destroy:function(){o&&("function"===T.typeOf(o.destroy)&&o.destroy(),o=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(P.concat(["readystatechange"])),this.upload.handleEventProps(P)}var U={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};w.prototype=e.instance;var P=["loadstart","progress","abort","error","load","timeout","loadend"];return J.UNSENT=0,J.OPENED=1,J.HEADERS_RECEIVED=2,J.LOADING=3,J.DONE=4,J.prototype=e.instance,J}),e(Y,[t,g,d,l],function(d,n,e,t){function p(){function o(){u=l=0,c=this.result=null}function s(e,t){var n=this;i=t,n.bind("TransportingProgress",function(e){(l=e.loaded)<u&&-1===d.inArray(n.state,[p.IDLE,p.DONE])&&r.call(n)},999),n.bind("TransportingComplete",function(){l=u,n.state=p.DONE,c=null,n.result=i.exec.call(n,"Transporter","getAsBlob",e||"")},999),n.state=p.BUSY,n.trigger("TransportingStarted"),r.call(n)}function r(){var e,t=u-l;t<h&&(h=t),e=n.btoa(c.substr(l,h)),i.exec.call(this,"Transporter","receive",e,u)}var a,i,c,u,l,h;e.call(this),d.extend(this,{uid:d.guid("uid_"),state:p.IDLE,result:null,transport:function(e,n,t){var r=this;if(t=d.extend({chunk_size:204798},t),(a=t.chunk_size%3)&&(t.chunk_size+=3-a),h=t.chunk_size,o.call(this),u=(c=e).length,"string"===d.typeOf(t)||t.ruid)s.call(r,n,this.connectRuntime(t));else{var i=function(e,t){r.unbind("RuntimeInit",i),s.call(r,n,t)};this.bind("RuntimeInit",i),this.connectRuntime(t)}},abort:function(){this.state=p.IDLE,i&&(i.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted")),o.call(this)},destroy:function(){this.unbindAll(),i=null,this.disconnectRuntime(),o.call(this)}})}return p.IDLE=0,p.BUSY=1,p.DONE=2,p.prototype=t.instance,p}),e(b,[t,c,u,S,v,h,d,Y,n,l,f,m,g],function(u,r,l,e,o,s,t,h,d,n,a,c,p){function g(){function n(e){var t=u.typeOf(e);try{if(e instanceof g){if(!e.size)throw new l.DOMException(l.DOMException.INVALID_STATE_ERR);(function(e,t){var n=this.connectRuntime(e.ruid);this.ruid=n.uid,n.exec.call(this,"Image","loadFromImage",e,"undefined"===u.typeOf(t)||t)}).apply(this,arguments)}else if(e instanceof a){if(!~u.inArray(e.type,["image/jpeg","image/png"]))throw new l.ImageError(l.ImageError.WRONG_FORMAT);i.apply(this,arguments)}else if(-1!==u.inArray(t,["blob","file"]))n.call(this,new c(null,e),arguments[1]);else if("string"===t)"data:"===e.substr(0,5)?n.call(this,new a(null,{data:e}),arguments[1]):function(e,t){var n,r=this;(n=new o).open("get",e),n.responseType="blob",n.onprogress=function(e){r.trigger(e)},n.onload=function(){i.call(r,n.response,!0)},n.onerror=function(e){r.trigger(e)},n.onloadend=function(){n.destroy()},n.bind("RuntimeError",function(e,t){r.trigger("RuntimeError",t)}),n.send(null,t)}.apply(this,arguments);else{if("node"!==t||"img"!==e.nodeName.toLowerCase())throw new l.DOMException(l.DOMException.TYPE_MISMATCH_ERR);n.call(this,e.src,arguments[1])}}catch(e){this.trigger("error",e.code)}}function i(t,e){function n(e){r.ruid=e.uid,e.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){n(t)}),e&&"string"==typeof e.required_caps&&(e.required_caps=s.parseCaps(e.required_caps)),this.connectRuntime(u.extend({required_caps:{access_image_binary:!0,resize_image:!0}},e))):n(this.connectRuntime(t.ruid))}t.call(this),u.extend(this,{uid:u.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){n.apply(this,arguments)},downsize:function(e){var t={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};e="object"==typeof e?u.extend(t,e):u.extend(t,{width:e,height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new l.DOMException(l.DOMException.INVALID_STATE_ERR);if(this.width>g.MAX_RESIZE_WIDTH||this.height>g.MAX_RESIZE_HEIGHT)throw new l.ImageError(l.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",e.width,e.height,e.crop,e.preserveHeaders)}catch(e){this.trigger("error",e.code)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!d.can("create_canvas"))throw new l.RuntimeError(l.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new l.DOMException(l.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",e||"image/jpeg",t||90)},getAsDataURL:function(e,t){if(!this.size)throw new l.DOMException(l.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",e||"image/jpeg",t||90)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return p.atob(n.substring(n.indexOf("base64,")+7))},embed:function(s,e){var a,c=this;e=u.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},e||{});try{if(!(s=r.get(s)))throw new l.DOMException(l.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new l.DOMException(l.DOMException.INVALID_STATE_ERR);this.width>g.MAX_RESIZE_WIDTH||this.height;var t=new g;return t.bind("Resize",function(){(function(e,t){var n=this;if(d.can("create_canvas")){var r=n.getAsCanvas();if(r)return s.appendChild(r),r=null,n.destroy(),void c.trigger("embedded")}var i=n.getAsDataURL(e,t);if(!i)throw new l.ImageError(l.ImageError.WRONG_FORMAT);if(d.can("use_data_uri_of",i.length))s.innerHTML='<img src="'+i+'" width="'+n.width+'" height="'+n.height+'" />',n.destroy(),c.trigger("embedded");else{var o=new h;o.bind("TransportingComplete",function(){a=c.connectRuntime(this.result.ruid),c.bind("Embedded",function(){u.extend(a.getShimContainer().style,{top:"0px",left:"0px",width:n.width+"px",height:n.height+"px"}),a=null},999),a.exec.call(c,"ImageView","display",this.result.uid,width,height),n.destroy()}),o.transport(p.atob(i.substring(i.indexOf("base64,")+7)),e,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:s})}}).call(this,e.type,e.quality)}),t.bind("Load",function(){t.downsize(e)}),this.meta.thumb&&this.meta.thumb.width>=e.width&&this.meta.thumb.height>=e.height?t.load(this.meta.thumb.data):t.clone(this,!1),t}catch(e){this.trigger("error",e.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}}),this.handleEventProps(f),this.bind("Load Resize",function(){(function(e){e||(e=this.exec("Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name)}).call(this)},999)}var f=["progress","load","error","resize","embedded"];return g.MAX_RESIZE_WIDTH=8192,g.MAX_RESIZE_HEIGHT=8192,g.prototype=n.instance,g}),e(R,[t,u,h,n],function(a,e,c,u){var l="html5",h={};return c.addConstructor(l,function(e){var t,n,r=this,i=c.capTest,o=c.capTrue,s=a.extend({access_binary:i(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return r.can("access_binary")&&!!h.Image},display_media:i(u.can("create_canvas")||u.can("use_data_uri_over32kb")),do_cors:i(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:i((t=document.createElement("div"),("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&("IE"!==u.browser||u.verComp(u.version,9,">")))),filter_by_extension:i("Chrome"===u.browser&&u.verComp(u.version,28,">=")||"IE"===u.browser&&u.verComp(u.version,10,">=")||"Safari"===u.browser&&u.verComp(u.version,7,">=")),return_response_headers:o,return_response_type:function(e){return!("json"!==e||!window.JSON)||u.can("return_response_type",e)},return_status_code:o,report_upload_progress:i(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return r.can("access_binary")&&u.can("create_canvas")},select_file:function(){return u.can("use_fileinput")&&window.File},select_folder:function(){return r.can("select_file")&&"Chrome"===u.browser&&u.verComp(u.version,21,">=")},select_multiple:function(){return r.can("select_file")&&!("Safari"===u.browser&&"Windows"===u.os)&&!("iOS"===u.os&&u.verComp(u.osVersion,"7.0.0",">")&&u.verComp(u.osVersion,"8.0.0","<"))},send_binary_string:i(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:i(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||r.can("send_binary_string")},slice_blob:i(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return r.can("slice_blob")&&r.can("send_multipart")},summon_file_dialog:function(){return r.can("select_file")&&("Firefox"===u.browser&&u.verComp(u.version,4,">=")||"Opera"===u.browser&&u.verComp(u.version,12,">=")||"IE"===u.browser&&u.verComp(u.version,10,">=")||!!~a.inArray(u.browser,["Chrome","Safari"]))},upload_filesize:o},arguments[2]);c.call(this,e,arguments[1]||l,s),a.extend(this,{init:function(){this.trigger("Init")},destroy:(n=this.destroy,function(){n.call(r),n=r=null})}),a.extend(this.getShim(),h)}),h}),e(M,[t],function(s){function a(){this.returnValue=!1}function c(){this.cancelBubble=!0}var u={},l="moxie_"+s.guid(),i=function(t,e,n){var r;if(e=e.toLowerCase(),t[l]&&u[t[l]]&&u[t[l]][e]){for(var i=(r=u[t[l]][e]).length-1;0<=i&&(r[i].orig!==n&&r[i].key!==n||(t.removeEventListener?t.removeEventListener(e,r[i].func,!1):t.detachEvent&&t.detachEvent("on"+e,r[i].func),r[i].orig=null,r[i].func=null,r.splice(i,1),void 0===n));i--);if(r.length||delete u[t[l]][e],s.isEmptyObj(u[t[l]])){delete u[t[l]];try{delete t[l]}catch(e){t[l]=void 0}}}};return{addEvent:function(e,t,n,r){var i,o;t=t.toLowerCase(),e.addEventListener?(i=n,e.addEventListener(t,i,!1)):e.attachEvent&&(i=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=a,e.stopPropagation=c,n(e)},e.attachEvent("on"+t,i)),e[l]||(e[l]=s.guid()),u.hasOwnProperty(e[l])||(u[e[l]]={}),(o=u[e[l]]).hasOwnProperty(t)||(o[t]=[]),o[t].push({func:i,orig:n,key:r})},removeEvent:i,removeAllEvents:function(n,r){n&&n[l]&&s.each(u[n[l]],function(e,t){i(n,t,r)})}}}),e("moxie/runtime/html5/file/FileInput",[R,m,t,c,M,i,n],function(e,l,h,d,p,g,f){return e.FileInput=function(){var u;h.extend(this,{init:function(e){var t,n,r,i,o,s,a=this,c=a.getRuntime();r=(u=e).accept.mimes||g.extList2mimes(u.accept,c.can("filter_by_extension")),(n=c.getShimContainer()).innerHTML='<input id="'+c.uid+'" type="file" style="font-size:999px;opacity:0;"'+(u.multiple&&c.can("select_multiple")?"multiple":"")+(u.directory&&c.can("select_folder")?"webkitdirectory directory":"")+(r?' accept="'+r.join(",")+'"':"")+" />",t=d.get(c.uid),h.extend(t.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),i=d.get(u.browse_button),c.can("summon_file_dialog")&&("static"===d.getStyle(i,"position")&&(i.style.position="relative"),o=parseInt(d.getStyle(i,"z-index"),10)||1,i.style.zIndex=o,n.style.zIndex=o-1,p.addEvent(i,"click",function(e){var t=d.get(c.uid);t&&!t.disabled&&t.click(),e.preventDefault()},a.uid)),s=c.can("summon_file_dialog")?i:n,p.addEvent(s,"mouseover",function(){a.trigger("mouseenter")},a.uid),p.addEvent(s,"mouseout",function(){a.trigger("mouseleave")},a.uid),p.addEvent(s,"mousedown",function(){a.trigger("mousedown")},a.uid),p.addEvent(d.get(u.container),"mouseup",function(){a.trigger("mouseup")},a.uid),t.onchange=function e(t){if(a.files=[],h.each(this.files,function(e){var t="";return!(!u.directory||"."!=e.name)||(e.webkitRelativePath&&(t="/"+e.webkitRelativePath.replace(/^\//,"")),(e=new l(c.uid,e)).relativePath=t,void a.files.push(e))}),"IE"!==f.browser&&"IEMobile"!==f.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=e}a.files.length&&a.trigger("change")},a.trigger({type:"ready",async:!0}),n=null},disable:function(e){var t,n=this.getRuntime();(t=d.get(n.uid))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),n=e.getShimContainer();p.removeAllEvents(n,this.uid),p.removeAllEvents(u&&d.get(u.container),this.uid),p.removeAllEvents(u&&d.get(u.browse_button),this.uid),n&&(n.innerHTML=""),t.removeInstance(this.uid),u=n=t=null}})}}),e("moxie/runtime/html5/file/Blob",[R,f],function(e,t){return e.Blob=function(){this.slice=function(){return new t(this.getRuntime().uid,function(t,n,r){var e;if(!window.File.prototype.slice)return(e=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?e.call(t,n,r):null;try{return t.slice(),t.slice(n,r)}catch(e){return t.slice(n,r-n)}}.apply(this,arguments))}}}),e("moxie/runtime/html5/file/FileDrop",[R,m,t,c,M,i],function(e,i,l,t,h,d){return e.FileDrop=function(){function o(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var t=l.toArray(e.dataTransfer.types||[]);return-1!==l.inArray("Files",t)||-1!==l.inArray("public.file-url",t)||-1!==l.inArray("application/x-moz-file",t)}function a(e,t){if(function(e){if(!u.length)return!0;var t=d.getFileExtension(e.name);return!t||-1!==l.inArray(t,u)}(e)){var n=new i(r,e);n.relativePath=t||"",s.push(n)}}function c(e,t){var n=[];l.each(e,function(s){n.push(function(e){var t,n,r,i,o;n=e,(t=s).isFile?t.file(function(e){a(e,t.fullPath),n()},function(){n()}):t.isDirectory?(r=n,i=[],o=t.createReader(),function t(n){o.readEntries(function(e){e.length?([].push.apply(i,e),t(n)):n()},n)}(function(){c(i,r)})):n()})}),l.inSeries(n,function(){t()})}var n,r,s=[],u=[];l.extend(this,{init:function(e){var t,i=this;n=e,r=i.ruid,u=function(e){for(var t=[],n=0;n<e.length;n++)[].push.apply(t,e[n].extensions.split(/\s*,\s*/));return-1===l.inArray("*",t)?t:[]}(n.accept),t=n.container,h.addEvent(t,"dragover",function(e){o(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="copy")},i.uid),h.addEvent(t,"drop",function(e){var t,n,r;o(e)&&(e.preventDefault(),s=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?(t=e.dataTransfer.items,n=function(){i.files=s,i.trigger("drop")},r=[],l.each(t,function(e){var t=e.webkitGetAsEntry();t&&(t.isFile?a(e.getAsFile(),t.fullPath):r.push(t))}),r.length?c(r,n):n()):(l.each(e.dataTransfer.files,function(e){a(e)}),i.files=s,i.trigger("drop")))},i.uid),h.addEvent(t,"dragenter",function(e){i.trigger("dragenter")},i.uid),h.addEvent(t,"dragleave",function(e){i.trigger("dragleave")},i.uid)},destroy:function(){h.removeAllEvents(n&&t.get(n.container),this.uid),r=s=u=n=null}})}}),e(A,[R,g,t],function(e,o,s){return e.FileReader=function(){var r,i=!1;s.extend(this,{read:function(e,t){var n=this;n.result="",(r=new window.FileReader).addEventListener("progress",function(e){n.trigger(e)}),r.addEventListener("load",function(e){var t;n.result=i?(t=r.result,o.atob(t.substring(t.indexOf("base64,")+7))):r.result,n.trigger(e)}),r.addEventListener("error",function(e){n.trigger(e,r.error)}),r.addEventListener("loadend",function(e){r=null,n.trigger(e)}),"function"===s.typeOf(r[e])?(i=!1,r[e](t.getSource())):"readAsBinaryString"===e&&(i=!0,r.readAsDataURL(t.getSource()))},abort:function(){r&&r.abort()},destroy:function(){r=null}})}}),e("moxie/runtime/html5/xhr/XMLHttpRequest",[R,t,i,I,m,f,T,u,n],function(e,l,h,d,p,g,f,m,_){return e.XMLHttpRequest=function(){var c,u,a=this;l.extend(this,{send:function(e,n){var r=this,t="Mozilla"===_.browser&&_.verComp(_.version,4,">=")&&_.verComp(_.version,7,"<"),i="Android Browser"===_.browser,o=!1;if(u=e.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),(c=!window.XMLHttpRequest||"IE"===_.browser&&_.verComp(_.version,8,"<")?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}():new window.XMLHttpRequest).open(e.method,e.url,e.async,e.user,e.password),n instanceof g)n.isDetached()&&(o=!0),n=n.getSource();else if(n instanceof f){if(n.hasBlob())if(n.getBlob().isDetached())n=function(e){var n="----moxieboundary"+(new Date).getTime(),r="\r\n",i="";if(!this.getRuntime().can("send_binary_string"))throw new m.RuntimeError(m.RuntimeError.NOT_SUPPORTED_ERR);return c.setRequestHeader("Content-Type","multipart/form-data; boundary="+n),e.each(function(e,t){i+=e instanceof g?"--"+n+r+'Content-Disposition: form-data; name="'+t+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+r+"Content-Type: "+(e.type||"application/octet-stream")+r+r+e.getSource()+r:"--"+n+r+'Content-Disposition: form-data; name="'+t+'"'+r+r+unescape(encodeURIComponent(e))+r}),i+="--"+n+"--"+r}.call(r,n),o=!0;else if((t||i)&&"blob"===l.typeOf(n.getBlob().getSource())&&window.FileReader)return void function(e,t){var n,r,i=this;n=t.getBlob().getSource(),(r=new window.FileReader).onload=function(){t.append(t.getBlobName(),new g(null,{type:n.type,data:r.result})),a.send.call(i,e,t)},r.readAsBinaryString(n)}.call(r,e,n);if(n instanceof f){var s=new window.FormData;n.each(function(e,t){e instanceof g?s.append(t,e.getSource()):s.append(t,e)}),n=s}}c.upload?(e.withCredentials&&(c.withCredentials=!0),c.addEventListener("load",function(e){r.trigger(e)}),c.addEventListener("error",function(e){r.trigger(e)}),c.addEventListener("progress",function(e){r.trigger(e)}),c.upload.addEventListener("progress",function(e){r.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):c.onreadystatechange=function(){switch(c.readyState){case 1:case 2:break;case 3:var t,n;try{d.hasSameOrigin(e.url)&&(t=c.getResponseHeader("Content-Length")||0),c.responseText&&(n=c.responseText.length)}catch(e){t=n=0}r.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:n});break;case 4:c.onreadystatechange=function(){},0===c.status?r.trigger("error"):r.trigger("load")}},l.isEmptyObj(e.headers)||l.each(e.headers,function(e,t){c.setRequestHeader(t,e)}),""!==e.responseType&&"responseType"in c&&("json"!==e.responseType||_.can("return_response_type","json")?c.responseType=e.responseType:c.responseType="text"),o?c.sendAsBinary?c.sendAsBinary(n):function(){for(var e=new Uint8Array(n.length),t=0;t<n.length;t++)e[t]=255&n.charCodeAt(t);c.send(e.buffer)}():c.send(n),r.trigger("loadstart")},getStatus:function(){try{if(c)return c.status}catch(e){}return 0},getResponse:function(e){var t,n,r,i=this.getRuntime();try{switch(e){case"blob":var o=new p(i.uid,c.response),s=c.getResponseHeader("Content-Disposition");if(s){var a=s.match(/filename=([\'\"'])([^\1]+)\1/);a&&(u=a[2])}return o.name=u,o.type||(o.type=h.getFileMime(u)),o;case"json":return _.can("return_response_type","json")?c.response:200===c.status&&window.JSON?JSON.parse(c.responseText):null;case"document":return n=(t=c).responseXML,r=t.responseText,"IE"===_.browser&&r&&n&&!n.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type"))&&((n=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,n.validateOnParse=!1,n.loadXML(r)),n&&("IE"===_.browser&&0!==n.parseError||!n.documentElement||"parsererror"===n.documentElement.tagName)?null:n;default:return""!==c.responseText?c.responseText:null}}catch(e){return null}},getAllResponseHeaders:function(){try{return c.getAllResponseHeaders()}catch(e){}return""},abort:function(){c&&c.abort()},destroy:function(){a=u=null}})}}),e(N,[t],function(t){function e(e){e instanceof ArrayBuffer?function(i){var o=new DataView(i);t.extend(this,{readByteAt:function(e){return o.getUint8(e)},writeByteAt:function(e,t){o.setUint8(e,t)},SEGMENT:function(e,t,n){switch(arguments.length){case 2:return i.slice(e,e+t);case 1:return i.slice(e);case 3:if(null===n&&(n=new ArrayBuffer),n instanceof ArrayBuffer){var r=new Uint8Array(this.length()-t+n.byteLength);0<e&&r.set(new Uint8Array(i.slice(0,e)),0),r.set(new Uint8Array(n),e),r.set(new Uint8Array(i.slice(e+t)),e+n.byteLength),this.clear(),i=r.buffer,o=new DataView(i);break}default:return i}},length:function(){return i?i.byteLength:0},clear:function(){o=i=null}})}.apply(this,arguments):function(r){function i(e,t,n){n=3===arguments.length?n:r.length-t-1,r=r.substr(0,t)+e+r.substr(n+t)}t.extend(this,{readByteAt:function(e){return r.charCodeAt(e)},writeByteAt:function(e,t){i(String.fromCharCode(t),e,1)},SEGMENT:function(e,t,n){switch(arguments.length){case 1:return r.substr(e);case 2:return r.substr(e,t);case 3:i(null!==n?n:"",e,t);break;default:return r}},length:function(){return r?r.length:0},clear:function(){r=null}})}.apply(this,arguments)}return t.extend(e.prototype,{littleEndian:!1,read:function(e,t){var n,r,i;if(e+t>this.length())throw new Error("You are trying to read outside the source boundaries.");for(r=this.littleEndian?0:-8*(t-1),n=i=0;i<t;i++)n|=this.readByteAt(e+i)<<Math.abs(r+8*i);return n},write:function(e,t,n){var r,i;if(e>this.length())throw new Error("You are trying to write outside the source boundaries.");for(r=this.littleEndian?0:-8*(n-1),i=0;i<n;i++)this.writeByteAt(e+i,t>>Math.abs(r+8*i)&255)},BYTE:function(e){return this.read(e,1)},SHORT:function(e){return this.read(e,2)},LONG:function(e){return this.read(e,4)},SLONG:function(e){var t=this.read(e,4);return 2147483647<t?t-4294967296:t},CHAR:function(e){return String.fromCharCode(this.read(e,1))},STRING:function(e,t){return this.asArray("CHAR",e,t).join("")},asArray:function(e,t,n){for(var r=[],i=0;i<n;i++)r[i]=this[e](t+i);return r}}),e}),e(D,[N,u],function(a,c){return function o(e){var t,i,n,s=[],r=0;if(65496!==(t=new a(e)).SHORT(0))throw t.clear(),new c.ImageError(c.ImageError.WRONG_FORMAT);for(i=2;i<=t.length();)if(65488<=(n=t.SHORT(i))&&n<=65495)i+=2;else{if(65498===n||65497===n)break;r=t.SHORT(i+2)+2,65505<=n&&n<=65519&&s.push({hex:n,name:"APP"+(15&n),start:i,length:r,segment:t.SEGMENT(i,r)}),i+=r}return t.clear(),{headers:s,restore:function(e){var t,n,r;for(r=new a(e),i=65504==r.SHORT(2)?4+r.SHORT(4):2,n=0,t=s.length;n<t;n++)r.SEGMENT(i,0,s[n].segment),i+=s[n].length;return e=r.SEGMENT(),r.clear(),e},strip:function(e){var t,n,r,i;for(n=(r=new o(e)).headers,r.purge(),t=new a(e),i=n.length;i--;)t.SEGMENT(n[i].start,n[i].length,"");return e=t.SEGMENT(),t.clear(),e},get:function(e){for(var t=[],n=0,r=s.length;n<r;n++)s[n].name===e.toUpperCase()&&t.push(s[n].segment);return t},set:function(e,t){var n,r,i,o=[];for("string"==typeof t?o.push(t):o=t,n=r=0,i=s.length;n<i&&(s[n].name===e.toUpperCase()&&(s[n].segment=o[r],s[n].length=o[r].length,r++),!(r>=o.length));n++);},purge:function(){this.headers=s=[]}}}}),e(O,[t,N,u],function(_,s,C){function a(e){function r(e,t){var n,r,i,o,s,a,c,u,l=this,h=[],d={},p={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},g={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(n=l.SHORT(e),r=0;r<n;r++)if(h=[],c=e+2+12*r,(i=t[l.SHORT(c)])!==E){if(o=p[l.SHORT(c+=2)],s=l.LONG(c+=2),!(a=g[o]))throw new C.ImageError(C.ImageError.INVALID_META_ERR);if(c+=4,4<a*s&&(c=l.LONG(c)+m.tiffHeader),c+a*s>=this.length())throw new C.ImageError(C.ImageError.INVALID_META_ERR);"ASCII"!==o?(h=l.asArray(o,c,s),u=1==s?h[0]:h,f.hasOwnProperty(i)&&"object"!=typeof u?d[i]=f[i][u]:d[i]=u):d[i]=_.trim(l.STRING(c,s).replace(/\0$/,""))}return d}var t,l,f,m,n,i;if(s.call(this,e),l={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},n=(m={tiffHeader:10}).tiffHeader,t={clear:this.clear},_.extend(this,{read:function(){try{return a.prototype.read.apply(this,arguments)}catch(e){throw new C.ImageError(C.ImageError.INVALID_META_ERR)}},write:function(){try{return a.prototype.write.apply(this,arguments)}catch(e){throw new C.ImageError(C.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(e){return this.LONG(e)/this.LONG(e+4)},SRATIONAL:function(e){return this.SLONG(e)/this.SLONG(e+4)},ASCII:function(e){return this.CHAR(e)},TIFF:function(){return i||null},EXIF:function(){var e=null;if(m.exifIFD){try{e=r.call(this,m.exifIFD,l.exif)}catch(e){return null}if(e.ExifVersion&&"array"===_.typeOf(e.ExifVersion)){for(var t=0,n="";t<e.ExifVersion.length;t++)n+=String.fromCharCode(e.ExifVersion[t]);e.ExifVersion=n}}return e},GPS:function(){var e=null;if(m.gpsIFD){try{e=r.call(this,m.gpsIFD,l.gps)}catch(e){return null}e.GPSVersionID&&"array"===_.typeOf(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join("."))}return e},thumb:function(){if(m.IFD1)try{var e=r.call(this,m.IFD1,l.thumb);if("JPEGInterchangeFormat"in e)return this.SEGMENT(m.tiffHeader+e.JPEGInterchangeFormat,e.JPEGInterchangeFormatLength)}catch(e){}return null},setExif:function(e,t){return("PixelXDimension"===e||"PixelYDimension"===e)&&function(e,t,n){var r,i,o,s=0;if("string"==typeof t){var a=l[e.toLowerCase()];for(var c in a)if(a[c]===t){t=c;break}}r=m[e.toLowerCase()+"IFD"],i=this.SHORT(r);for(var u=0;u<i;u++)if(o=r+12*u+2,this.SHORT(o)==t){s=o+8;break}if(!s)return!1;try{this.write(s,n,4)}catch(e){return!1}return!0}.call(this,"exif",e,t)},clear:function(){t.clear(),e=l=f=i=m=t=null}}),65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase())throw new C.ImageError(C.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(n),42!==this.SHORT(n+=2))throw new C.ImageError(C.ImageError.INVALID_META_ERR);m.IFD0=m.tiffHeader+this.LONG(n+=2),"ExifIFDPointer"in(i=r.call(this,m.IFD0,l.tiff))&&(m.exifIFD=m.tiffHeader+i.ExifIFDPointer,delete i.ExifIFDPointer),"GPSInfoIFDPointer"in i&&(m.gpsIFD=m.tiffHeader+i.GPSInfoIFDPointer,delete i.GPSInfoIFDPointer),_.isEmptyObj(i)&&(i=null);var o=this.LONG(m.IFD0+12*this.SHORT(m.IFD0)+2);o&&(m.IFD1=m.tiffHeader+o)}return a.prototype=s.prototype,a}),e(w,[t,u,D,N,O],function(u,l,h,d,p){return function(e){function t(e){var t,n,r=0;for(e||(e=i);r<=e.length();){if(65472<=(t=e.SHORT(r+=2))&&t<=65475)return r+=5,{height:e.SHORT(r),width:e.SHORT(r+=2)};n=e.SHORT(r+=2),r+=n-2}return null}var i,n,r,o,s,a,c;if(65496!==(i=new d(e)).SHORT(0))throw new l.ImageError(l.ImageError.WRONG_FORMAT);n=new h(e);try{r=new p(n.get("app1")[0])}catch(e){}o=t.call(this),u.extend(this,{type:"image/jpeg",size:i.length(),width:o&&o.width||0,height:o&&o.height||0,setExif:function(e,t){return!!r&&("object"===u.typeOf(e)?u.each(e,function(e,t){r.setExif(t,e)}):r.setExif(e,t),void n.set("app1",r.SEGMENT()))},writeHeaders:function(){return arguments.length?n.restore(arguments[0]):n.restore(e)},stripHeaders:function(e){return n.strip(e)},purge:function(){(function(){r&&n&&i&&(r.clear(),n.purge(),i.clear(),o=n=r=i=null)}).call(this)}}),r&&(this.meta={tiff:r.TIFF(),exif:r.EXIF(),gps:r.GPS(),thumb:(c=r.thumb(),c&&(a=t(s=new d(c)),s.clear(),a)?(a.data=c,a):null)})}}),e(J,[u,t,N],function(r,i,s){return function(e){function t(){o&&(o.clear(),e=n=o=null)}var o,n;o=new s(e),function(){var e=0,t=0,n=[35152,20039,3338,6666];for(t=0;t<n.length;t++,e+=2)if(n[t]!=o.SHORT(e))throw new r.ImageError(r.ImageError.WRONG_FORMAT)}(),n=function(){var e,t;return"IHDR"==(e=function(e){var t,n,r,i;return t=o.LONG(e),n=o.STRING(e+=4,4),r=e+=4,i=o.LONG(e+t),{length:t,type:n,start:r,CRC:i}}.call(this,8)).type?(t=e.start,{width:o.LONG(t),height:o.LONG(t+=4)}):null}.call(this),i.extend(this,{type:"image/png",size:o.length(),width:n.width,height:n.height,purge:function(){t.call(this)}}),t.call(this)}}),e(U,[t,u,w,J],function(r,i,o,s){return function(t){var e,n=[o,s];e=function(){for(var e=0;e<n.length;e++)try{return new n[e](t)}catch(e){}throw new i.ImageError(i.ImageError.WRONG_FORMAT)}(),r.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){t=null}}),r.extend(this,e),this.purge=function(){e.purge(),e=null}}}),e(P,[],function(){function S(e){var t=e.naturalWidth;if(1048576<t*e.naturalHeight){var n=document.createElement("canvas");n.width=n.height=1;var r=n.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:S,renderTo:function(e,t,n){var r=e.naturalWidth,i=e.naturalHeight,o=n.width,s=n.height,a=n.x||0,c=n.y||0,u=t.getContext("2d");S(e)&&(r/=2,i/=2);var l=1024,h=document.createElement("canvas");h.width=h.height=l;for(var d=h.getContext("2d"),p=function(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var o=i.getImageData(0,0,1,n).data,s=0,a=n,c=n;s<c;){var u=o[4*(c-1)+3];0===u?a=c:s=c,c=a+s>>1}r=null;var l=c/n;return 0===l?1:l}(e,0,i),g=0;g<i;){for(var f=i<g+l?i-g:l,m=0;m<r;){var _=r<m+l?r-m:l;d.clearRect(0,0,l,l),d.drawImage(e,-m,-g);var C=m*o/r+a<<0,E=Math.ceil(_*o/r),I=g*s/i/p+c<<0,y=Math.ceil(f*s/i/p);u.drawImage(h,0,0,_,f,C,I,E,y),m+=l}g+=l}h=d=null}}}),e(x,[R,t,u,g,f,m,U,P,i,n],function(e,m,h,_,C,E,I,y,S,T){return e.Image=function(){function d(){if(!p&&!s)throw new h.ImageError(h.DOMException.INVALID_STATE_ERR);return p||s}function i(e){return _.atob(e.substring(e.indexOf("base64,")+7))}function o(e){var t,n=this;(s=new Image).onerror=function(){r.call(this),n.trigger("error",h.ImageError.WRONG_FORMAT)},s.onload=function(){n.trigger("load")},s.src="data:"==e.substr(0,5)?e:(t=e,"data:"+(u.type||"")+";base64,"+_.btoa(t))}function n(e,t,n,r){var i,o,s,a,c,u=0,l=0;if(f=r,c=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==m.inArray(c,[5,6,7,8])){var h=e;e=t,t=h}return o=d(),n?(e=Math.min(e,o.width),t=Math.min(t,o.height),i=Math.max(e/o.width,t/o.height)):i=Math.min(e/o.width,t/o.height),1<i&&!n&&r||(p||(p=document.createElement("canvas")),s=Math.round(o.width*i),a=Math.round(o.height*i),n?(p.width=e,p.height=t,e<s&&(u=Math.round((s-e)/2)),t<a&&(l=Math.round((a-t)/2))):(p.width=s,p.height=a),f||function(e,t,n){switch(n){case 5:case 6:case 7:case 8:p.width=t,p.height=e;break;default:p.width=e,p.height=t}var r=p.getContext("2d");switch(n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-e,0)}}(p.width,p.height,c),function(e,t,n,r,i,o){if("iOS"===T.OS)y.renderTo(e,t,{width:i,height:o,x:n,y:r});else{var s=t.getContext("2d");s.drawImage(e,n,r,i,o)}}.call(this,o,p,-u,-l,s,a),this.width=p.width,this.height=p.height,g=!0),void this.trigger("Resize")}function r(){a&&(a.purge(),a=null),c=s=p=u=null,g=!1}var s,a,p,c,u,l=this,g=!1,f=!0;m.extend(this,{loadFromBlob:function(e){var t=this,n=t.getRuntime(),r=!(1<arguments.length)||arguments[1];if(!n.can("access_binary"))throw new h.RuntimeError(h.RuntimeError.NOT_SUPPORTED_ERR);return(u=e).isDetached()?(c=e.getSource(),void o.call(this,c)):void function(e,t){var n,r=this;return window.FileReader?((n=new FileReader).onload=function(){t(this.result)},n.onerror=function(){r.trigger("error",h.ImageError.WRONG_FORMAT)},void n.readAsDataURL(e)):t(e.getAsDataURL())}.call(this,e.getSource(),function(e){r&&(c=i(e)),o.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,u=new E(null,{name:e.name,size:e.size,type:e.type}),o.call(this,t?c=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var e,t=this.getRuntime();return!a&&c&&t.can("access_image_binary")&&(a=new I(c)),!(e={width:d().width||0,height:d().height||0,type:u.type||S.getFileMime(u.name),size:c&&c.length||u.size||0,name:u.name||"",meta:a&&a.meta||this.meta||{}}).meta||!e.meta.thumb||e.meta.thumb.data instanceof C||(e.meta.thumb.data=new C(null,{type:"image/jpeg",data:e.meta.thumb.data})),e},downsize:function(){n.apply(this,arguments)},getAsCanvas:function(){return p&&(p.id=this.uid+"_canvas"),p},getAsBlob:function(e,t){return e!==this.type&&n.call(this,this.width,this.height,!1),new E(null,{name:u.name||"",type:e,data:l.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!g)return s.src;if("image/jpeg"!==e)return p.toDataURL("image/png");try{return p.toDataURL("image/jpeg",t/100)}catch(e){return p.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!g)return c||(c=i(l.getAsDataURL(e,t))),c;if("image/jpeg"!==e)c=i(l.getAsDataURL(e,t));else{var n;t||(t=90);try{n=p.toDataURL("image/jpeg",t/100)}catch(e){n=p.toDataURL("image/jpeg")}c=i(n),a&&(c=a.stripHeaders(c),f&&(a.meta&&a.meta.exif&&a.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),c=a.writeHeaders(c)),a.purge(),a=null)}return g=!1,c},destroy:function(){l=null,r.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}}),e(L,[t,n,c,u,h],function(s,a,c,u,t){function n(t){var n=c.get(t);n&&"OBJECT"==n.nodeName&&("IE"===a.browser?(n.style.display="none",function e(){4==n.readyState?function(e){var t=c.get(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}(t):setTimeout(e,10)}()):n.parentNode.removeChild(n))}var l="flash",h={};return t.addConstructor(l,function(r){var i,e,o=this;r=s.extend({swf_url:a.swf_url},r),t.call(this,r,l,{access_binary:function(e){return e&&"browser"===o.mode},access_image_binary:function(e){return e&&"browser"===o.mode},display_media:t.capTrue,do_cors:t.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===o.mode},resize_image:t.capTrue,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||!s.arrayDiff(e,["","text","document"])||"browser"===o.mode},return_status_code:function(e){return"browser"===o.mode||!s.arrayDiff(e,[200,404])},select_file:t.capTrue,select_multiple:t.capTrue,send_binary_string:function(e){return e&&"browser"===o.mode},send_browser_cookies:function(e){return e&&"browser"===o.mode},send_custom_headers:function(e){return e&&"browser"===o.mode},send_multipart:t.capTrue,slice_blob:function(e){return e&&"browser"===o.mode},stream_upload:function(e){return e&&"browser"===o.mode},summon_file_dialog:!1,upload_filesize:function(e){return s.parseSizeStr(e)<=2097152||"client"===o.mode},use_http_method:function(e){return!s.arrayDiff(e,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(e){return s.arrayDiff(e,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(e){return s.arrayDiff(e,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(e){return 2097152<=s.parseSizeStr(e)?"client":"browser"}},"client"),function(){var t;try{t=(t=navigator.plugins["Shockwave Flash"]).description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])}()<10&&(this.mode=!1),s.extend(this,{getShim:function(){return c.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return o.getShim().exec(this.uid,e,t,n)},init:function(){var e,t,n;n=this.getShimContainer(),s.extend(n.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),e='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+r.swf_url+'" ',"IE"===a.browser&&(e+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),e+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+r.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+a.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===a.browser?(t=document.createElement("div"),n.appendChild(t),t.outerHTML=e,t=n=null):n.innerHTML=e,i=setTimeout(function(){o&&!o.initialized&&o.trigger("Error",new u.RuntimeError(u.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:(e=this.destroy,function(){n(o.uid),e.call(o),clearTimeout(i),r=i=e=o=null})},h)}),h}),e("moxie/runtime/flash/file/FileInput",[L,m,t],function(e,r,i){var t={init:function(e){var t=this,n=this.getRuntime();this.bind("Change",function(){var e=n.shimExec.call(t,"FileInput","getFiles");t.files=[],i.each(e,function(e){t.files.push(new r(n.uid,e))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),e(k,[L,f],function(e,o){var t={slice:function(e,t,n,r){var i=this.getRuntime();return t<0?t=Math.max(e.size+t,0):0<t&&(t=Math.min(t,e.size)),n<0?n=Math.max(e.size+n,0):0<n&&(n=Math.min(n,e.size)),(e=i.shimExec.call(this,"Blob","slice",t,n,r||""))&&(e=new o(i.uid,e)),e}};return e.Blob=t}),e(H,[L,g],function(e,i){var t={read:function(n,e){var r=this;return r.result="","readAsDataURL"===n&&(r.result="data:"+(e.type||"")+";base64,"),r.bind("Progress",function(e,t){t&&(r.result+=function(e,t){switch(t){case"readAsText":return i.atob(e,"utf8");case"readAsBinaryString":return i.atob(e);case"readAsDataURL":return e}return null}(t,n))},999),r.getRuntime().shimExec.call(this,"FileReader","readAsBase64",e.uid)}};return e.FileReader=t}),e(F,[L,g],function(e,r){var t={read:function(e,t){var n;return(n=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(n="data:"+(t.type||"")+";base64,"+n),function(e,t){switch(t){case"readAsText":return r.atob(e,"utf8");case"readAsBinaryString":return r.atob(e);case"readAsDataURL":return e}return null}(n,e,t.type)):null}};return e.FileReaderSync=t}),e(B,[L,t,f,m,S,T,Y],function(e,u,l,i,o,h,d){var t={send:function(e,n){function r(){e.transport=a.mode,a.shimExec.call(s,"XMLHttpRequest","send",e,n)}function t(e,t){a.shimExec.call(s,"XMLHttpRequest","appendBlob",e,t.uid),n=null,r()}function i(e,t){var n=new d;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:a.uid})}var o,s=this,a=s.getRuntime();if(u.isEmptyObj(e.headers)||u.each(e.headers,function(e,t){a.shimExec.call(s,"XMLHttpRequest","setRequestHeader",t,e.toString())}),n instanceof h)if(n.each(function(e,t){e instanceof l?o=t:a.shimExec.call(s,"XMLHttpRequest","append",t,e)}),n.hasBlob()){var c=n.getBlob();c.isDetached()?i(c,function(e){c.destroy(),t(o,e)}):t(o,c)}else n=null,r();else n instanceof l?n.isDetached()?i(n,function(e){n.destroy(),n=e.uid,r()}):(n=n.uid,r()):r()},getResponse:function(e){var t,n,r=this.getRuntime();if(n=r.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(n=new i(r.uid,n),"blob"===e)return n;try{if(t=new o,~u.inArray(e,["","text"]))return t.readAsText(n);if("json"===e&&window.JSON)return JSON.parse(t.readAsText(n))}finally{n.destroy()}}return null},abort:function(e){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=t}),e(j,[L,f],function(e,r){var t={getAsBlob:function(e){var t=this.getRuntime(),n=t.shimExec.call(this,"Transporter","getAsBlob",e);return n?new r(t.uid,n):null}};return e.Transporter=t}),e(G,[L,t,Y,f,S],function(e,t,o,i,n){var r={loadFromBlob:function(e){function t(e){r.shimExec.call(n,"Image","loadFromBlob",e.uid),n=r=null}var n=this,r=n.getRuntime();if(e.isDetached()){var i=new o;i.bind("TransportingComplete",function(){t(i.result.getSource())}),i.transport(e.getSource(),e.type,{ruid:r.uid})}else t(e.getSource())},loadFromImage:function(e){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",e.uid)},getInfo:function(){var e=this.getRuntime(),t=e.shimExec.call(this,"Image","getInfo");return!t.meta||!t.meta.thumb||t.meta.thumb.data instanceof i||(t.meta.thumb.data=new i(e.uid,t.meta.thumb.data)),t},getAsBlob:function(e,t){var n=this.getRuntime(),r=n.shimExec.call(this,"Image","getAsBlob",e,t);return r?new i(n.uid,r):null},getAsDataURL:function(){var e=this.getRuntime().Image.getAsBlob.apply(this,arguments);return e?(new n).readAsDataURL(e):null}};return e.Image=r}),e(V,[t,n,c,u,h],function(i,o,s,a,c){var u="silverlight",l={};return c.addConstructor(u,function(e){var t,n,r=this;e=i.extend({xap_url:o.xap_url},e),c.call(this,e,u,{access_binary:c.capTrue,access_image_binary:c.capTrue,display_media:c.capTrue,do_cors:c.capTrue,drag_and_drop:!1,report_upload_progress:c.capTrue,resize_image:c.capTrue,return_response_headers:function(e){return e&&"client"===r.mode},return_response_type:function(e){return"json"!==e||!!window.JSON},return_status_code:function(e){return"client"===r.mode||!i.arrayDiff(e,[200,404])},select_file:c.capTrue,select_multiple:c.capTrue,send_binary_string:c.capTrue,send_browser_cookies:function(e){return e&&"browser"===r.mode},send_custom_headers:function(e){return e&&"client"===r.mode},send_multipart:c.capTrue,slice_blob:c.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:c.capTrue,use_http_method:function(e){return"client"===r.mode||!i.arrayDiff(e,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(e){return i.arrayDiff(e,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(e){return i.arrayDiff(e,["GET","POST"])?"client":["client","browser"]}}),function(t){var n,r,i,o,s,a=!1,c=0;try{try{new ActiveXObject("AgControl.AgControl").IsVersionSupported(t)&&(a=!0)}catch(e){var u=navigator.plugins["Silverlight Plug-In"];if(u){for("1.0.30226.2"===(n=u.description)&&(n="2.0.30226.2"),r=n.split(".");3<r.length;)r.pop();for(;r.length<4;)r.push(0);for(i=t.split(".");4<i.length;)i.pop();for(;o=parseInt(i[c],10),s=parseInt(r[c],10),++c<i.length&&o===s;);o<=s&&!isNaN(o)&&(a=!0)}}}catch(e){a=!1}return a}("2.0.31005.0")&&"Opera"!==o.browser||(this.mode=!1),i.extend(this,{getShim:function(){return s.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return r.getShim().exec(this.uid,e,t,n)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+e.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+o.global_event_dispatcher+'"/></object>',t=setTimeout(function(){r&&!r.initialized&&r.trigger("Error",new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR))},"Windows"!==o.OS?1e4:5e3)},destroy:(n=this.destroy,function(){n.call(r),clearTimeout(t),e=t=n=r=null})},l)}),l}),e("moxie/runtime/silverlight/file/FileInput",[V,m,t],function(e,r,i){var t={init:function(e){var t=this,n=this.getRuntime();this.bind("Change",function(){var e=n.shimExec.call(t,"FileInput","getFiles");t.files=[],i.each(e,function(e){t.files.push(new r(n.uid,e))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",function(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),e("moxie/runtime/silverlight/file/Blob",[V,t,k],function(e,t,n){return e.Blob=t.extend({},n)}),e("moxie/runtime/silverlight/file/FileDrop",[V,c,M],function(e,n,r){var t={init:function(){var e,t=this.getRuntime();return e=t.getShimContainer(),r.addEvent(e,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},this.uid),r.addEvent(e,"dragenter",function(e){e.preventDefault(),n.get(t.uid).dragEnter(e)&&e.stopPropagation()},this.uid),r.addEvent(e,"drop",function(e){e.preventDefault(),n.get(t.uid).dragDrop(e)&&e.stopPropagation()},this.uid),t.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=t}),e("moxie/runtime/silverlight/file/FileReader",[V,t,H],function(e,t,n){return e.FileReader=t.extend({},n)}),e("moxie/runtime/silverlight/file/FileReaderSync",[V,t,F],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),e("moxie/runtime/silverlight/xhr/XMLHttpRequest",[V,t,B],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),e("moxie/runtime/silverlight/runtime/Transporter",[V,t,j],function(e,t,n){return e.Transporter=t.extend({},n)}),e("moxie/runtime/silverlight/image/Image",[V,t,f,G],function(e,t,n,r){return e.Image=t.extend({},r,{getInfo:function(){var e=this.getRuntime(),s={meta:{}},a=e.shimExec.call(this,"Image","getInfo");return a.meta&&(t.each(["tiff","exif","gps","thumb"],function(e){var t,n,r,i,o=a.meta[e];if(o&&o.keys)for(s.meta[e]={},n=0,r=o.keys.length;n<r;n++)(i=o[t=o.keys[n]])&&(/^(\d|[1-9]\d+)$/.test(i)?i=parseInt(i,10):/^\d*\.\d+$/.test(i)&&(i=parseFloat(i)),s.meta[e][t]=i)}),!s.meta||!s.meta.thumb||s.meta.thumb.data instanceof n||(s.meta.thumb.data=new n(e.uid,s.meta.thumb.data))),s.width=parseInt(a.width,10),s.height=parseInt(a.height,10),s.size=parseInt(a.size,10),s.type=a.type,s.name=a.name,s}})}),e(q,[t,u,h,n],function(o,e,s,a){var c="html4",u={};return s.addConstructor(c,function(e){var t,n=this,r=s.capTest,i=s.capTrue;s.call(this,e,c,{access_binary:r(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:r(u.Image&&(a.can("create_canvas")||a.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:r("Chrome"===a.browser&&a.verComp(a.version,28,">=")||"IE"===a.browser&&a.verComp(a.version,10,">=")||"Safari"===a.browser&&a.verComp(a.version,7,">=")),resize_image:function(){return u.Image&&n.can("access_binary")&&a.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||!!~o.inArray(e,["text","document",""])},return_status_code:function(e){return!o.arrayDiff(e,[200,404])},select_file:function(){return a.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return n.can("select_file")},summon_file_dialog:function(){return n.can("select_file")&&("Firefox"===a.browser&&a.verComp(a.version,4,">=")||"Opera"===a.browser&&a.verComp(a.version,12,">=")||"IE"===a.browser&&a.verComp(a.version,10,">=")||!!~o.inArray(a.browser,["Chrome","Safari"]))},upload_filesize:i,use_http_method:function(e){return!o.arrayDiff(e,["GET","POST"])}}),o.extend(this,{init:function(){this.trigger("Init")},destroy:(t=this.destroy,function(){t.call(n),t=n=null})}),o.extend(this.getShim(),u)}),u}),e("moxie/runtime/html4/file/FileInput",[q,m,t,c,M,i,n],function(e,d,p,g,f,a,m){return e.FileInput=function(){var u,l,h=[];p.extend(this,{init:function(e){var t,n,r,i,o=this,s=o.getRuntime();h=(l=e).accept.mimes||a.extList2mimes(e.accept,s.can("filter_by_extension")),t=s.getShimContainer(),n=g.get(e.browse_button),s.can("summon_file_dialog")&&("static"===g.getStyle(n,"position")&&(n.style.position="relative"),r=parseInt(g.getStyle(n,"z-index"),10)||1,n.style.zIndex=r,t.style.zIndex=r-1),i=s.can("summon_file_dialog")?n:t,f.addEvent(i,"mouseover",function(){o.trigger("mouseenter")},o.uid),f.addEvent(i,"mouseout",function(){o.trigger("mouseleave")},o.uid),f.addEvent(i,"mousedown",function(){o.trigger("mousedown")},o.uid),f.addEvent(g.get(e.container),"mouseup",function(){o.trigger("mouseup")},o.uid),n=null,function t(){var e,n,r,i,o,s,a=this,c=a.getRuntime();s=p.guid("uid_"),e=c.getShimContainer(),u&&(r=g.get(u+"_form"))&&p.extend(r.style,{top:"100%"}),(i=document.createElement("form")).setAttribute("id",s+"_form"),i.setAttribute("method","post"),i.setAttribute("enctype","multipart/form-data"),i.setAttribute("encoding","multipart/form-data"),p.extend(i.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),(o=document.createElement("input")).setAttribute("id",s),o.setAttribute("type","file"),o.setAttribute("name",l.name||"Filedata"),o.setAttribute("accept",h.join(",")),p.extend(o.style,{fontSize:"999px",opacity:0}),i.appendChild(o),e.appendChild(i),p.extend(o.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===m.browser&&m.verComp(m.version,10,"<")&&p.extend(o.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),o.onchange=function(){var e;if(this.value){if(this.files){if(0===(e=this.files[0]).size)return void i.parentNode.removeChild(i)}else e={name:this.value};e=new d(c.uid,e),this.onchange=function(){},t.call(a),a.files=[e],o.setAttribute("id",e.uid),i.setAttribute("id",e.uid+"_form"),a.trigger("change"),o=i=null}},c.can("summon_file_dialog")&&(n=g.get(l.browse_button),f.removeEvent(n,"click",a.uid),f.addEvent(n,"click",function(e){o&&!o.disabled&&o.click(),e.preventDefault()},a.uid)),u=s,e=r=n=null}.call(this),t=null,o.trigger({type:"ready",async:!0})},disable:function(e){var t;(t=g.get(u))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),n=e.getShimContainer();f.removeAllEvents(n,this.uid),f.removeAllEvents(l&&g.get(l.container),this.uid),f.removeAllEvents(l&&g.get(l.browse_button),this.uid),n&&(n.innerHTML=""),t.removeInstance(this.uid),u=h=l=n=t=null}})}}),e("moxie/runtime/html4/file/FileReader",[q,A],function(e,t){return e.FileReader=t}),e("moxie/runtime/html4/xhr/XMLHttpRequest",[q,t,c,I,u,M,f,T],function(e,g,f,m,_,C,E,I){return e.XMLHttpRequest=function(){function l(t){var e,n,r,i,o=this,s=!1;if(p){if(e=p.id.replace(/_iframe$/,""),n=f.get(e+"_form")){for(i=(r=n.getElementsByTagName("input")).length;i--;)switch(r[i].getAttribute("type")){case"hidden":r[i].parentNode.removeChild(r[i]);break;case"file":s=!0}r=[],s||n.parentNode.removeChild(n),n=null}setTimeout(function(){C.removeEvent(p,"load",o.uid),p.parentNode&&p.parentNode.removeChild(p);var e=o.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=p=null,t()},1)}}var h,d,p;g.extend(this,{send:function(t,e){var n,r,i,o,s,a,c=this,u=c.getRuntime();if(h=d=null,e instanceof I&&e.hasBlob()){if(o=e.getBlob(),n=o.uid,i=f.get(n),!(r=f.get(n+"_form")))throw new _.DOMException(_.DOMException.NOT_FOUND_ERR)}else n=g.guid("uid_"),(r=document.createElement("form")).setAttribute("id",n+"_form"),r.setAttribute("method",t.method),r.setAttribute("enctype","multipart/form-data"),r.setAttribute("encoding","multipart/form-data"),u.getShimContainer().appendChild(r);r.setAttribute("target",n+"_iframe"),e instanceof I&&e.each(function(e,t){if(e instanceof E)i&&i.setAttribute("name",t);else{var n=document.createElement("input");g.extend(n,{type:"hidden",name:t,value:e}),i?r.insertBefore(n,i):r.appendChild(n)}}),r.setAttribute("action",t.url),s=u.getShimContainer()||document.body,(a=document.createElement("div")).innerHTML='<iframe id="'+n+'_iframe" name="'+n+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',p=a.firstChild,s.appendChild(p),C.addEvent(p,"load",function(){var e;try{e=p.contentWindow.document||p.contentDocument||window.frames[p.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(e.title)?h=e.title.replace(/^(\d+).*$/,"$1"):(h=200,d=g.trim(e.body.innerHTML),c.trigger({type:"progress",loaded:d.length,total:d.length}),o&&c.trigger({type:"uploadprogress",loaded:o.size||1025,total:o.size||1025}))}catch(e){if(!m.hasSameOrigin(t.url))return void l.call(c,function(){c.trigger("error")});h=404}l.call(c,function(){c.trigger("load")})},c.uid),r.submit(),c.trigger("loadstart")},getStatus:function(){return h},getResponse:function(e){if("json"===e&&"string"===g.typeOf(d)&&window.JSON)try{return JSON.parse(d.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(e){return null}return d},abort:function(){var e=this;p&&p.contentWindow&&(p.contentWindow.stop?p.contentWindow.stop():p.contentWindow.document.execCommand?p.contentWindow.document.execCommand("Stop"):p.src="about:blank"),l.call(this,function(){e.dispatchEvent("abort")})}})}}),e("moxie/runtime/html4/image/Image",[q,x],function(e,t){return e.Image=t}),function(e){for(var t=0;t<e.length;t++){for(var n=s,r=e[t],i=r.split(/[.\/]/),o=0;o<i.length-1;++o)n[i[o]]===E&&(n[i[o]]={}),n=n[i[o]];n[i[i.length-1]]=a[r]}}([t,n,r,i,c,u,l,h,d,p,g,f,m,_,C,I,y,S,T,v,Y,b,M])}(this),function(e){"use strict";var i={},o=e.moxie.core.utils.Basic.inArray;(function e(t){var n,r;for(n in t)"object"!==(r=typeof t[n])||~o(n,["Exceptions","Env","Mime"])?"function"===r&&(i[n]=t[n]):e(t[n])})(e.moxie),i.Env=e.moxie.core.utils.Env,i.Mime=e.moxie.core.utils.Mime,i.Exceptions=e.moxie.core.Exceptions,e.mOxie=i,e.o||(e.o=i)}(this),function(e,Y,b){function R(e){function n(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?i[r[e]]=t:n||(i[e]=t)}var t=e.required_features,i={};return"string"==typeof t?N.each(t.split(/\s*,\s*/),function(e){n(e,!0)}):"object"==typeof t?N.each(t,function(e,t){n(t,e)}):!0===t&&(0<e.chunk_size&&(i.slice_blob=!0),!e.resize.enabled&&e.multipart||(i.send_binary_string=!0),N.each(e,function(e,t){n(t,!!e,!0)})),i}var t,M=e.setTimeout,A={},N={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:Y.mimes,ua:Y.ua,typeOf:Y.typeOf,extend:Y.extend,guid:Y.guid,getAll:function(e){var t,n=[];"array"!==N.typeOf(e)&&(e=[e]);for(var r=e.length;r--;)(t=N.get(e[r]))&&n.push(t);return n.length?n:null},get:Y.get,each:Y.each,getPos:Y.getPos,getSize:Y.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return e?(""+e).replace(/[<>&\"\']/g,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:Y.toArray,inArray:Y.inArray,addI18n:Y.addI18n,translate:Y.translate,isEmptyObj:Y.isEmptyObj,hasClass:Y.hasClass,addClass:Y.addClass,removeClass:Y.removeClass,getStyle:Y.getStyle,addEvent:Y.addEvent,removeEvent:Y.removeEvent,removeAllEvents:Y.removeAllEvents,cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=(e=e.replace(/\s+/g,"_")).replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var n="";return N.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(0<e.indexOf("?")?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===b||/\D/.test(e))return N.translate("N/A");var n=Math.pow(1024,4);return n<e?t(e/n,1)+" "+N.translate("tb"):e>(n/=1024)?t(e/n,1)+" "+N.translate("gb"):e>(n/=1024)?t(e/n,1)+" "+N.translate("mb"):1024<e?Math.round(e/1024)+" "+N.translate("kb"):e+" "+N.translate("b")},parseSize:Y.parseSizeStr,predictRuntime:function(e,t){var n,r;return n=new N.Uploader(e),r=Y.Runtime.thatCan(n.getOption().required_features,t||e.runtimes),n.destroy(),r},addFileFilter:function(e,t){A[e]=t}};N.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:N.FILE_EXTENSION_ERROR,message:N.translate("File extension error."),file:t}),n(!1)):n(!0)}),N.addFileFilter("max_file_size",function(e,t,n){e=N.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:N.FILE_SIZE_ERROR,message:N.translate("File size error."),file:t}),n(!1)):n(!0)}),N.addFileFilter("prevent_duplicates",function(e,t,n){if(e)for(var r=this.files.length;r--;)if(t.name===this.files[r].name&&t.size===this.files[r].size)return this.trigger("Error",{code:N.FILE_DUPLICATE_ERROR,message:N.translate("Duplicate file error."),file:t}),void n(!1);n(!0)}),N.Uploader=function(e){function n(){var e,t,n=0;if(this.state==N.STARTED){for(t=0;t<I.length;t++)e||I[t].status!=N.QUEUED?n++:(e=I[t],this.trigger("BeforeUpload",e)&&(e.status=N.UPLOADING,this.trigger("UploadFile",e)));n==I.length&&(this.state!==N.STOPPED&&(this.state=N.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",I))}}function r(e){e.percent=0<e.size?Math.ceil(e.loaded/e.size*100):100,i()}function i(){var e,t;for(C.reset(),e=0;e<I.length;e++)(t=I[e]).size!==b?(C.size+=t.origSize,C.loaded+=t.loaded*t.origSize/t.size):C.size=b,t.status==N.DONE?C.uploaded++:t.status==N.FAILED?C.failed++:C.queued++;C.size===b?C.percent=0<I.length?Math.ceil(C.uploaded/I.length*100):0:(C.bytesPerSec=Math.ceil(C.loaded/((+new Date-_||1)/1e3)),C.percent=0<C.size?Math.ceil(C.loaded/C.size*100):0)}function c(){var e=S[0]||T[0];return!!e&&e.getRuntime().uid}function o(r,e){var i=this,o=0,t=[],s={runtime_order:r.runtimes,required_caps:r.required_features,preferred_caps:y,swf_url:r.flash_swf_url,xap_url:r.silverlight_xap_url};N.each(r.runtimes.split(/\s*,\s*/),function(e){r[e]&&(s[e]=r[e])}),r.browse_button&&N.each(r.browse_button,function(n){t.push(function(t){var e=new Y.FileInput(N.extend({},s,{accept:r.filters.mime_types,name:r.file_data_name,multiple:r.multi_selection,container:r.container,browse_button:n}));e.onready=function(){var e=Y.Runtime.getInfo(this.ruid);Y.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),o++,S.push(this),t()},e.onchange=function(){i.addFile(this.files)},e.bind("mouseenter mouseleave mousedown mouseup",function(e){v||(r.browse_button_hover&&("mouseenter"===e.type?Y.addClass(n,r.browse_button_hover):"mouseleave"===e.type&&Y.removeClass(n,r.browse_button_hover)),r.browse_button_active&&("mousedown"===e.type?Y.addClass(n,r.browse_button_active):"mouseup"===e.type&&Y.removeClass(n,r.browse_button_active)))}),e.bind("mousedown",function(){i.trigger("Browse")}),e.bind("error runtimeerror",function(){e=null,t()}),e.init()})}),r.drop_element&&N.each(r.drop_element,function(n){t.push(function(t){var e=new Y.FileDrop(N.extend({},s,{drop_zone:n}));e.onready=function(){var e=Y.Runtime.getInfo(this.ruid);Y.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),o++,T.push(this),t()},e.ondrop=function(){i.addFile(this.files)},e.bind("error runtimeerror",function(){e=null,t()}),e.init()})}),Y.inSeries(t,function(){"function"==typeof e&&e(o)})}function s(e,t,n){function r(e,t,n){var r,i,o=m[e];switch(e){case"max_file_size":"max_file_size"===e&&(m.max_file_size=m.filters.max_file_size=t);break;case"chunk_size":(t=N.parseSize(t))&&(m[e]=t,m.send_file_name=!0);break;case"multipart":(m[e]=t)||(m.send_file_name=!0);break;case"unique_names":(m[e]=t)&&(m.send_file_name=!0);break;case"filters":"array"===N.typeOf(t)&&(t={mime_types:t}),n?N.extend(m.filters,t):m.filters=t,t.mime_types&&(m.filters.mime_types.regexp=(r=m.filters.mime_types,i=[],N.each(r,function(e){N.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?i.push("\\.*"):i.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+i.join("|")+")$","i")));break;case"resize":n?N.extend(m.resize,t,{enabled:!0}):m.resize=t;break;case"prevent_duplicates":m.prevent_duplicates=m.filters.prevent_duplicates=!!t;break;case"container":case"browse_button":case"drop_element":t="container"===e?N.get(t):N.getAll(t);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":m[e]=t,n||(a=!0);break;default:m[e]=t}n||s.trigger("OptionChanged",e,t,o)}var s=this,a=!1;"object"==typeof e?N.each(e,function(e,t){r(t,e,n)}):r(e,t,n),n?(m.required_features=R(N.extend({},m)),y=R(N.extend({},m,{required_features:!0}))):a&&(s.trigger("Destroy"),o.call(s,m,function(e){e?(s.runtime=Y.Runtime.getInfo(c()).type,s.trigger("Init",{runtime:s.runtime}),s.trigger("PostInit")):s.trigger("Error",{code:N.INIT_ERROR,message:N.translate("Init error.")})}))}function a(e,t){if(e.settings.unique_names){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r}}function u(i,o){function s(){0<h--?M(a,1e3):(o.loaded=p,i.trigger("Error",{code:N.HTTP_ERROR,message:N.translate("HTTP Error."),file:o,response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()}))}function a(){var e,n,t,r={};o.status===N.UPLOADING&&i.state!==N.STOPPED&&(i.settings.send_file_name&&(r.name=o.target_name||o.name),l&&d.chunks&&c.size>l?(t=Math.min(l,c.size-p),e=c.slice(p,p+t)):(t=c.size,e=c),l&&d.chunks&&(i.settings.send_chunk_number?(r.chunk=Math.ceil(p/l),r.chunks=Math.ceil(c.size/l)):(r.offset=p,r.total=c.size)),(E=new Y.XMLHttpRequest).upload&&(E.upload.onprogress=function(e){o.loaded=Math.min(o.size,p+e.loaded),i.trigger("UploadProgress",o)}),E.onload=function(){400<=E.status?s():(h=i.settings.max_retries,t<c.size?(e.destroy(),p+=t,o.loaded=Math.min(p,c.size),i.trigger("ChunkUploaded",o,{offset:o.loaded,total:c.size,response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()}),"Android Browser"===Y.Env.browser&&i.trigger("UploadProgress",o)):o.loaded=o.size,e=n=null,!p||p>=c.size?(o.size!=o.origSize&&(c.destroy(),c=null),i.trigger("UploadProgress",o),o.status=N.DONE,i.trigger("FileUploaded",o,{response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()})):M(a,1))},E.onerror=function(){s()},E.onloadend=function(){this.destroy(),E=null},i.settings.multipart&&d.multipart?(E.open("post",u,!0),N.each(i.settings.headers,function(e,t){E.setRequestHeader(t,e)}),n=new Y.FormData,N.each(N.extend(r,i.settings.multipart_params),function(e,t){n.append(t,e)}),n.append(i.settings.file_data_name,e),E.send(n,{runtime_order:i.settings.runtimes,required_caps:i.settings.required_features,preferred_caps:y,swf_url:i.settings.flash_swf_url,xap_url:i.settings.silverlight_xap_url})):(u=N.buildUrl(i.settings.url,N.extend(r,i.settings.multipart_params)),E.open("post",u,!0),E.setRequestHeader("Content-Type","application/octet-stream"),N.each(i.settings.headers,function(e,t){E.setRequestHeader(t,e)}),E.send(e,{runtime_order:i.settings.runtimes,required_caps:i.settings.required_features,preferred_caps:y,swf_url:i.settings.flash_swf_url,xap_url:i.settings.silverlight_xap_url})))}var c,u=i.settings.url,l=i.settings.chunk_size,h=i.settings.max_retries,d=i.features,p=0;o.loaded&&(p=o.loaded=l?l*Math.floor(o.loaded/l):0),c=o.getSource(),i.settings.resize.enabled&&function(e,t){if(e.ruid){var n=Y.Runtime.getInfo(e.ruid);if(n)return n.can(t)}return!1}(c,"send_binary_string")&&~Y.inArray(c.type,["image/jpeg","image/png"])?function(t,e,n){var r=new Y.Image;try{r.onload=function(){if(e.width>this.width&&e.height>this.height&&e.quality===b&&e.preserve_headers&&!e.crop)return this.destroy(),n(t);r.downsize(e.width,e.height,e.crop,e.preserve_headers)},r.onresize=function(){n(this.getAsBlob(t.type,e.quality)),this.destroy()},r.onerror=function(){n(t)},r.load(t)}catch(e){n(t)}}.call(this,c,i.settings.resize,function(e){c=e,o.size=e.size,a()}):a()}function l(e,t){r(t)}function h(e){if(e.state==N.STARTED)_=+new Date;else if(e.state==N.STOPPED)for(var t=e.files.length-1;0<=t;t--)e.files[t].status==N.UPLOADING&&(e.files[t].status=N.QUEUED,i())}function d(){E&&E.abort()}function p(e){i(),M(function(){n.call(e)},1)}function g(e,t){t.code===N.INIT_ERROR?e.destroy():t.code===N.HTTP_ERROR&&(t.file.status=N.FAILED,r(t.file),e.state==N.STARTED&&(e.trigger("CancelUpload"),M(function(){n.call(e)},1)))}function f(e){e.stop(),N.each(I,function(e){e.destroy()}),I=[],S.length&&(N.each(S,function(e){e.destroy()}),S=[]),T.length&&(N.each(T,function(e){e.destroy()}),T=[]),v=!(y={}),_=E=null,C.reset()}var m,_,C,E,t=N.guid(),I=[],y={},S=[],T=[],v=!1;m={runtimes:Y.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},s.call(this,e,null,!0),C=new N.QueueProgress,N.extend(this,{id:t,uid:t,state:N.STOPPED,features:{},runtime:null,files:I,settings:m,total:C,init:function(){var e,t,n=this;return"function"==typeof(e=n.getOption("preinit"))?e(n):N.each(e,function(e,t){n.bind(t,e)}),function(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",d),this.bind("BeforeUpload",a),this.bind("UploadFile",u),this.bind("UploadProgress",l),this.bind("StateChanged",h),this.bind("QueueChanged",i),this.bind("Error",g),this.bind("FileUploaded",p),this.bind("Destroy",f)}.call(n),N.each(["container","browse_button","drop_element"],function(e){if(null===n.getOption(e))return!(t={code:N.INIT_ERROR,message:N.translate("'%' specified, but cannot be found.")})}),t?n.trigger("Error",t):m.browse_button||m.drop_element?void o.call(n,m,function(e){var t=n.getOption("init");"function"==typeof t?t(n):N.each(t,function(e,t){n.bind(t,e)}),e?(n.runtime=Y.Runtime.getInfo(c()).type,n.trigger("Init",{runtime:n.runtime}),n.trigger("PostInit")):n.trigger("Error",{code:N.INIT_ERROR,message:N.translate("Init error.")})}):n.trigger("Error",{code:N.INIT_ERROR,message:N.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(e,t){s.call(this,e,t,!this.runtime)},getOption:function(e){return e?m[e]:m},refresh:function(){S.length&&N.each(S,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=N.STARTED&&(this.state=N.STARTED,this.trigger("StateChanged"),n.call(this))},stop:function(){this.state!=N.STOPPED&&(this.state=N.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){v=arguments[0]===b||arguments[0],S.length&&N.each(S,function(e){e.disable(v)}),this.trigger("DisableBrowse",v)},getFile:function(e){var t;for(t=I.length-1;0<=t;t--)if(I[t].id===e)return I[t]},addFile:function(e,r){var i,o=this,s=[],a=[];i=c(),function e(n){var t=Y.typeOf(n);if(n instanceof Y.File){if(!n.ruid&&!n.isDetached()){if(!i)return!1;n.ruid=i,n.connectRuntime(i)}e(new N.File(n))}else n instanceof Y.Blob?(e(n.getSource()),n.destroy()):n instanceof N.File?(r&&(n.name=r),s.push(function(t){var r,e,i;r=n,e=function(e){e||(I.push(n),a.push(n),o.trigger("FileFiltered",n)),M(t,1)},i=[],Y.each(o.settings.filters,function(e,n){A[n]&&i.push(function(t){A[n].call(o,e,r,function(e){t(!e)})})}),Y.inSeries(i,e)})):-1!==Y.inArray(t,["file","blob"])?e(new Y.File(null,n)):"node"===t&&"filelist"===Y.typeOf(n.files)?Y.each(n.files,e):"array"===t&&(r=null,Y.each(n,e))}(e),s.length&&Y.inSeries(s,function(){a.length&&o.trigger("FilesAdded",a)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,n=I.length-1;0<=n;n--)if(I[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var n=I.splice(e===b?0:e,t===b?I.length:t),r=!1;return this.state==N.STARTED&&(N.each(n,function(e){if(e.status===N.UPLOADING)return!(r=!0)}),r&&this.stop()),this.trigger("FilesRemoved",n),N.each(n,function(e){e.destroy()}),r&&this.start(),n},dispatchEvent:function(e){var t,n;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort(function(e,t){return t.priority-e.priority}),(n=[].slice.call(arguments)).shift(),n.unshift(this);for(var r=0;r<t.length;r++)if(!1===t[r].fn.apply(t[r].scope,n))return!1}return!0},bind:function(e,t,n,r){N.Uploader.prototype.bind.call(this,e,t,r,n)},destroy:function(){this.trigger("Destroy"),m=C=null,this.unbindAll()}})},N.Uploader.prototype=Y.EventTarget.instance,N.File=(t={},function(e){N.extend(this,{id:N.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:N.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==Y.inArray(Y.typeOf(e),["blob","file"])?e:null},getSource:function(){return t[this.id]?t[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete t[this.id])}}),t[this.id]=e}),N.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=N}(window,mOxie);var PACKET_HEADER_SIZE=13,OPCODE_MAP={RECV:new BaseList,SEND:new BaseList};function _Range(e,t){this.START=e,this.END=t,this.SIZE=t-e}function _Opcode(e,t,n){this.KEY=e,this.SEND=t,this.RECV=n||t,OPCODE_MAP.SEND.set(this.SEND,this.KEY),OPCODE_MAP.RECV.set(this.RECV,this.KEY)}var OPCODE={AUTH:new _Opcode("auth",1),PING:new _Opcode("ping",2),STREAMEND:new _Opcode("streamend",4),RECEIPTS:new _Opcode("receipts",4098),USER_MESSAGE:new _Opcode("userMessage",4112),INPUT_STATE:new _Opcode("inputState",4117),CHATGROUP_MESSAGE:new _Opcode("chatGroupMessage",4144),PUBACCOUNT_MESSAGE:new _Opcode("pubaccountMessage",4176),SYNC_MESSAGE:new _Opcode("syncMessage",4208),RECEIPTS:new _Opcode("receipts",4098),NOTIFY_MESSAGE:new _Opcode("notifyMessage",4099),MUCONLINEDELIVERPACKET:new _Opcode("MucOnlineDeliverPacket",4368),PUBONLINEDELIVERPACKET:new _Opcode("PubOnlineDeliverPacket",4400),USERONLINEDELIVERPACKET:new _Opcode("UserOnlineDeliverPacket",4432),REMINDSETTINGONLINEDELIVERPACKET:new _Opcode("RemindSettingOnlineDeliverPacket",4448),INVITE_USERS:new _Opcode("inviteUsers",4865),VCARD:new _Opcode("vcard",8209),VCARDS:new _Opcode("vcards",8209,8210),IQ_RESULT:new _Opcode("iqResult",8225),QUERY_USER:new _Opcode("queryUser",8464,8465),QUERY_CHATGROUP:new _Opcode("queryChatGroup",8496,8497),QUERY_PUBACCOUNT:new _Opcode("queryPubaccount",8528,8529),ROSTER_LIST:new _Opcode("rosterList",8736,8737),CHATGROUP_LIST:new _Opcode("chatGroupList",8752,8753),CHATGROUP_MEMBER_LIST:new _Opcode("chatGroupMemberList",8768,8769),PUBACCOUNT_LIST:new _Opcode("pubaccountList",8784,8785),CHATGROUP_INFO:new _Opcode("chatGroupInfo",9008,9009),CHATGROUP_SHARED_FILES:new _Opcode("chatGroupSharedFiles",9010,9011),UPDATE_ROSTER:new _Opcode("updateRoster",9504),CONFIG_CHATGROUP:new _Opcode("chatGroupConfig",9520,9521),CREATE_GROUP:new _Opcode("createGroup",9522,9012),INVITE_GROUP_MEMBER:new _Opcode("inviteGroupMember",9523,9012),MODIFY_GROUP_INFO:new _Opcode("modifyGroupInfo",9524,9012),KICK_GROUP_MEMBER:new _Opcode("kickGroupMember",9525,9012),DISMISS_GROUP:new _Opcode("dismissgtoup",9528,9013),ON_GROUP_TRANSFER:new _Opcode("groupOwnerTransfer",9014),TRANSFER_GROUP:new _Opcode("transferGroup",9529),EXIT_GROUP:new _Opcode("exitGroup",9526,9013),ON_GROUP_UPDATE:new _Opcode("groupUpdate",9012),KICKED_GROUP:new _Opcode("kickedByGroup",9013),FAVORITED_ROSTERT:new _Opcode("favoritedRoster",9505),COLLECT_GROUP:new _Opcode("collectGroup",9527),FULL_SYNC_ROSTER:new _Opcode("fullSyncRoster",10016),DELTA_SYNC_ROSTER:new _Opcode("deltaSyncRoster",10018),FULL_SYNC_CHATGROUP:new _Opcode("fullSyncChatGroup",10032),DELTA_SYNC_CHATGROUP:new _Opcode("deltaSyncChatGroup",10034),PRESENCE:new _Opcode("presence",12289),CHATGROUP:new _Opcode("chatGroup",13057,13058),DEL_GROUPMEMBER:new _Opcode("delGroupMember",9792),OPERATE_WHITEBOARD:new _Opcode("operateWhiteBoard",10241),LISTEN_WHITEBOARD:new _Opcode("listenWhiteBoard",10241,10242),UPDATE_WHITEBOARD:new _Opcode("updateWhiteBoard",10245),PACKET_ERROR:new _Opcode("packetError",16384),STREAM_ERROR:new _Opcode("streamError",16640),MESSAGE_RANGE:new _Range(4096,8192),CREATE_NETMETTING:new _Opcode("createNetMetting",10368),NETMEETING_NOTIFY:new _Opcode("NETMeetingNotify",10369),NETMEETING_MANAGE:new _Opcode("NETMeetingManage",10370),NETMEETING_BILL:new _Opcode("NETMeetingBill",10372),IQ_RANGE:new _Range(8192,12288),PRESENCE_RANGE:new _Range(12288,16384)},SERVICE_OPCODE={SERVICE_USER_MESSAGE:new _Opcode("ServiceUserMessage",6145),SERVICE_RECEIPTS:new _Opcode("ServiceReceipts",6146)};YYIMUtil.extend(OPCODE,SERVICE_OPCODE);var PACKET_STRUCT={CONSOLE_FRAME:new _Range(0,1),OPCODE:new _Range(1,3),PACKET_LEN:new _Range(3,7),VERSION:new _Range(7,9),SEQ_ID:new _Range(9,13)};function shallowClone(e){function t(){}return t.prototype=e,new t}function inheritPrototype(e,t){var n=shallowClone(t.prototype);(n.constructor=e).prototype=n}function JumpPacket(e,t){if(this.sFrame=0,this.version=256,this.seqId=0,this.packetLen=0,e){this.content=e;try{this.packetLen="string"==typeof e?e.length:JSON.stringify(e).length}catch(e){}}this.opcode=t}function XmlHttp(){}function XmlDocument(){}XmlHttp.create=function(){try{if(window.XMLHttpRequest){var e=new XMLHttpRequest;return null===e.readyState&&(e.readyState=1,e.addEventListener("load",function(){e.readyState=4,"function"==typeof e.onreadystatechange&&e.onreadystatechange()},!1)),e}if(window.ActiveXObject)return new ActiveXObject(XmlHttp.getPrefix()+".XmlHttp")}catch(e){}throw new Error("Your browser does not support XmlHttp objects")},XmlHttp.getPrefix=function(){if(XmlHttp.prefix)return XmlHttp.prefix;for(var e=["MSXML2","Microsoft","MSXML","MSXML3"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t]+".XmlHttp"),XmlHttp.prefix=e[t]}catch(e){}throw new Error("Could not find an installed XML parser")},XmlDocument.create=function(t,n){t=t||"foo",n=n||"";try{var r;if(document.implementation&&document.implementation.createDocument?null===(r=document.implementation.createDocument(n,t,null)).readyState&&(r.readyState=1,r.addEventListener("load",function(){r.readyState=4,"function"==typeof r.onreadystatechange&&r.onreadystatechange()},!1)):window.ActiveXObject&&(r=new ActiveXObject(XmlDocument.getPrefix()+".DomDocument")),!r.documentElement||r.documentElement.tagName!=t||r.documentElement.namespaceURI&&r.documentElement.namespaceURI!=n)try{""!==n?r.appendChild(r.createElement(t)).setAttribute("xmlns",n):r.appendChild(r.createElement(t))}catch(e){null===(r=document.implementation.createDocument(n,t,null)).documentElement&&r.appendChild(r.createElement(t)),""!==n&&r.documentElement.getAttribute("xmlns")!=n&&r.documentElement.setAttribute("xmlns",n)}return r}catch(e){}throw new Error("Your browser does not support XmlDocument objects")},XmlDocument.getPrefix=function(){if(XmlDocument.prefix)return XmlDocument.prefix;for(var e=["MSXML2","Microsoft","MSXML","MSXML3"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t]+".DomDocument"),XmlDocument.prefix=e[t]}catch(e){}throw new Error("Could not find an installed XML parser")},"undefined"!=typeof Document&&window.DOMParser&&(Document.prototype.loadXML=function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml");this.hasChildNodes();)this.removeChild(this.lastChild);for(var n=0;n<t.childNodes.length;n++)this.appendChild(this.importNode(t.childNodes[n],!0))}),window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__&&(Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}),Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)}));var hexcase=0,b64pad="=";function hex_sha1(e){return rstr2hex(rstr_sha1(str2rstr_utf8(e)))}function b64_sha1(e){return rstr2b64(rstr_sha1(str2rstr_utf8(e)))}function any_sha1(e,t){return rstr2any(rstr_sha1(str2rstr_utf8(e)),t)}function hex_hmac_sha1(e,t){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_sha1(e,t){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_sha1(e,t,n){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(e){return binb2rstr(binb_sha1(rstr2binb(e),8*e.length))}function rstr_hmac_sha1(e,t){var n=rstr2binb(e);16<n.length&&(n=binb_sha1(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=binb_sha1(r.concat(rstr2binb(t)),512+8*t.length);return binb2rstr(binb_sha1(i.concat(s),672))}function rstr2binb(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function binb2rstr(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function binb_sha1(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n=Array(80),r=1732584193,i=-271733879,o=-1732584194,s=271733878,a=-1009589776,c=0;c<e.length;c+=16){for(var u=r,l=i,h=o,d=s,p=a,g=0;g<80;g++){n[g]=g<16?e[c+g]:bit_rol(n[g-3]^n[g-8]^n[g-14]^n[g-16],1);var f=safe_add(safe_add(bit_rol(r,5),sha1_ft(g,i,o,s)),safe_add(safe_add(a,n[g]),sha1_kt(g)));a=s,s=o,o=bit_rol(i,30),i=r,r=f}r=safe_add(r,u),i=safe_add(i,l),o=safe_add(o,h),s=safe_add(s,d),a=safe_add(a,p)}return Array(r,i,o,s,a)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,t){return rstr2any(rstr_md5(str2rstr_utf8(e)),t)}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_md5(e,t){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_md5(e,t,n){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);16<n.length&&(n=binl_md5(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=binl_md5(r.concat(rstr2binl(t)),512+8*t.length);return binl2rstr(binl_md5(i.concat(s),640))}function rstr2hex(e){for(var t,n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i=0;i<e.length;i++)t=e.charCodeAt(i),r+=n.charAt(t>>>4&15)+n.charAt(15&t);return r}function rstr2b64(e){for(var t="",n=e.length,r=0;r<n;r+=3)for(var i=e.charCodeAt(r)<<16|(r+1<n?e.charCodeAt(r+1)<<8:0)|(r+2<n?e.charCodeAt(r+2):0),o=0;o<4;o++)8*r+6*o>8*e.length?t+=b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-o)&63);return t}function arr2b64(e){for(var t="",n=e.length,r=0;r<n;r+=3)for(var i=e[r]<<16|(r+1<n?e[r+1]<<8:0)|(r+2<n?e[r+2]:0),o=0;o<4;o++)8*r+6*o>8*e.length?t+=b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-o)&63);return t}function rstr2any(e,t){var n,r,i,o,s,a=t.length,c=Array(Math.ceil(e.length/2));for(n=0;n<c.length;n++)c[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);var u=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),l=Array(u);for(r=0;r<u;r++){for(s=Array(),n=o=0;n<c.length;n++)o=(o<<16)+c[n],o-=(i=Math.floor(o/a))*a,(0<s.length||0<i)&&(s[s.length]=i);l[r]=o,c=s}var h="";for(n=l.length-1;0<=n;n--)h+=t.charAt(l[n]);return h}function str2rstr_utf8(e){for(var t,n,r="",i=-1;++i<e.length;)t=e.charCodeAt(i),n=i+1<e.length?e.charCodeAt(i+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),i++),t<=127?r+=String.fromCharCode(t):t<=2047?r+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r}function str2rstr_utf16le(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n),e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,255&e.charCodeAt(n));return t}function rstr2binl(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function binl2rstr(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=r,u=i,l=o;r=md5_ii(r=md5_ii(r=md5_ii(r=md5_ii(r=md5_hh(r=md5_hh(r=md5_hh(r=md5_hh(r=md5_gg(r=md5_gg(r=md5_gg(r=md5_gg(r=md5_ff(r=md5_ff(r=md5_ff(r=md5_ff(r,i=md5_ff(i,o=md5_ff(o,n=md5_ff(n,r,i,o,e[s+0],7,-680876936),r,i,e[s+1],12,-389564586),n,r,e[s+2],17,606105819),o,n,e[s+3],22,-1044525330),i=md5_ff(i,o=md5_ff(o,n=md5_ff(n,r,i,o,e[s+4],7,-176418897),r,i,e[s+5],12,1200080426),n,r,e[s+6],17,-1473231341),o,n,e[s+7],22,-45705983),i=md5_ff(i,o=md5_ff(o,n=md5_ff(n,r,i,o,e[s+8],7,1770035416),r,i,e[s+9],12,-1958414417),n,r,e[s+10],17,-42063),o,n,e[s+11],22,-1990404162),i=md5_ff(i,o=md5_ff(o,n=md5_ff(n,r,i,o,e[s+12],7,1804603682),r,i,e[s+13],12,-40341101),n,r,e[s+14],17,-1502002290),o,n,e[s+15],22,1236535329),i=md5_gg(i,o=md5_gg(o,n=md5_gg(n,r,i,o,e[s+1],5,-165796510),r,i,e[s+6],9,-1069501632),n,r,e[s+11],14,643717713),o,n,e[s+0],20,-373897302),i=md5_gg(i,o=md5_gg(o,n=md5_gg(n,r,i,o,e[s+5],5,-701558691),r,i,e[s+10],9,38016083),n,r,e[s+15],14,-660478335),o,n,e[s+4],20,-405537848),i=md5_gg(i,o=md5_gg(o,n=md5_gg(n,r,i,o,e[s+9],5,568446438),r,i,e[s+14],9,-1019803690),n,r,e[s+3],14,-187363961),o,n,e[s+8],20,1163531501),i=md5_gg(i,o=md5_gg(o,n=md5_gg(n,r,i,o,e[s+13],5,-1444681467),r,i,e[s+2],9,-51403784),n,r,e[s+7],14,1735328473),o,n,e[s+12],20,-1926607734),i=md5_hh(i,o=md5_hh(o,n=md5_hh(n,r,i,o,e[s+5],4,-378558),r,i,e[s+8],11,-2022574463),n,r,e[s+11],16,1839030562),o,n,e[s+14],23,-35309556),i=md5_hh(i,o=md5_hh(o,n=md5_hh(n,r,i,o,e[s+1],4,-1530992060),r,i,e[s+4],11,1272893353),n,r,e[s+7],16,-155497632),o,n,e[s+10],23,-1094730640),i=md5_hh(i,o=md5_hh(o,n=md5_hh(n,r,i,o,e[s+13],4,681279174),r,i,e[s+0],11,-358537222),n,r,e[s+3],16,-722521979),o,n,e[s+6],23,76029189),i=md5_hh(i,o=md5_hh(o,n=md5_hh(n,r,i,o,e[s+9],4,-640364487),r,i,e[s+12],11,-421815835),n,r,e[s+15],16,530742520),o,n,e[s+2],23,-995338651),i=md5_ii(i,o=md5_ii(o,n=md5_ii(n,r,i,o,e[s+0],6,-198630844),r,i,e[s+7],10,1126891415),n,r,e[s+14],15,-1416354905),o,n,e[s+5],21,-57434055),i=md5_ii(i,o=md5_ii(o,n=md5_ii(n,r,i,o,e[s+12],6,1700485571),r,i,e[s+3],10,-1894986606),n,r,e[s+10],15,-1051523),o,n,e[s+1],21,-2054922799),i=md5_ii(i,o=md5_ii(o,n=md5_ii(n,r,i,o,e[s+8],6,1873313359),r,i,e[s+15],10,-30611744),n,r,e[s+6],15,-1560198380),o,n,e[s+13],21,1309151649),i=md5_ii(i,o=md5_ii(o,n=md5_ii(n,r,i,o,e[s+4],6,-145523070),r,i,e[s+11],10,-1120210379),n,r,e[s+2],15,718787259),o,n,e[s+9],21,-343485551),n=safe_add(n,a),r=safe_add(r,c),i=safe_add(i,u),o=safe_add(o,l)}return Array(n,r,i,o)}function md5_cmn(e,t,n,r,i,o){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,o)),i),n)}function md5_ff(e,t,n,r,i,o,s){return md5_cmn(t&n|~t&r,e,t,i,o,s)}function md5_gg(e,t,n,r,i,o,s){return md5_cmn(t&r|n&~r,e,t,i,o,s)}function md5_hh(e,t,n,r,i,o,s){return md5_cmn(t^n^r,e,t,i,o,s)}function md5_ii(e,t,n,r,i,o,s){return md5_cmn(n^(t|~r),e,t,i,o,s)}function safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}function utf8t2d(e){e=e.replace(/\r\n/g,"\n");var t=new Array;if(String.fromCharCode(237).charCodeAt(0)<0)for(var n=0;n<e.length;n++){0<(r=e.charCodeAt(n))?t[t.length]=r:(t[t.length]=256+r>>6|192,t[t.length]=256+r&63|128)}else for(n=0;n<e.length;n++){var r;(r=e.charCodeAt(n))<128?t[t.length]=r:(127<r&&r<2048?t[t.length]=r>>6|192:(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128),t[t.length]=63&r|128)}return t}function utf8d2t(e){for(var t=new Array,n=0;n<e.length;)e[n]<128?(t[t.length]=String.fromCharCode(e[n]),n++):191<e[n]&&e[n]<224?(t[t.length]=String.fromCharCode((31&e[n])<<6|63&e[n+1]),n+=2):(t[t.length]=String.fromCharCode((15&e[n])<<12|(63&e[n+1])<<6|63&e[n+2]),n+=3);return t.join("")}function b64arrays(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b64=new Array,f64=new Array;for(var t=0;t<e.length;t++)b64[t]=e.charAt(t),f64[e.charAt(t)]=t}function b64d2t(e){var t=new Array,n=0,r=e.length;for(r%3==1&&(e[e.length]=0,e[e.length]=0),r%3==2&&(e[e.length]=0);n<e.length;)t[t.length]=b64[e[n]>>2],t[t.length]=b64[(3&e[n])<<4|e[n+1]>>4],t[t.length]=b64[(15&e[n+1])<<2|e[n+2]>>6],t[t.length]=b64[63&e[n+2]],n+=3;return r%3==1&&(t[t.length-1]=t[t.length-2]="="),r%3==2&&(t[t.length-1]="="),t.join("")}function b64t2d(e){var t=new Array,n=0;for(e=(e=e.replace(/\n|\r/g,"")).replace(/=/g,"");n<e.length;)t[t.length]=f64[e.charAt(n)]<<2|f64[e.charAt(n+1)]>>4,t[t.length]=(15&f64[e.charAt(n+1)])<<4|f64[e.charAt(n+2)]>>2,t[t.length]=(3&f64[e.charAt(n+2)])<<6|f64[e.charAt(n+3)],n+=4;return e.length%4==2&&(t=t.slice(0,t.length-2)),e.length%4==3&&(t=t.slice(0,t.length-1)),t}function createXHR(){var e;if("undefined"!=typeof ActiveXObject)for(var t=["Microsoft.XMLHTTP","Msxml2.XMLHttp.6.0","Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","Msxml2.XMLHttp.3.0"],n=0;n<t.length;n++)try{e=new ActiveXObject(t[n])}catch(e){}else"undefined"!=typeof XMLHttpRequest&&(e=new XMLHttpRequest);return e}if("undefined"!=typeof atob&&"undefined"!=typeof btoa||b64arrays(),"undefined"==typeof atob?(b64decode=function(e){return utf8d2t(b64t2d(e))},b64decode_bin=function(e){for(var t=b64t2d(e),n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n}):(b64decode=function(e){return decodeURIComponent(escape(atob(e)))},b64decode_bin=atob),"undefined"==typeof btoa?b64encode=function(e){return b64d2t(utf8t2d(e))}:b64encode=function(e){return btoa(unescape(encodeURIComponent(e)))},window.XDomainRequest){window.ieXDRToXHR=function(s){"use strict";var a=s.XMLHttpRequest;s.XMLHttpRequest=function(){this.onreadystatechange=Object,this.xhr=null,this.xdr=null,this.readyState=0,this.status="",this.statusText=null,this.responseText=null,this.getResponseHeader=null,this.getAllResponseHeaders=null,this.setRequestHeader=null,this.abort=null,this.send=null,this.isxdr=!1;var e=this;e.xdrLoadedBinded=function(){e.xdrLoaded()},e.xdrErrorBinded=function(){e.xdrError()},e.xdrProgressBinded=function(){e.xdrProgress()},e.xhrReadyStateChangedBinded=function(){e.xhrReadyStateChanged()}},XMLHttpRequest.prototype.open=function(e,t,n,r,i){var o=document.createElement("a");o.href=t,o.hostname&&o.hostname!=document.domain?(null===this.xdr&&(this.xdr=new s.XDomainRequest),this.isxdr=!0,this.setXDRActive(),this.xdr.open(e,t)):(null===this.xhr&&(this.xhr=new a),this.isxdr=!1,this.setXHRActive(),this.xhr.open(e,t,n,r,i))},XMLHttpRequest.prototype.xdrGetResponseHeader=function(e){return"Content-Type"===e&&""<this.xdr.contentType?this.xdr.contentType:""},XMLHttpRequest.prototype.xdrGetAllResponseHeaders=function(){return""<this.xdr.contentType?"Content-Type: "+this.xdr.contentType:""},XMLHttpRequest.prototype.xdrSetRequestHeader=function(e,t){},XMLHttpRequest.prototype.xdrLoaded=function(){if(null!==this.onreadystatechange){if(this.readyState=4,this.status=200,this.statusText="OK",this.responseText=this.xdr.responseText,s.ActiveXObject){var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(this.responseText),this.responseXML=e}this.onreadystatechange()}},XMLHttpRequest.prototype.xdrError=function(){null!==this.onreadystatechange&&(this.readyState=4,this.status=0,this.statusText="",this.responseText="",this.onreadystatechange())},XMLHttpRequest.prototype.xdrProgress=function(){null!==this.onreadystatechange&&3!==this.status&&(this.readyState=3,this.status=3,this.statusText="",this.onreadystatechange())},XMLHttpRequest.prototype.finalXDRRequest=function(){var e=this.xdr;delete e.onload,delete e.onerror,delete e.onprogress},XMLHttpRequest.prototype.sendXDR=function(e){var t=this.xdr;t.onload=this.xdrLoadedBinded,t.onerror=this.xdr.ontimeout=this.xdrErrorBinded,t.onprogress=this.xdrProgressBinded,this.responseText=null,this.xdr.send(e)},XMLHttpRequest.prototype.abortXDR=function(){this.finalXDRRequest(),this.xdr.abort()},XMLHttpRequest.prototype.setXDRActive=function(){this.send=this.sendXDR,this.abort=this.abortXDR,this.getResponseHeader=this.xdrGetResponseHeader,this.getAllResponseHeaders=this.xdrGetAllResponseHeaders,this.setRequestHeader=this.xdrSetRequestHeader},XMLHttpRequest.prototype.xhrGetResponseHeader=function(e){return this.xhr.getResponseHeader(e)},XMLHttpRequest.prototype.xhrGetAllResponseHeaders=function(){return this.xhr.getAllResponseHeaders()},XMLHttpRequest.prototype.xhrSetRequestHeader=function(e,t){return this.xhr.setRequestHeader(e,t)},XMLHttpRequest.prototype.xhrReadyStateChanged=function(){if(null!==this.onreadystatechange&&this.readyState!==this.xhr.readyState){var e=this.xhr;this.readyState=e.readyState,4===this.readyState&&(this.status=e.status,this.statusText=e.statusText,this.responseText=e.responseText,this.responseXML=e.responseXML),this.onreadystatechange()}},XMLHttpRequest.prototype.finalXHRRequest=function(){delete this.xhr.onreadystatechange},XMLHttpRequest.prototype.abortXHR=function(){this.finalXHRRequest(),this.xhr.abort()},XMLHttpRequest.prototype.sendXHR=function(e){this.xhr.onreadystatechange=this.xhrReadyStateChangedBinded,this.xhr.send(e)},XMLHttpRequest.prototype.setXHRActive=function(){this.send=this.sendXHR,this.abort=this.abortXHR,this.getResponseHeader=this.xhrGetResponseHeader,this.getAllResponseHeaders=this.xhrGetAllResponseHeaders,this.setRequestHeader=this.xhrSetRequestHeader},s.ieXDRToXHR=void 0};var isWebsocketSupport=!(-1<navigator.userAgent.indexOf("Safari")&&navigator.userAgent.indexOf("Chrome")<1||(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket));isWebsocketSupport||window.ieXDRToXHR(window)}String.prototype.htmlEnc=function(){if(!this)return this;var e=this.replace(/&/g,"&amp;");return e=(e=(e=(e=e.replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/\"/g,"&quot;")).replace(/\n/g,"<br />")},String.prototype.revertHtmlEnc=function(){if(!this)return this;var e=this.replace(/&amp;/gi,"&");return e=(e=(e=(e=e.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">")).replace(/&quot;/gi,'"')).replace(/<br( )?(\/)?>/gi,"\n")},Date.jab2date=function(e){var t=new Date(Date.UTC(e.substr(0,4),e.substr(5,2)-1,e.substr(8,2),e.substr(11,2),e.substr(14,2),e.substr(17,2)));if("Z"!=e.substr(e.length-6,1)){var n=new Date;n.setTime(0),n.setUTCHours(e.substr(e.length-5,2)),n.setUTCMinutes(e.substr(e.length-2,2)),"+"==e.substr(e.length-6,1)?t.setTime(t.getTime()-n.getTime()):"-"==e.substr(e.length-6,1)&&t.setTime(t.getTime()+n.getTime())}return t},Date.hrTime=function(e){return Date.jab2date(e).toLocaleString()},Date.prototype.jabberDate=function(){var e=function(e){return e<10?"0"+e:e},t=this.getUTCFullYear()+"-";return t+=e(this.getUTCMonth()+1)+"-",t+=e(this.getUTCDate())+"T",t+=e(this.getUTCHours())+":",t+=e(this.getUTCMinutes())+":",t+=e(this.getUTCSeconds())+"Z"},Number.max=function(e,t){return t<e?e:t},Number.min=function(e,t){return e<t?e:t};var JSJaC={Version:"1.4",bind:function(t,n,r){return function(e){return t.apply(n,[e,r])}}},JSJaCBuilder={buildNode:function(e,t){var n,r=arguments[4];if(arguments[2])if(JSJaCBuilder._isStringOrNumber(arguments[2])||arguments[2]instanceof Array)n=this._createElement(e,t,r),JSJaCBuilder._children(e,n,arguments[2]);else for(var i in r=arguments[2].xmlns||r,n=this._createElement(e,t,r),arguments[2])arguments[2].hasOwnProperty(i)&&"xmlns"!=i&&n.setAttribute(i,arguments[2][i]);else n=this._createElement(e,t,r);return arguments[3]&&JSJaCBuilder._children(e,n,arguments[3],r),n},_createElement:function(e,t,n){try{if(n)return e.createElementNS(n,t)}catch(e){}var r=e.createElement(t);return n&&r.setAttribute("xmlns",n),r},_text:function(e,t){return e.createTextNode(t)},_children:function(e,t,n,r){if("object"==typeof n){for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if("object"==typeof o)if(o instanceof Array){var s=JSJaCBuilder.buildNode(e,o[0],o[1],o[2],r);t.appendChild(s)}else t.appendChild(o);else JSJaCBuilder._isStringOrNumber(o)&&t.appendChild(JSJaCBuilder._text(e,o))}}else JSJaCBuilder._isStringOrNumber(n)&&t.appendChild(JSJaCBuilder._text(e,n))},_attributes:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n].toString().htmlEnc()+'"');return t.join(" ")},_isStringOrNumber:function(e){return"string"==typeof e||"number"==typeof e}};function JSJaCConnection(e){e&&e.httpbase&&(this._httpbase=e.httpbase),e&&e.oDbg&&e.oDbg.log?this.oDbg=e.oDbg:this.oDbg={log:function(){}},e&&e.timerval?this.setPollInterval(e.timerval):this.setPollInterval(JSJAC_TIMERVAL),e&&e.cookie_prefix?this._cookie_prefix=e.cookie_prefix:this._cookie_prefix="",this._connected=!1,this._events=[],this._keys=null,this._ID=0,this._IDPrefix="jump"+(new Date).format("yyMMdd")+"_",this._inQ=[],this._pQueue=[],this._regIDs=[],this._req=[],this._status="intialized",this._errcnt=0,this._inactivity=JSJAC_INACTIVITY,this._sendRawCallbacks=[]}function JSJaCConsoleLogger(e){this.level=e||4,this.start=function(){},this.log=function(t,e){if(!((e=e||0)>this.level)&&"undefined"!=typeof console)try{switch(e){case 0:console.warn(t);break;case 1:console.error(t);break;case 2:console.info(t);break;case 4:console.debug(t);break;default:console.log(t)}}catch(e){try{console.log(t)}catch(e){}}},this.setLevel=function(e){return this.level=e,this},this.getLevel=function(){return this.level}}JSJAC_HAVEKEYS=!0,JSJAC_NKEYS=16,JSJAC_INACTIVITY=300,JSJAC_ERR_COUNT=10,JSJAC_ALLOW_PLAIN=!0,JSJAC_ALLOW_SCRAM=!1,JSJAC_CHECKQUEUEINTERVAL=100,JSJAC_CHECKINQUEUEINTERVAL=100,JSJAC_TIMERVAL=2e3,JSJAC_RETRYDELAY=5e3,JSJAC_REGID_TIMEOUT=2e4,JSJACHBC_MAX_HOLD=1,JSJACHBC_MAX_WAIT=300,JSJACHBC_BOSH_VERSION="1.10",JSJACHBC_USE_BOSH_VER=!0,JSJACHBC_MAXPAUSE=120,JSJaCConnection.prototype.connect=function(e){this._setStatus("connecting"),e.appType&&(this.appType=e.appType),e.clientIdentify&&(this.clientIdentify=e.clientIdentify),this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource,this.pass=e.password||e.pass,this.authzid=e.authzid||"",this.register=e.register,this.authhost=e.authhost||e.host||e.domain,this.authtype=e.authtype||"sasl",e.xmllang&&""!==e.xmllang?this._xmllang=e.xmllang:this._xmllang="en",e.allow_plain?this._allow_plain=e.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,e.allow_scram?this._allow_scram=e.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,this.host=e.host,this.port=e.port||5222,this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,this._rid=Math.round(100000.5+799999.99999*Math.random());var t=this._getFreeSlot();this._req[t]=this._setupRequest(!0);var n=this._getInitialRequestString();this.oDbg.log(n,4),this._req[t].r.onreadystatechange=JSJaC.bind(function(){var e=this._req[t].r;4==e.readyState&&(this.oDbg.log("async recv: "+e.responseText,4),this._handleInitialResponse(e))},this),void 0!==this._req[t].r.onerror&&(this._req[t].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this)),this._req[t].r.send(n)},JSJaCConnection.prototype.connected=function(){return this._connected},JSJaCConnection.prototype.disconnect=function(){if(this._setStatus("disconnecting"),this.connected()){this._connected=!1,clearInterval(this._interval),clearInterval(this._inQto),this._timeout&&clearTimeout(this._timeout);var e=this._getFreeSlot();this._req[e]=this._setupRequest(!1);var t=this._getRequestString(!1,!0);this.oDbg.log("Disconnecting: "+t,4);try{this._req[e].r.send(t)}catch(e){}this.oDbg.log("disconnected");try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(e){}this._handleEvent("ondisconnect")}},JSJaCConnection.prototype.getPollInterval=function(){return this._timerval},JSJaCConnection.prototype.registerHandler=function(e,t,n,r){e=e.toLowerCase();var i={handler:arguments[arguments.length-1],ns:"*",type:"*"};return 2<arguments.length&&(i.ns=t),3<arguments.length&&(i.type=n),this._events[e]?this._events[e]=this._events[e].concat(i):this._events[e]=[i],this._events[e]=this._events[e].sort(function(e,t){var n=0,r=0;return"*"==e.type&&n++,"*"==e.ns&&n++,n++,"*"==t.type&&r++,"*"==t.ns&&r++,r<n?1:n<r?-1:0}),this.oDbg.log("registered handler for event '"+e+"'",2),this},JSJaCConnection.prototype.unregisterHandler=function(e,t){if(e=e.toLowerCase(),!this._events[e])return this;for(var n=this._events[e],r=[],i=0;i<n.length;i++)n[i].handler!=t&&r.push(n[i]);return n.length!=r.length&&(this._events[e]=r,this.oDbg.log("unregistered handler for event '"+e+"'",2)),this},JSJaCConnection.prototype.registerIQGet=function(e,t,n){return this.registerHandler("iq",e,t,"get",n)},JSJaCConnection.prototype.registerIQSet=function(e,t,n){return this.registerHandler("iq",e,t,"set",n)},JSJaCConnection.prototype.resume=function(){try{var e=JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").getValue();return this.oDbg.log("read cookie: "+e,2),JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase(),this.resumeFromData(JSJaCJSON.parse(e))}catch(e){}return!1},JSJaCConnection.prototype.resumeFromData=function(e){try{for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(this._keys){this._keys2=new JSJaCKeys;for(var n=this._keys2._getSuspendVars(),r=0;r<n.length;r++)this._keys2[n[r]]=this._keys[n[r]];this._keys=this._keys2}return this._connected?(this._setStatus("resuming"),this._handleEvent("onresume"),setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval()),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL)):this._setStatus("terminated"),!0===this._connected}catch(e){return e.message?this.oDbg.log("Resume failed: "+e.message,1):this.oDbg.log("Resume failed: "+e,1),!1}},JSJaCConnection.prototype.sendJumpPacket=function(e,t,n){if(!this.connected())return!1;if(!e||!e.opcode)return this.oDbg.log("no jumpPacket: "+e,1),!1;if(t&&this._validateCallbackable(e)){if(!e.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");e.content.id||(e.content.id=this._IDPrefix+this._ID++),this._registerPID(e,t,n)}return this._pQueue=this._pQueue.concat(e),this._handleEvent("packet_out",e),!0},JSJaCConnection.prototype.send=function(e,t,n){},JSJaCConnection.prototype.sendIQ=function(e,t,n){if(!e||"iq"!=e.pType())return!1;var r=(t=t||{}).error_handler||JSJaC.bind(function(e){this.oDbg.log(e.xml(),1)},this),i=t.result_handler||JSJaC.bind(function(e){this.oDbg.log(e.xml(),2)},this);return this.send(e,function(e,t){switch(e.getType()){case"error":r(e);break;case"result":i(e,t)}},n)},JSJaCConnection.prototype.setPollInterval=function(e){return e&&!isNaN(e)&&(this._timerval=e),this._timerval},JSJaCConnection.prototype.status=function(){return this._status},JSJaCConnection.prototype.suspend=function(){var e=this.suspendToData();try{var t=new JSJaCCookie(this._cookie_prefix+"JSJaC_State",JSJaCJSON.toString(e));this.oDbg.log("writing cookie: "+t.getValue()+"\n(length:"+t.getValue().length+")",2),t.write();var n=JSJaCCookie.get(this._cookie_prefix+"JSJaC_State");return t.getValue()==n||(this.oDbg.log("Suspend failed writing cookie.\nread: "+n,1),t.erase(),!1)}catch(e){this.oDbg.log("Failed creating cookie '"+this._cookie_prefix+"JSJaC_State': "+e.message,1)}return!1},JSJaCConnection.prototype.suspendToData=function(){clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._suspend();var e="_connected,_keys,_ID,_xmllang,_inQ,_pQueue,_regIDs,_errcnt,_inactivity,domain,username,resource,jid,fulljid,_sid,_httpbase,_timerval,_is_polling".split(",");e=e.concat(this._getSuspendVars());for(var t={},n=0;n<e.length;n++)if(this[e[n]]){var r={};if(this[e[n]]._getSuspendVars)for(var i=this[e[n]]._getSuspendVars(),o=0;o<i.length;o++)r[i[o]]=this[e[n]][i[o]];else r=this[e[n]];t[e[n]]=r}return this._connected=!1,this._setStatus("suspending"),t},JSJaCConnection.prototype._abort=function(){clearTimeout(this._timeout),clearInterval(this._inQto),clearInterval(this._interval),this._connected=!1,this._setStatus("aborted"),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("500","cancel","service-unavailable"))},JSJaCConnection.prototype._checkInQ=function(){for(var e=0;e<this._inQ.length&&e<10;e++){var t=this._inQ[0],n=t.body,r=t.event;if(this._inQ=this._inQ.slice(1,this._inQ.length),!n)return this._handleEvent("packet_in"),void this._handleEvent(r);this._handlePID(n)||(this._handleEvent("packet_in",n),this._handleEvent(r,n))}},JSJaCConnection.prototype._checkQueue=function(){return 0<this._pQueue.length&&this._process(),!0},JSJaCConnection.prototype._doAuth=function(){return this._sendJumpPacket(this._getAuthPacket(),function(e){if(e.event==OPCODE.AUTH.KEY){var t=e.body;if(200!=t.code)return void this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this._handleEvent("packet_in",t),this._handleEvent(OPCODE.AUTH.KEY,t),this._handleEvent("onconnect")}}),!0},JSJaCConnection.prototype._doInBandReg=function(){if("saslanon"!=this.authtype&&"anonymous"!=this.authtype){var e=new JSJaCIQ;e.setType("set"),e.setID("reg1"),e.appendNode("query",{xmlns:NS_REGISTER},[["username",this.username],["password",this.pass]]),this.send(e,this._doInBandRegDone)}},JSJaCConnection.prototype._doInBandRegDone=function(e){if(e&&"error"==e.getType())return this.oDbg.log("registration failed for "+this.username,0),void this._handleEvent("onerror",e.getChild("error"));this.oDbg.log(this.username+" registered succesfully",0),this._doAuth()},JSJaCConnection.prototype._doLegacyAuth=function(){if("nonsasl"!=this.authtype&&"anonymous"!=this.authtype)return!1;var e=new JSJaCIQ;return e.setIQ(null,"get","auth1"),e.appendNode("query",{xmlns:NS_AUTH},[["username",this.username]]),this.send(e,this._doLegacyAuth2),!0},JSJaCConnection.prototype._doLegacyAuth2=function(e){if(!e||"result"!=e.getType())return e&&"error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")),void this.disconnect();var t=null!==e.getChild("digest"),n=new JSJaCIQ;n.setIQ(null,"set","auth2");var r=n.appendNode("query",{xmlns:NS_AUTH},[["username",this.username],["resource",this.resource]]);if(t)r.appendChild(n.buildNode("digest",{xmlns:NS_AUTH},hex_sha1(this.streamid+this.pass)));else{if(!this._allow_plain)return this.oDbg.log("no valid login mechanism found",1),void this.disconnect();r.appendChild(n.buildNode("password",{xmlns:NS_AUTH},this.pass))}this.send(n,this._doLegacyAuthDone)},JSJaCConnection.prototype._doLegacyAuthDone=function(e){"result"!=e.getType()?("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")),this.disconnect()):this._handleEvent("onconnect")},JSJaCConnection.prototype._doSASLAuth=function(){if("nonsasl"==this.authtype||"anonymous"==this.authtype)return!1;if(void 0!==this.username&&null!=this.username&&""!=this.username||"saslanon"!=this.authtype){if(this._allow_scram&&this.mechs["SCRAM-SHA-1"]){this.oDbg.log("SASL using mechanism 'SCRAM-SHA-1'",2),this._clientFirstMessageBare="n="+this.username.replace(/=/g,"=3D").replace(/,/g,"=2C")+",r="+JSJaCUtils.cnonce(16);var e=(this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,")+this._clientFirstMessageBare;return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SCRAM-SHA-1'>"+b64encode(e)+"</auth>",this._doSASLAuthScramSha1S1)}if(this._allow_plain&&this.mechs.PLAIN){this.oDbg.log("SASL using mechanism 'PLAIN'",2);var t=this.authzid+String.fromCharCode(0)+this.username+String.fromCharCode(0)+this.pass;return this.oDbg.log("authenticating with '"+t+"'",2),t=b64encode(t),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='PLAIN'>"+t+"</auth>",this._doSASLAuthDone)}this.oDbg.log("No SASL mechanism applied",1),this.authtype="nonsasl"}else{if(this.mechs.ANONYMOUS)return this.oDbg.log("SASL using mechanism 'ANONYMOUS'",2),this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='ANONYMOUS'/>",this._doSASLAuthDone);this.oDbg.log("SASL ANONYMOUS requested but not supported",1)}return!1},JSJaCConnection.prototype._doSASLAuthScramSha1S1=function(e){if("challenge"!=e.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("got challenge: "+t,2);var n={},r=t.split(",");for(var i in r){var o=r[i].substring(2);n[r[i].substring(0,1)]=o}for(var s,a,c=str2rstr_utf8(this.pass),u=b64decode_bin(n.s)+"\0\0\0",l=parseInt(n.i,10),h=0;h<l;h++)u=rstr_hmac_sha1(c,u),s=JSJaCUtils.xor(s,u);a=this.authzid?"n,a="+this.authzid.replace(/=/g,"=3D").replace(/,/g,"=2C")+",":"n,,";var d="c="+b64encode(a)+",r="+n.r;this._saltedPassword=s;var p=rstr_hmac_sha1(this._saltedPassword,"Client Key"),g=rstr_sha1(p);this._authMessage=this._clientFirstMessageBare+","+t+","+d;var f=rstr_hmac_sha1(g,str2rstr_utf8(this._authMessage)),m=d+",p="+rstr2b64(JSJaCUtils.xor(p,f));this.oDbg.log("response: "+m,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(m)+"</response>",this._doSASLAuthScramSha1S2)}},JSJaCConnection.prototype._doSASLAuthScramSha1S2=function(e){if("success"!=e.nodeName)this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("got success: "+t,2);var n={},r=t.split(",");for(var i in r){var o=r[i].substring(2);n[r[i].substring(0,1)]=o}rstr_hmac_sha1(rstr_hmac_sha1(this._saltedPassword,"Server Key"),str2rstr_utf8(this._authMessage))!==b64decode_bin(n.v)?(this.oDbg.log("server auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))}},JSJaCConnection.prototype._doSASLAuthDigestMd5S1=function(e){if("challenge"!=e.nodeName)this.oDbg.log("challenge missing",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect();else{var t,n=b64decode(e.firstChild.nodeValue);if(this.oDbg.log("got challenge: "+n,2),-1===(t=n.indexOf('nonce="')))return this.oDbg.log("no valid nonce found, aborting",1),void this.disconnect();this._nonce=n.substring(t+7),this._nonce=this._nonce.substring(0,this._nonce.indexOf('"')),this.oDbg.log("nonce: "+this._nonce,2),-1!==(t=n.indexOf('realm="'))&&(this._realm=n.substring(t+7),this._realm=this._realm.substring(0,this._realm.indexOf('"'))),this._realm=this._realm||this.domain,this.oDbg.log("realm: "+this._realm,2),this._digest_uri="xmpp/"+this.domain,this._cnonce=JSJaCUtils.cnonce(14),this._nc="00000001";var r=rstr_md5(str2rstr_utf8(this.username+":"+this._realm+":"+this.pass))+":"+this._nonce+":"+this._cnonce;this.authzid&&(r=r+":"+this.authzid);var i=rstr2hex(rstr_md5(r)),o=hex_md5("AUTHENTICATE:"+this._digest_uri),s=hex_md5(i+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+o),a='username="'+this.username+'",realm="'+this._realm+'",nonce="'+this._nonce+'",cnonce="'+this._cnonce+'",nc='+this._nc+',qop=auth,digest-uri="'+this._digest_uri+'",response='+s+",charset=utf-8";this.authzid&&(a='authzid="'+this.authzid+'",'+a),this.oDbg.log("response: "+a,2),this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+b64encode(a)+"</response>",this._doSASLAuthDigestMd5S2)}},JSJaCConnection.prototype._doSASLAuthDigestMd5S2=function(e){if("failure"==e.nodeName)return e.xml?this.oDbg.log("auth error: "+e.xml,1):this.oDbg.log("auth error",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),void this.disconnect();var t=b64decode(e.firstChild.nodeValue);this.oDbg.log("response: "+t,2);var n=t.substring(t.indexOf("rspauth=")+8);this.oDbg.log("rspauth: "+n,2);var r=rstr_md5(str2rstr_utf8(this.username+":"+this._realm+":"+this.pass))+":"+this._nonce+":"+this._cnonce;this.authzid&&(r=r+":"+this.authzid);var i=rstr2hex(rstr_md5(r)),o=hex_md5(":"+this._digest_uri),s=hex_md5(i+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+o);if(this.oDbg.log("rsptest: "+s,2),s!=n)return this.oDbg.log("SASL Digest-MD5: server repsonse with wrong rspauth",1),void this.disconnect();"success"==e.nodeName?this._reInitStream(JSJaC.bind(this._doStreamBind,this)):this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>",this._doSASLAuthDone)},JSJaCConnection.prototype._doSASLAuthDone=function(e){"success"!=e.nodeName?(this.oDbg.log("auth failed",1),this._handleEvent("onerror",JSJaCError("401","auth","not-authorized")),this.disconnect()):this._reInitStream(JSJaC.bind(this._doStreamBind,this))},JSJaCConnection.prototype._doStreamBind=function(){var e=new JSJaCIQ;e.setIQ(null,"set","bind_1"),e.appendNode("bind",{xmlns:NS_BIND},[["resource",this.resource]]),this.oDbg.log(e.xml()),this.send(e,this._doXMPPSess)},JSJaCConnection.prototype._doXMPPSess=function(e){if("result"!=e.getType()||"error"==e.getType())return this.disconnect(),void("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")));this.fulljid=e.getChildVal("jid"),this.jid=this.fulljid.substring(0,this.fulljid.lastIndexOf("/")),(e=new JSJaCIQ).setIQ(null,"set","sess_1"),e.appendNode("session",{xmlns:NS_SESSION},[]),this.oDbg.log(e.xml()),this.send(e,this._doXMPPSessDone)},JSJaCConnection.prototype._doXMPPSessDone=function(e){if("result"!=e.getType()||"error"==e.getType())return this.disconnect(),void("error"==e.getType()&&this._handleEvent("onerror",e.getChild("error")));this._handleEvent("onconnect")},JSJaCConnection.prototype._handleEvent=function(e,t){if(e=e.toLowerCase(),this.oDbg.log("incoming event '"+e+"'",3),this._events[e]){this.oDbg.log("handling event '"+e+"'",2);for(var n=0;n<this._events[e].length;n++){var r=this._events[e][n];if("function"==typeof r.handler)if(t){if("*"!=r.ns&&t.ns!=r.ns)continue;if("*"!=r.type&&t.type!=r.type)continue;if(this.oDbg.log(r.ns+"/"+r.type+" => match for handler "+r.handler,3),r.handler(t))break}else if(r.handler())break}}},JSJaCConnection.prototype._handlePID=function(e){if(!e.id)return!1;var t=this.jid,n=e.id;if(this._regIDs[t]&&this._regIDs[t][n]){this.oDbg.log("handling id "+n,3);var r=this._regIDs[t][n];return!1!==r.cb.call(this,e,r.arg)&&(delete this._regIDs[t][n],!0)}return this.oDbg.log("not handling id '"+n+"' from jid "+t,1),!1},JSJaCConnection.prototype._handleResponse=function(e){var t=this._parseResponse(e);if(t){if(this._sendRawCallbacks.length){var n=this._sendRawCallbacks[0];this._sendRawCallbacks=this._sendRawCallbacks.slice(1,this._sendRawCallbacks.length),n.fn.call(this,t,n.arg)}this._inQ=this._inQ.concat(t)}},JSJaCConnection.prototype._parseStreamFeatures=function(e){if(!e)return this.oDbg.log("nothing to parse ... aborting",1),!1;var t,n;if(e.getElementsByTagNameNS)t=e.getElementsByTagNameNS(NS_STREAM,"error").item(0);else{var r=e.getElementsByTagName("error");for(n=0;n<r.length;n++)if(r.item(n).namespaceURI==NS_STREAM||r.item(n).getAttribute("xmlns")==NS_STREAM){t=r.item(n);break}}if(t)return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),!1;this.mechs={};var i=e.getElementsByTagName("mechanisms");if(!i.length)return!1;for(this.has_sasl=!1,n=0;n<i.length;n++)if(i.item(n).getAttribute("xmlns")==NS_SASL){this.has_sasl=!0;for(var o=i.item(n).getElementsByTagName("mechanism"),s=0;s<o.length;s++)this.mechs[o.item(s).firstChild.nodeValue]=!0;break}return this.has_sasl?this.oDbg.log("SASL detected",2):this.oDbg.log("No support for SASL detected",2),!0},JSJaCConnection.prototype._process=function(e){if(!this.connected())return this.oDbg.log("Connection lost ...",1),void(this._interval&&clearInterval(this._interval));this.setPollInterval(e),this._timeout&&clearTimeout(this._timeout);var t=this._getFreeSlot();if(!(t<0))if(void 0===this._req[t]||void 0===this._req[t].r||4==this._req[t].r.readyState)if(this.isPolling()||0!==this._pQueue.length||!this._req[(t+1)%2]||4==this._req[(t+1)%2].r.readyState){this.isPolling()||this.oDbg.log("Found working slot at "+t,2);var n=this._getRequestPacket();this._req[t]=n instanceof JumpPacket?this._setupJumpRequest(!0):this._setupRequest(!0),this._req[t].r.onreadystatechange=JSJaC.bind(function(){this.connected()&&4==this._req[t].r.readyState&&(this.oDbg.log("async recv: "+this._req[t].r.responseText,4),this._handleResponse(this._req[t]),this._setStatus("processing"),this._pQueue.length?this._timeout=setTimeout(JSJaC.bind(this._process,this),100):(this.oDbg.log("scheduling next poll in "+this.getPollInterval()+" msec",4),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())))},this);try{this._req[t].r.onerror=JSJaC.bind(function(){this.connected()&&(this._errcnt++,this.oDbg.log("XmlHttpRequest error ("+this._errcnt+")",1),this._errcnt>JSJAC_ERR_COUNT?this._abort():(this._setStatus("onerror_fallback"),setTimeout(JSJaC.bind(this._repeat,this),JSJAC_RETRYDELAY)))},this)}catch(e){}void 0!==this._rid&&(this._req[t].rid=this._rid),n instanceof JumpPacket?this._buildAndSend(n,this._req[t].r):this._req[t].r.send(n&&n.xml?n.xml:this._getRequestString())}else this.oDbg.log("all slots busy, standby ...",2);else this.oDbg.log("Slot "+t+" is not ready")},JSJaCConnection.prototype._registerPID=function(e,t,n){this.oDbg.log("registering id for packet "+JSON.stringify(e.content),3);var r=e.content.id;if(!r)return this.oDbg.log("id missing",1),!1;if("function"!=typeof t)return this.oDbg.log("callback is not a function",1),!1;var i=this.jid;return this._regIDs[i]||(this._regIDs[i]={}),null!=this._regIDs[i][r]?(this.oDbg.log("id already registered: "+r,1),!1):(this._regIDs[i][r]={cb:t,arg:n,ts:JSJaCUtils.now()},this.oDbg.log("registered id "+r,3),this._cleanupRegisteredPIDs(),!0)},JSJaCConnection.prototype._cleanupRegisteredPIDs=function(){var e=Date.now();for(var t in this._regIDs)if(this._regIDs.hasOwnProperty(t))for(var n in this._regIDs[t])this._regIDs[t].hasOwnProperty(n)&&this._regIDs[t][n].ts+JSJAC_REGID_TIMEOUT<e&&(this.oDbg.log("deleting registered id '"+n+"' due to timeout",1),delete this._regIDs[t][n])},JSJaCConnection.prototype._prepSendEmpty=function(e,t){return function(){t._sendEmpty(JSJaC.bind(e,t))}},JSJaCConnection.prototype._sendEmpty=function(e){var t=this._getFreeSlot();this._req[t]=this._setupRequest(!0),this._req[t].r.onreadystatechange=JSJaC.bind(function(){4==this._req[t].r.readyState&&(this.oDbg.log("async recv: "+this._req[t].r.responseText,4),e(this._req[t].r))},this),void 0!==this._req[t].r.onerror&&(this._req[t].r.onerror=JSJaC.bind(function(){this.oDbg.log("XmlHttpRequest error",1)},this));var n=this._getRequestString();this.oDbg.log("sending: "+n,4),this._req[t].r.send(n)},JSJaCConnection.prototype._sendJumpPacket=function(e,t,n){return t&&this._sendRawCallbacks.push({fn:t,arg:n}),this._pQueue.push(e),this._process(),!0},JSJaCConnection.prototype._sendRaw=function(e,t,n){return t&&this._sendRawCallbacks.push({fn:t,arg:n}),this._pQueue.push(e),this._process(),!0},JSJaCConnection.prototype._setStatus=function(e){e&&""!==e&&e!=this._status&&(this._status=e,this._handleEvent("onstatuschanged",e),this._handleEvent("status_changed",e))},JSJaCConnection.prototype._buildAndSend=function(e,t){var n,r=null==e.content||void 0===e.content,i=JSON.stringify(e.content);n=this._stringToBytes(i);var o,s=new Uint8Array(PACKET_HEADER_SIZE);s.set(this._numToBytes(e.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),s.set(this._numToBytes(e.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),r?s.set(this._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):s.set(this._numToBytes(n.length,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),s.set(this._numToBytes(e.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),s.set(this._numToBytes(e.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START);var a=arr2b64((o=r?s:this._concatUint8Array(s,new Uint8Array(n))).subarray(0,o.byteLength));t.send(a)},JSJaCConnection.prototype._validateCallbackable=function(e){return this._isIQPacket(e.opcode)||this._isMessagePacket(e.opcode)||this._isPresencePacket(e.opcode)},JSJaCConnection.prototype._isMessagePacket=function(e){return e>=OPCODE.MESSAGE_RANGE.START&&e<OPCODE.MESSAGE_RANGE.END},JSJaCConnection.prototype._isIQPacket=function(e){return e>=OPCODE.IQ_RANGE.START&&e<OPCODE.IQ_RANGE.END},JSJaCConnection.prototype._isPresencePacket=function(e){return e>=OPCODE.PRESENCE_RANGE.START&&e<OPCODE.PRESENCE_RANGE.END},JSJaCConnection.prototype._concatUint8Array=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},JSJaCConnection.prototype._numToBytes=function(e,t){for(var n=new Uint8Array(t),r=t;n[--r]=255&e,e>>=8,r;);return n},JSJaCConnection.prototype._uint8ArrayToString=function(e){var t,n,r,i,o,s;for(t="",r=e.length,n=0;n<r;)switch((i=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:o=e[n++],t+=String.fromCharCode((31&i)<<6|63&o);break;case 14:o=e[n++],s=e[n++],t+=String.fromCharCode((15&i)<<12|(63&o)<<6|(63&s)<<0)}return t},JSJaCConnection.prototype._bytesToInteger=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n],n<e.length-1&&(t<<=8);return t},JSJaCConnection.prototype._stringToBytes=function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||57344<=r?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t},JSJaCConnection.prototype._getAuthPacket=function(){var e={usr:this.username,atk:this.pass,br:this.resource};return this.appType&&(e.appType=this.appType),this.clientIdentify&&(e.clientIdentify=this.clientIdentify),new JumpPacket(e,OPCODE.AUTH.SEND)};var NS_ORGANIZATION="http://jabber.org/protocol/org",NS_DISCO_ITEMS="http://jabber.org/protocol/disco#items",NS_DISCO_INFO="http://jabber.org/protocol/disco#info",NS_VCARD="vcard-temp",NS_VCARD_UPDATE="vcard-temp:x:update",NS_AUTH="jabber:iq:auth",NS_AUTH_ERROR="jabber:iq:auth:error",NS_REGISTER="jabber:iq:register",NS_SEARCH="jabber:iq:search",NS_ROSTER="jabber:iq:roster",NS_PUBACCOUNT="jabber:iq:pubaccount",NS_PRIVACY="jabber:iq:privacy",NS_PRIVATE="jabber:iq:private",NS_VERSION="jabber:iq:version",NS_TIME="jabber:iq:time",NS_TIME_NEW="urn:xmpp:time",NS_LAST="jabber:iq:last",NS_XDATA="jabber:x:data",NS_IQDATA="jabber:iq:data",NS_DELAY="jabber:x:delay",NS_DELAY_NEW="urn:xmpp:delay",NS_RECEIPTS="urn:xmpp:receipts",NS_EXPIRE="jabber:x:expire",NS_EVENT="jabber:x:event",NS_XCONFERENCE="jabber:x:conference",NS_PING="urn:xmpp:ping",NS_BOOKSMARKS="storage:bookmarks",NS_FORWARD_0="urn:xmpp:forward:0",NS_CARBONS_2="urn:xmpp:carbons:2",NS_CHAT_STATES="http://jabber.org/protocol/chatstates",NS_STATS="http://jabber.org/protocol/stats",NS_MUC="http://jabber.org/protocol/muc",NS_MUC_USER="http://jabber.org/protocol/muc#user",NS_MUC_ADMIN="http://jabber.org/protocol/muc#admin",NS_MUC_OWNER="http://jabber.org/protocol/muc#owner",NS_PUBSUB="http://jabber.org/protocol/pubsub",NS_PUBSUB_EVENT="http://jabber.org/protocol/pubsub#event",NS_PUBSUB_OWNER="http://jabber.org/protocol/pubsub#owner",NS_PUBSUB_ERRORS="http://jabber.org/protocol/pubsub#errors",NS_PUBSUB_NMI="http://jabber.org/protocol/pubsub#node-meta-info",NS_COMMANDS="http://jabber.org/protocol/commands",NS_CAPS="http://jabber.org/protocol/caps",NS_STREAM="http://etherx.jabber.org/streams",NS_CLIENT="jabber:client",NS_BOSH="http://jabber.org/protocol/httpbind",NS_XBOSH="urn:xmpp:xbosh",NS_STANZAS="urn:ietf:params:xml:ns:xmpp-stanzas",NS_STREAMS="urn:ietf:params:xml:ns:xmpp-streams",NS_TLS="urn:ietf:params:xml:ns:xmpp-tls",NS_SASL="urn:ietf:params:xml:ns:xmpp-sasl",NS_SESSION="urn:ietf:params:xml:ns:xmpp-session",NS_BIND="urn:ietf:params:xml:ns:xmpp-bind",NS_FEATURE_IQAUTH="http://jabber.org/features/iq-auth",NS_FEATURE_IQREGISTER="http://jabber.org/features/iq-register",NS_FEATURE_COMPRESS="http://jabber.org/features/compress",NS_COMPRESS="http://jabber.org/protocol/compress";function STANZA_ERROR(e,t,n){if(window==this)return new STANZA_ERROR(e,t,n);this.code=e,this.type=t,this.cond=n}var ERR_BAD_REQUEST=STANZA_ERROR("400","modify","bad-request"),ERR_CONFLICT=STANZA_ERROR("409","cancel","conflict"),ERR_FEATURE_NOT_IMPLEMENTED=STANZA_ERROR("501","cancel","feature-not-implemented"),ERR_FORBIDDEN=STANZA_ERROR("403","auth","forbidden"),ERR_GONE=STANZA_ERROR("302","modify","gone"),ERR_INTERNAL_SERVER_ERROR=STANZA_ERROR("500","wait","internal-server-error"),ERR_ITEM_NOT_FOUND=STANZA_ERROR("404","cancel","item-not-found"),ERR_JID_MALFORMED=STANZA_ERROR("400","modify","jid-malformed"),ERR_NOT_ACCEPTABLE=STANZA_ERROR("406","modify","not-acceptable"),ERR_NOT_ALLOWED=STANZA_ERROR("405","cancel","not-allowed"),ERR_NOT_AUTHORIZED=STANZA_ERROR("401","auth","not-authorized"),ERR_PAYMENT_REQUIRED=STANZA_ERROR("402","auth","payment-required"),ERR_RECIPIENT_UNAVAILABLE=STANZA_ERROR("404","wait","recipient-unavailable"),ERR_REDIRECT=STANZA_ERROR("302","modify","redirect"),ERR_REGISTRATION_REQUIRED=STANZA_ERROR("407","auth","registration-required"),ERR_REMOTE_SERVER_NOT_FOUND=STANZA_ERROR("404","cancel","remote-server-not-found"),ERR_REMOTE_SERVER_TIMEOUT=STANZA_ERROR("504","wait","remote-server-timeout"),ERR_RESOURCE_CONSTRAINT=STANZA_ERROR("500","wait","resource-constraint"),ERR_SERVICE_UNAVAILABLE=STANZA_ERROR("503","cancel","service-unavailable"),ERR_SUBSCRIPTION_REQUIRED=STANZA_ERROR("407","auth","subscription-required"),ERR_UNEXPECTED_REQUEST=STANZA_ERROR("400","wait","unexpected-request");function JSJaCCookieException(e){this.message=e,this.name="CookieException"}function JSJaCCookie(e,t,n,r,i){if(window==this)return new JSJaCCookie(e,t,n,r,i);this.name=e,this.value=t,this.secs=n,this.domain=r,this.path=i,this.write=function(){var e;if(this.secs){var t=new Date;t.setTime(t.getTime()+1e3*this.secs),e="; expires="+t.toGMTString()}else e="";var n=this.domain?"; domain="+this.domain:"",r=this.path?"; path="+this.path:"; path=/";document.cookie=this.getName()+"="+JSJaCCookie._escape(this.getValue())+e+n+r},this.erase=function(){new JSJaCCookie(this.getName(),"",-1).write()},this.getName=function(){return this.name},this.setName=function(e){return this.name=e,this},this.getValue=function(){return this.value},this.setValue=function(e){return this.value=e,this},this.setDomain=function(e){return this.domain=e,this},this.setPath=function(e){return this.path=e,this}}function JSJaCDebugger(){}function JSJaCError(e,t,n){var r=XmlDocument.create("error","jsjac");return r.documentElement.setAttribute("code",e),r.documentElement.setAttribute("type",t),n&&r.documentElement.appendChild(r.createElement(n)).setAttribute("xmlns",NS_STANZAS),r.documentElement}function JSJaCHttpBindingConnection(e){this.base=JSJaCConnection,this.base(e),this._hold=JSJACHBC_MAX_HOLD,this._inactivity=0,this._last_requests={},this._last_rid=0,this._min_polling=0,this._pause=0,this._wait=e.wait||JSJACHBC_MAX_WAIT,function(){try{new Uint8Array(1);return}catch(e){}function r(e,t){return this.slice(e,t)}function i(e,t){arguments.length<2&&(t=0);for(var n=0,r=e.length;n<r;++n,++t)this[t]=255&e[n]}function e(e){var t;if("number"==typeof e){t=new Array(e);for(var n=0;n<e;++n)t[n]=0}else t=e.slice(0);return t.subarray=r,(t.buffer=t).byteLength=t.length,t.set=i,"object"==typeof e&&e.buffer&&(t.buffer=e.buffer),t}window.Uint8Array=e,window.Uint32Array=e,window.Int32Array=e}()}function JSJaCHttpPollingConnection(e){this.base=JSJaCConnection,this.base(e),JSJACPACKET_USE_XMLNS=!1}function JSJaCJIDInvalidException(e){this.message=e,this.name="JSJaCJIDInvalidException"}JSJaCCookie.read=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return new JSJaCCookie(e,JSJaCCookie._unescape(i.substring(t.length,i.length)))}throw new JSJaCCookieException("Cookie not found")},JSJaCCookie.get=function(e){return JSJaCCookie.read(e).getValue()},JSJaCCookie.remove=function(e){JSJaCCookie.read(e).erase()},JSJaCCookie._escape=function(e){return e.replace(/;/g,"%3AB")},JSJaCCookie._unescape=function(e){return e.replace(/%3AB/g,";")},JSJaCDebugger.prototype.log=function(e,t){},JSJaCHttpBindingConnection.prototype=new JSJaCConnection,JSJaCHttpBindingConnection.prototype.inherit=function(e){if(e.jid){var t=new JSJaCJID(e.jid);this.domain=t.getDomain(),this.username=t.getNode(),this.resource=t.getResource()}else this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource;this._sid=e.sid,this._rid=e.rid,this._min_polling=e.polling,this._inactivity=e.inactivity,this._setHold(e.requests-1),this.setPollInterval(this._timerval),e.wait&&(this._wait=e.wait),this._connected=!0,this._handleEvent("onconnect"),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval())},JSJaCHttpBindingConnection.prototype.setPollInterval=function(e){return e&&!isNaN(e)&&(this.isPolling()?this._min_polling&&e<1e3*this._min_polling?this._timerval=1e3*this._min_polling:this._inactivity&&e>1e3*this._inactivity?this._timerval=1e3*this._inactivity:this._timerval=e:this._timerval=100),this._timerval},JSJaCHttpBindingConnection.prototype.isPolling=function(){return 0===this._hold},JSJaCHttpBindingConnection.prototype._getFreeSlot=function(){for(var e=0;e<this._hold+1;e++)if(void 0===this._req[e]||void 0===this._req[e].r||4==this._req[e].r.readyState)return e;return-1},JSJaCHttpBindingConnection.prototype._getHold=function(){return this._hold},JSJaCHttpBindingConnection.prototype._getRequestPacket=function(e,t){var n;if(this._rid<this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid];else for(var r in this._pQueue.length&&(n=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)),this._last_requests[this._rid]={},this._last_requests[this._rid]=n,this._last_rid=this._rid,this._last_requests)this._last_requests.hasOwnProperty(r)&&r<this._rid-this._hold&&delete this._last_requests[r];return n},JSJaCHttpBindingConnection.prototype._getRequestString=function(e,t){e=e||"";var n="";if(this._rid<=this._last_rid&&void 0!==this._last_requests[this._rid])n=this._last_requests[this._rid].xml;else{for(var r="";this._pQueue.length;){r+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}for(var i in n="<body rid='"+this._rid+"' sid='"+this._sid+"' xmlns='http://jabber.org/protocol/httpbind'",JSJAC_HAVEKEYS&&(n+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),n+=" newkey='"+this._keys.getKey()+"'")),t?n+=" type='terminate'":this._reinit&&(JSJACHBC_USE_BOSH_VER&&(n+=" xml:lang='"+this._xmllang+"' xmpp:restart='true' xmlns:xmpp='urn:xmpp:xbosh' to='"+this.domain+"'"),this._reinit=!1),n+=""!==r||""!==e?">"+e+r+"</body>":"/>",this._last_requests[this._rid]={},this._last_requests[this._rid].xml=n,this._last_rid=this._rid,this._last_requests)this._last_requests.hasOwnProperty(i)&&i<this._rid-this._hold&&delete this._last_requests[i]}return n},JSJaCHttpBindingConnection.prototype._getInitialRequestString=function(){var e="<body content='text/xml; charset=utf-8' hold='"+this._hold+"' xmlns='http://jabber.org/protocol/httpbind' to='"+this.authhost+"' wait='"+this._wait+"' rid='"+this._rid+"'";(this.host&&this.port&&(e+=" route='xmpp:"+this.host+":"+this.port+"'"),JSJAC_HAVEKEYS)&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),e+=" newkey='"+this._keys.getKey()+"'");return e+=" xml:lang='"+this._xmllang+"'",JSJACHBC_USE_BOSH_VER&&(e+=" ver='"+JSJACHBC_BOSH_VERSION+"'",e+=" xmlns:xmpp='urn:xmpp:xbosh'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(e+=" xmpp:version='1.0'")),e+="/>"},JSJaCHttpBindingConnection.prototype._getStreamID=function(e){if(this.oDbg.log(e.responseText,4),e.responseXML&&e.responseXML.documentElement){var t=e.responseXML.documentElement;"terminate"!=t.getAttribute("type")?(t.getAttribute("authid")&&(this.streamid=t.getAttribute("authid"),this.oDbg.log("got streamid: "+this.streamid,2)),this._parseStreamFeatures(t)?(this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval()),this.register?this._doInBandReg():this._doAuth()):this._sendEmpty(JSJaC.bind(this._getStreamID,this))):this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))}else this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCHttpBindingConnection.prototype._getSuspendVars=function(){return"host,port,_rid,_last_rid,_wait,_min_polling,_inactivity,_hold,_last_requests,_pause".split(",")},JSJaCHttpBindingConnection.prototype._handleInitialResponse=function(e){try{this.oDbg.log(e.getAllResponseHeaders(),4),this.oDbg.log(e.responseText,4)}catch(e){this.oDbg.log("No response",4)}if(200!=e.status||!e.responseXML)return this.oDbg.log("initial response broken (status: "+e.status+")",1),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));var t=e.responseXML.documentElement;return t&&"body"==t.tagName&&t.namespaceURI==NS_BOSH?"terminate"==t.getAttribute("type")?(this.oDbg.log("invalid response:\n"+e.responseText,1),clearTimeout(this._timeout),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),void this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))):(this._sid=t.getAttribute("sid"),this.oDbg.log("got sid: "+this._sid,2),t.getAttribute("polling")&&(this._min_polling=t.getAttribute("polling")),t.getAttribute("inactivity")&&(this._inactivity=t.getAttribute("inactivity")),t.getAttribute("requests")&&this._setHold(t.getAttribute("requests")-1),this.oDbg.log("set hold to "+this._getHold(),2),t.getAttribute("ver")&&(this._bosh_version=t.getAttribute("ver")),t.getAttribute("maxpause")&&(this._pause=Number.min(t.getAttribute("maxpause"),JSJACHBC_MAXPAUSE)),this.setPollInterval(this._timerval),this._connected=!0,this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),void this._getStreamID(e)):(this.oDbg.log("no body element or incorrect body in initial response",1),void this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error")))},JSJaCHttpBindingConnection.prototype._parseResponse=function(e){if(!this.connected()||!e)return null;var t=e.r;try{if(404==t.status||403==t.status)return this._abort(),null;if(200!=t.status||!t.responseText&&""!=t.responseText){this._errcnt++;var n="invalid response ("+t.status+"):\n"+t.getAllResponseHeaders()+"\n"+t.responseText;return t.responseXML||(n+="\nResponse failed to parse!"),this.oDbg.log(n,1),this._errcnt>JSJAC_ERR_COUNT?(this._abort(),null):(this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null)}}catch(e){return this.oDbg.log("XMLHttpRequest error: status not available",1),this._errcnt++,this._errcnt>JSJAC_ERR_COUNT?this._abort():this.connected()&&(this.oDbg.log("repeating ("+this._errcnt+")",1),this._setStatus("proto_error_fallback"),setTimeout(JSJaC.bind(this._repeat,this),this.getPollInterval())),null}for(var r="<"==t.responseText[0]?t.responseText:b64decode(t.responseText),i=[],o=0,s=r.length;o<PACKET_HEADER_SIZE&&PACKET_HEADER_SIZE<=s;o++)i[o]=r.charCodeAt(o);var a=new Uint8Array(i).subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),c=OPCODE_MAP.RECV.get(this._bytesToInteger(a)),u=r.slice(PACKET_HEADER_SIZE);if(void 0!==e.rid&&this._last_requests[e.rid]){if(this._last_requests[e.rid].handled)return this.oDbg.log("already handled "+e.rid,2),null;this._last_requests[e.rid].handled=!0}return this._errcnt=0,c?{event:c,body:u?JSON.parse(0==u.indexOf("{")?u:"{"+u):null}:null},JSJaCHttpBindingConnection.prototype._reInitStream=function(e){this._reinit=!0,this._sendEmpty(this._prepReInitStreamWait(e))},JSJaCHttpBindingConnection.prototype._prepReInitStreamWait=function(t){return JSJaC.bind(function(e){this._reInitStreamWait(e,t)},this)},JSJaCHttpBindingConnection.prototype._reInitStreamWait=function(e,t){this.oDbg.log("checking for stream features");var n,r,i=e.responseXML.documentElement;if(this.oDbg.log(i),i.getElementsByTagNameNS)this.oDbg.log("checking with namespace"),(n=i.getElementsByTagNameNS(NS_STREAM,"features").item(0))&&(r=n.getElementsByTagNameNS(NS_BIND,"bind").item(0));else{var o,s,a=i.getElementsByTagName("stream:features");for(o=0,s=a.length;o<s;o++)if(a.item(o).namespaceURI==NS_STREAM||a.item(o).getAttribute("xmlns")==NS_STREAM){n=a.item(o);break}if(n)for(o=0,s=(r=n.getElementsByTagName("bind")).length;o<s;o++)if(r.item(o).namespaceURI==NS_BIND||r.item(o).getAttribute("xmlns")==NS_BIND){r=r.item(o);break}}this.oDbg.log(n),this.oDbg.log(r),n?r?t():(this.oDbg.log("no bind feature - giving up",1),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this._sendEmpty(this._prepReInitStreamWait(t))},JSJaCHttpBindingConnection.prototype._repeat=function(){this._rid>=this._last_rid&&(this._rid=this._last_rid-1),this._process()},JSJaCHttpBindingConnection.prototype._resume=function(){0===this._pause?this._repeat():this._process()},JSJaCHttpBindingConnection.prototype._setHold=function(e){return!e||isNaN(e)||e<0?e=0:e>JSJACHBC_MAX_HOLD&&(e=JSJACHBC_MAX_HOLD),this._hold=e,this._hold},JSJaCHttpBindingConnection.prototype._setupJumpRequest=function(e){var t={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase+"?rid="+this._rid+"&sid="+this._sid+"&useBase64=1",e),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(e){this.oDbg.log(e,1)}return t.r=n,t.rid=this._rid,t},JSJaCHttpBindingConnection.prototype._setupRequest=function(e){var t={},n=XmlHttp.create();this._rid++;try{n.open("POST",this._httpbase,e),n.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(e){this.oDbg.log(e,1)}return t.r=n,t.rid=this._rid,t},JSJaCHttpBindingConnection.prototype._suspend=function(){if(0!==this._pause){var e=this._getFreeSlot();this._req[e]=this._setupRequest(!1);var t="<body pause='"+this._pause+"' xmlns='http://jabber.org/protocol/httpbind' sid='"+this._sid+"' rid='"+this._rid+"'";for(JSJAC_HAVEKEYS&&(t+=" key='"+this._keys.getKey()+"'",this._keys.lastKey()&&(this._keys=new JSJaCKeys(hex_sha1,this.oDbg),t+=" newkey='"+this._keys.getKey()+"'")),t+=">";this._pQueue.length;){t+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length)}t+="</body>",this.oDbg.log("Disconnecting: "+t,4),this._req[e].r.send(t)}},JSJaCHttpPollingConnection.prototype=new JSJaCConnection,JSJaCHttpPollingConnection.prototype.isPolling=function(){return!0},JSJaCHttpPollingConnection.prototype._getFreeSlot=function(){return void 0===this._req[0]||void 0===this._req[0].r||4==this._req[0].r.readyState?0:-1},JSJaCHttpPollingConnection.prototype._getInitialRequestString=function(){var e="0";JSJAC_HAVEKEYS&&(this._keys=new JSJaCKeys(b64_sha1,this.oDbg),e+=";"+this._keys.getKey());var t=this.domain;return this.authhost&&(t=this.authhost),e+=",<stream:stream to='"+t+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'","sasl"!=this.authtype&&"saslanon"!=this.authtype||(e+=" version='1.0'"),e+=">"},JSJaCHttpPollingConnection.prototype._getRequestString=function(e,t){var n=this._sid;for(JSJAC_HAVEKEYS&&(n+=";"+this._keys.getKey(),this._keys.lastKey()&&(this._keys=new JSJaCKeys(b64_sha1,this.oDbg),n+=";"+this._keys.getKey())),n+=",",e&&(n+=e);this._pQueue.length;)n+=this._pQueue[0],this._pQueue=this._pQueue.slice(1,this._pQueue.length);return t&&(n+="</stream:stream>"),n},JSJaCHttpPollingConnection.prototype._getStreamID=function(){if(""===this._req[0].r.responseText)return this.oDbg.log("waiting for stream id",2),void(this._timeout=setTimeout(JSJaC.bind(this._sendEmpty,this),1e3));var e;this.oDbg.log(this._req[0].r.responseText,4),this._req[0].r.responseText.match(/id=[\'\"]([^\'\"]+)[\'\"]/)&&(this.streamid=RegExp.$1),this.oDbg.log("got streamid: "+this.streamid,2);try{var t=this._req[0].r.responseText;if(t.match(/<\/stream:stream>\s*$/)||(t+="</stream:stream>"),(e=XmlDocument.create("doc")).loadXML(t),!this._parseStreamFeatures(e))return void(this.authtype="nonsasl")}catch(e){this.oDbg.log("loadXML: "+e.toString(),1)}this._connected=!0,this.register?this._doInBandReg():this._doAuth(),this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._getSuspendVars=function(){return[]},JSJaCHttpPollingConnection.prototype._handleInitialResponse=function(){this.oDbg.log(this._req[0].r.getAllResponseHeaders(),4);var e=this._req[0].r.getResponseHeader("Set-Cookie");e=e.split(";");for(var t=0;t<e.length;t++){var n=e[t].split("=");"ID"==n[0]&&(this._sid=n[1])}this.oDbg.log("got sid: "+this._sid,2),this._connected=!0,this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL),this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL),this._getStreamID()},JSJaCHttpPollingConnection.prototype._parseResponse=function(e){var t=e.r;if(!this.connected())return null;if(200!=t.status)return this.oDbg.log("invalid response ("+t.status+"):"+t.responseText+"\n"+t.getAllResponseHeaders(),1),this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")),null;this.oDbg.log(t.getAllResponseHeaders(),4);var n,r=t.getResponseHeader("Set-Cookie");if(null===r)n="-1:0";else{r=r.split(";");for(var i=0;i<r.length;i++){var o=r[i].split("=");"ID"==o[0]&&(n=o[1])}}if(void 0!==n&&-1!=n.indexOf(":0")){switch(n.substring(0,n.indexOf(":0"))){case"0":this.oDbg.log("invalid response:"+t.responseText,1);break;case"-1":this.oDbg.log("Internal Server Error",1);break;case"-2":this.oDbg.log("Bad Request",1);break;case"-3":this.oDbg.log("Key Sequence Error",1)}return this._setStatus("internal_server_error"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("500","wait","internal-server-error")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}if(!t.responseText)return null;try{var s=t.responseText.replace(/<\?xml.+\?>/,"");s.match(/<stream:stream/)&&(s+="</stream:stream>");var a=JSJaCHttpPollingConnection._parseTree("<body>"+s+"</body>");return a&&"parsererror"!=a.tagName||(this.oDbg.log("parsererror",1),(a=JSJaCHttpPollingConnection._parseTree("<stream:stream xmlns:stream='http://etherx.jabber.org/streams'>"+t.responseText))&&"parsererror"!=a.tagName?(this.oDbg.log("stream closed",1),0<a.getElementsByTagName("conflict").length&&this._setStatus("session-terminate-conflict"),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto),this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this._connected=!1,this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect")):this.oDbg.log("parsererror:"+a,1)),a}catch(e){this.oDbg.log("parse error:"+e.message,1)}return null},JSJaCHttpPollingConnection.prototype._reInitStream=function(e){var t=this.authhost?this.authhost:this.domain;this._sendRaw("<stream:stream xmlns:stream='http://etherx.jabber.org/streams' xmlns='jabber:client' to='"+t+"' version='1.0'>",e)},JSJaCHttpPollingConnection.prototype._repeat=function(){this._resume()},JSJaCHttpPollingConnection.prototype._resume=function(){this._process(this._timerval)},JSJaCHttpPollingConnection.prototype._setupRequest=function(e){var t=XmlHttp.create();try{t.open("POST",this._httpbase,e),t.overrideMimeType&&t.overrideMimeType("text/plain; charset=utf-8"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){this.oDbg.log(e,1)}var n={};return n.r=t,n},JSJaCHttpPollingConnection.prototype._suspend=function(){},JSJaCHttpPollingConnection._parseTree=function(e){try{var t=XmlDocument.create("body","foo");if(void 0!==t.loadXML)return t.loadXML(e),t.documentElement;if(window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml").documentElement}catch(e){}return null};var JSJACJID_FORBIDDEN=['"'," ","&","'","/",":","<",">","@"];function JSJaCJID(e){this._node="",this._domain="",this._resource="","string"==typeof e?(-1!=e.indexOf("@")&&(this.setNode(e.substring(0,e.indexOf("@"))),e=e.substring(e.indexOf("@")+1)),-1!=e.indexOf("/")&&(this.setResource(e.substring(e.indexOf("/")+1)),e=e.substring(0,e.indexOf("/"))),this.setDomain(e)):(this.setNode(e.node),this.setDomain(e.domain),this.setResource(e.resource))}function JSJaCJSON(){}function JSJaCKeys(e,t){var n=Math.random();if(this._k=[],this._k[0]=n.toString(),t?this.oDbg=t:(this.oDbg={},this.oDbg.log=function(){}),e)for(var r=1;r<JSJAC_NKEYS;r++)this._k[r]=e(this._k[r-1]),t.log(r+": "+this._k[r],4);this._indexAt=JSJAC_NKEYS-1,this.getKey=function(){return this._k[this._indexAt--]},this.lastKey=function(){return 0===this._indexAt},this.size=function(){return this._k.length},this._getSuspendVars=function(){return"_k,_indexAt".split(",")}}JSJaCJID.prototype.getBareJID=function(){return this.getNode()+"@"+this.getDomain()},JSJaCJID.prototype.getNode=function(){return this._node},JSJaCJID.prototype.getDomain=function(){return this._domain},JSJaCJID.prototype.getResource=function(){return this._resource},JSJaCJID.prototype.setNode=function(e){return JSJaCJID._checkNodeName(e),this._node=e||"",this},JSJaCJID.prototype.setDomain=function(e){if(!e||""===e)throw new JSJaCJIDInvalidException("domain name missing");return JSJaCJID._checkNodeName(e),this._domain=e,this},JSJaCJID.prototype.setResource=function(e){return this._resource=e||"",this},JSJaCJID.prototype.toString=function(){var e="";return this.getNode()&&""!==this.getNode()&&(e=this.getNode()+"@"),e+=this.getDomain(),this.getResource()&&""!==this.getResource()&&(e+="/"+this.getResource()),e},JSJaCJID.prototype.removeResource=function(){return this.setResource()},JSJaCJID.prototype.clone=function(){return new JSJaCJID(this.toString())},JSJaCJID.prototype.isEntity=function(e){return(e="string"==typeof e?new JSJaCJID(e):e.clone()).removeResource(),this.clone().removeResource().toString()===e.toString()},JSJaCJID._checkNodeName=function(e){if(e&&""!==e)for(var t=0;t<JSJACJID_FORBIDDEN.length;t++)if(-1!=e.indexOf(JSJACJID_FORBIDDEN[t]))throw new JSJaCJIDInvalidException("forbidden char in nodename: "+JSJACJID_FORBIDDEN[t])},JSJaCJSON.toString=function(e){var r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a={array:function(e){var t,n,r,i,o=["["],s=e.length;for(r=0;r<s;r+=1)if(i=e[r],n=a[typeof i])try{"string"==typeof(i=n(i))&&(t&&(o[o.length]=","),o[o.length]=i,t=!0)}catch(e){}return o[o.length]="]",o.join("")},boolean:function(e){return String(e)},null:function(){return"null"},number:function(e){return isFinite(e)?String(e):"null"},object:function(e){if(e){if(e instanceof Array)return a.array(e);var t,n,r,i,o=[];for(r in o.push("{"),e)if(e.hasOwnProperty(r)&&(i=e[r],n=a[typeof i]))try{"string"==typeof(i=n(i))&&(t&&(o[o.length]=","),o.push(a.string(r),":",i),t=!0)}catch(e){}return o[o.length]="}",o.join("")}return"null"},string:function(e){return/["\\\x00-\x1f]/.test(e)&&(e=e.replace(/([\x00-\x1f\\"])/g,function(e,t){var n=r[t];return n||(n=t.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})),'"'+e+'"'}};switch(typeof e){case"object":return a.object(e);case"array":return a.array(e)}},JSJaCJSON.parse=function(str){try{return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+str+")")}catch(e){return!1}};var JSJACPACKET_USE_XMLNS=!0;function JSJaCPacket(e){this.name=e,this.doc=void 0!==JSJACPACKET_USE_XMLNS&&JSJACPACKET_USE_XMLNS?XmlDocument.create(e,NS_CLIENT):XmlDocument.create(e,"")}function JSJaCPresence(){this.base=JSJaCPacket,this.base("presence")}function JSJaCIQ(){this.base=JSJaCPacket,this.base("iq")}function JSJaCMessage(){this.base=JSJaCPacket,this.base("message")}JSJaCPacket.prototype.pType=function(){return this.name},JSJaCPacket.prototype.getDoc=function(){return this.doc},JSJaCPacket.prototype.getNode=function(){return this.getDoc()&&this.getDoc().documentElement?this.getDoc().documentElement:null},JSJaCPacket.prototype.setTo=function(e){return e?"string"==typeof e?this.getNode().setAttribute("to",e):this.getNode().setAttribute("to",e.toString()):this.getNode().removeAttribute("to"),this},JSJaCPacket.prototype.setFrom=function(e){return e?"string"==typeof e?this.getNode().setAttribute("from",e):this.getNode().setAttribute("from",e.toString()):this.getNode().removeAttribute("from"),this},JSJaCPacket.prototype.setID=function(e){return e?this.getNode().setAttribute("id",e):this.getNode().removeAttribute("id"),this},JSJaCPacket.prototype.setType=function(e){return e?this.getNode().setAttribute("type",e):this.getNode().removeAttribute("type"),this},JSJaCPacket.prototype.setXMLLang=function(e){return e?this.getNode().setAttribute("xml:lang",e):this.getNode().removeAttribute("xml:lang"),this},JSJaCPacket.prototype.getTo=function(){return this.getNode().getAttribute("to")},JSJaCPacket.prototype.getFrom=function(){return this.getNode().getAttribute("from")},JSJaCPacket.prototype.getToJID=function(){return new JSJaCJID(this.getTo())},JSJaCPacket.prototype.getFromJID=function(){return new JSJaCJID(this.getFrom())},JSJaCPacket.prototype.getID=function(){return this.getNode().getAttribute("id")},JSJaCPacket.prototype.getType=function(){return this.getNode().getAttribute("type")},JSJaCPacket.prototype.getXMLLang=function(){return this.getNode().getAttribute("xml:lang")},JSJaCPacket.prototype.getXMLNS=function(){return this.getNode().namespaceURI||this.getNode().getAttribute("xmlns")},JSJaCPacket.prototype.getChild=function(e,t){if(!this.getNode())return null;if(e=e||"*",t=t||"*",this.getNode().getElementsByTagNameNS)return this.getNode().getElementsByTagNameNS(t,e).item(0);var n=this.getNode().getElementsByTagName(e);if("*"==t)return n.item(0);for(var r=0;r<n.length;r++)if(n.item(r).namespaceURI==t||n.item(r).getAttribute("xmlns")==t)return n.item(r);return null},JSJaCPacket.prototype.getChildVal=function(e,t){var n=this.getChild(e,t),r="";if(n&&n.hasChildNodes())for(var i=0;i<n.childNodes.length;i++)n.childNodes.item(i).nodeValue&&(r+=n.childNodes.item(i).nodeValue);return r},JSJaCPacket.prototype.clone=function(){return JSJaCPacket.wrapNode(this.getNode())},JSJaCPacket.prototype.isError=function(){return"error"==this.getType()},JSJaCPacket.prototype.errorReply=function(e){var t=this.clone();return t.setTo(this.getFrom()),t.setFrom(),t.setType("error"),t.appendNode("error",{code:e.code,type:e.type},[[e.cond,{xmlns:NS_STANZAS}]]),t},JSJaCPacket.prototype.xml="undefined"!=typeof XMLSerializer?function(){var e=(new XMLSerializer).serializeToString(this.getNode());return void 0===e&&(e=(new XMLSerializer).serializeToString(this.doc)),e}:function(){return this.getDoc().xml},JSJaCPacket.prototype._getAttribute=function(e){return this.getNode().getAttribute(e)},document.ELEMENT_NODE||(document.ELEMENT_NODE=1,document.ATTRIBUTE_NODE=2,document.TEXT_NODE=3,document.CDATA_SECTION_NODE=4,document.ENTITY_REFERENCE_NODE=5,document.ENTITY_NODE=6,document.PROCESSING_INSTRUCTION_NODE=7,document.COMMENT_NODE=8,document.DOCUMENT_NODE=9,document.DOCUMENT_TYPE_NODE=10,document.DOCUMENT_FRAGMENT_NODE=11,document.NOTATION_NODE=12),JSJaCPacket.prototype._importNode=function(e,t){switch(e.nodeType){case document.ELEMENT_NODE:var n,r,i;if(n=this.getDoc().createElementNS?this.getDoc().createElementNS(e.namespaceURI,e.nodeName):this.getDoc().createElement(e.nodeName),e.attributes&&0<e.attributes.length)for(r=0,i=e.attributes.length;r<i;r++){var o=e.attributes.item(r);("xmlns"!=o.nodeName||null===n.getAttribute("xmlns")&&!n.namespaceURI)&&(n.setAttributeNS&&o.namespaceURI?n.setAttributeNS(o.namespaceURI,o.name,o.value):n.setAttribute(o.name,o.value))}if(t&&e.childNodes&&0<e.childNodes.length)for(r=0,i=e.childNodes.length;r<i;r++)n.appendChild(this._importNode(e.childNodes.item(r),t));return n;case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return this.getDoc().createTextNode(e.nodeValue)}},JSJaCPacket.prototype._setChildNode=function(t,e){var n=this.getChild(t),r=this.getDoc().createTextNode(e);if(n)try{n.replaceChild(r,n.firstChild)}catch(e){}else{try{n=this.getDoc().createElementNS(this.getNode().namespaceURI,t)}catch(e){n=this.getDoc().createElement(t)}this.getNode().appendChild(n),n.appendChild(r)}return n},JSJaCPacket.prototype.buildNode=function(e){return JSJaCBuilder.buildNode(this.getDoc(),e,arguments[1],arguments[2],arguments[3])},JSJaCPacket.prototype.appendNode=function(e){return"object"==typeof e?this.getNode().appendChild(e):this.getNode().appendChild(this.buildNode(e,arguments[1],arguments[2],this.getNode().namespaceURI)),this},JSJaCPresence.prototype=new JSJaCPacket,JSJaCPresence.prototype.setStatus=function(e){return this._setChildNode("status",e),this},JSJaCPresence.prototype.setShow=function(e){return"chat"!=e&&"away"!=e&&"xa"!=e&&"dnd"!=e&&"unavailable"!=e||this._setChildNode("show",e),this},JSJaCPresence.prototype.setPriority=function(e){return this._setChildNode("priority",e),this},JSJaCPresence.prototype.setPresence=function(e,t,n){return e&&this.setShow(e),t&&this.setStatus(t),n&&this.setPriority(n),this},JSJaCPresence.prototype.getStatus=function(){return this.getChildVal("status")},JSJaCPresence.prototype.getShow=function(){return this.getChildVal("show")},JSJaCPresence.prototype.getPriority=function(){return this.getChildVal("priority")},JSJaCIQ.prototype=new JSJaCPacket,JSJaCIQ.prototype.setIQ=function(e,t,n){return e&&this.setTo(e),t&&this.setType(t),n&&this.setID(n),this},JSJaCIQ.prototype.setQuery=function(t){var n;try{n=this.getDoc().createElementNS(t,"query")}catch(e){(n=this.getDoc().createElement("query")).setAttribute("xmlns",t)}return this.getNode().appendChild(n),n},JSJaCIQ.prototype.getQuery=function(){return this.getNode().getElementsByTagName("query").item(0)},JSJaCIQ.prototype.getQueryXMLNS=function(){return this.getQuery()?this.getQuery().namespaceURI||this.getQuery().getAttribute("xmlns"):null},JSJaCIQ.prototype.reply=function(e){var t=this.clone();if(t.setTo(this.getFrom()),t.setFrom(),t.setType("result"),e)if("string"==typeof e)t.getChild().appendChild(t.getDoc().loadXML(e));else if(e.constructor==Array)for(var n=t.getChild(),r=0;r<e.length;r++)"string"==typeof e[r]?n.appendChild(t.getDoc().loadXML(e[r])):"object"==typeof e[r]&&n.appendChild(e[r]);else"object"==typeof e&&t.getChild().appendChild(e);return t},JSJaCMessage.prototype=new JSJaCPacket,JSJaCMessage.prototype.setBody=function(e){return this._setChildNode("body",e),this},JSJaCMessage.prototype.setSubject=function(e){return this._setChildNode("subject",e),this},JSJaCMessage.prototype.setThread=function(e){return this._setChildNode("thread",e),this},JSJaCMessage.prototype.getThread=function(){return this.getChildVal("thread")},JSJaCMessage.prototype.getBody=function(){return this.getChildVal("body")},JSJaCMessage.prototype.getSubject=function(){return this.getChildVal("subject")},JSJaCPacket.wrapNode=function(e){var t=null;switch(e.nodeName.toLowerCase()){case"presence":t=new JSJaCPresence;break;case"message":t=new JSJaCMessage;break;case"iq":t=new JSJaCIQ}return t&&(t.getDoc().replaceChild(t._importNode(e,!0),t.getNode()),null==t.getDoc().xml&&null!=e&&null!=e.xml&&(t.getDoc().xml=e.xml)),t};var JSJaCUtils={xor:function(e,t){if(!e)return t;if(!t)return e;for(var n="",r=0;r<e.length;r++)n+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r));return n},cnonce:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.round(Math.random((new Date).getTime())*(t.length-1)));return n},now:function(){return Date.now&&"function"==typeof Date.now?Date.now():(new Date).getTime()}};function JSJaCWebSocketConnection(e){this.base=JSJaCConnection,this.base(e),this._ws=null,this.registerHandler("onerror",JSJaC.bind(this._cleanupWebSocket,this))}JSJaCWebSocketConnection.prototype=new JSJaCConnection,JSJaCWebSocketConnection.prototype._cleanupWebSocket=function(){null!==this._ws&&(this._ws.onclose=null,this._ws.onerror=null,this._ws.onopen=null,this._ws.onmessage=null,this._ws.close(),this._ws=null)},JSJaCWebSocketConnection.prototype.connect=function(e){this._cleanupWebSocket(),this._setStatus("connecting"),e.appType&&(this.appType=e.appType),e.clientIdentify&&(this.clientIdentify=e.clientIdentify),this.domain=e.domain||"localhost",this.username=e.username,this.resource=e.resource,this.pass=e.password||e.pass,this.authzid=e.authzid||"",this.register=e.register,this.authhost=e.authhost||this.domain,this.authtype=e.authtype||"sasl",this.jid=this.username+"@"+this.domain,this.fulljid=this.jid+"/"+this.resource,e.allow_plain?this._allow_plain=e.allow_plain:this._allow_plain=JSJAC_ALLOW_PLAIN,e.allow_scram?this._allow_scram=e.allow_scram:this._allow_scram=JSJAC_ALLOW_SCRAM,e.xmllang&&""!==e.xmllang?this._xmllang=e.xmllang:this._xmllang="en","undefined"!=typeof WebSocket?(this._ws=new WebSocket(this._httpbase,"xmpp"),this._ws.onclose=JSJaC.bind(this._onclose,this),this._ws.onerror=JSJaC.bind(this._onerror,this),this._ws.onopen=JSJaC.bind(this._onopen,this)):this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype._onopen=function(){var e={usr:this.username,atk:this.pass,br:this.resource};this.appType&&(e.appType=this.appType),this.clientIdentify&&(e.clientIdentify=this.clientIdentify),this._buildAndSend(new JumpPacket(e,OPCODE.AUTH.SEND)),this._ws.onmessage=JSJaC.bind(this._onAuthMessage,this)},JSJaCWebSocketConnection.prototype._onAuthMessage=function(e){var s=this;if(e.data instanceof Blob){var t=e.data,n=new FileReader;n.onload=function(e){if(e.target.readyState==FileReader.DONE){var t=new Uint8Array(e.target.result),n=s._bytesToInteger(t.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),r=t.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),i=t.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+n);if(s._bytesToInteger(r)==OPCODE.AUTH.RECV){var o=JSON.parse(s._uint8ArrayToString(i));if(YYIMChat.log("【recv】\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(o),3),200!=o.code)return void s._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"});s._handleEvent("packet_in",o),s._handleEvent(OPCODE.AUTH.KEY,o),s._connected=!0,s._handleEvent("onconnect"),s._ws.onmessage=JSJaC.bind(s._onJumpMessage,s)}else if(s._bytesToInteger(r)==OPCODE.STREAM_ERROR.RECV){o=JSON.parse(s._uint8ArrayToString(i));if(YYIMChat.log("【recv】\tOPCODE.AUTH.KEY\n\t"+JSON.stringify(o),3),200!=o.code)return void s._handleEvent(OPCODE.STREAM_ERROR.KEY,{code:401,message:"not-authorized"})}}},n.readAsArrayBuffer(t)}},JSJaCWebSocketConnection.prototype.sendJumpPacket=function(e,t,n){if(!this.connected())return!1;if(!e||!e.opcode)return!1;if(t&&this._validateCallbackable(e)){if(!e.content)throw new Error("packet content cannot be null when send a Message or IQ packet.");e.content.id||(e.content.id=this._IDPrefix+this._ID++),this._registerPID(e,t,n)}e instanceof JumpPacket&&YYIMChat.log("【send】\t "+OPCODE_MAP.SEND.get(e.opcode)+"\n\t"+JSON.stringify(e),3,new Date);try{this._handleEvent("packet_out",e)}catch(e){return this.oDbg.log(e.toString(),1),!1}return this._buildAndSend(e),!0},JSJaCWebSocketConnection.prototype._buildAndSend=function(r){var i=null,o="Undefined"==Object.prototype.toString.call(r.content).slice(8,-1)||"Null"==Object.prototype.toString.call(r.content).slice(8,-1),e=new Blob([o?"":JSON.stringify(r.content)],{type:"text/json"}),t=new FileReader,s=this;t.onload=function(e){if(e.target.readyState==FileReader.DONE){i=this.result;var t,n=new Uint8Array(PACKET_HEADER_SIZE);n.set(s._numToBytes(r.sFrame,PACKET_STRUCT.CONSOLE_FRAME.SIZE),PACKET_STRUCT.CONSOLE_FRAME.START),n.set(s._numToBytes(r.opcode,PACKET_STRUCT.OPCODE.SIZE),PACKET_STRUCT.OPCODE.START),o?n.set(s._numToBytes(0,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START):n.set(s._numToBytes(i.byteLength,PACKET_STRUCT.PACKET_LEN.SIZE),PACKET_STRUCT.PACKET_LEN.START),n.set(s._numToBytes(r.version,PACKET_STRUCT.VERSION.SIZE),PACKET_STRUCT.VERSION.START),n.set(s._numToBytes(r.seqId,PACKET_STRUCT.SEQ_ID.SIZE),PACKET_STRUCT.SEQ_ID.START),t=o?n:s._concatUint8Array(n,new Uint8Array(i)),s._ws.send(t)}},t.readAsArrayBuffer(e)},JSJaCWebSocketConnection.prototype._handleOpenStream=function(e){var t,n;this.oDbg.log(e.data,4),"/>"!==(t=(t=e.data).substr(t.indexOf("<stream:stream"))).substr(-2)&&"</stream:stream>"!==t.substr(-16)&&(t+="</stream:stream>"),(n=this._parseXml(t))?(this.streamid=n.getAttribute("id"),this.oDbg.log("got streamid: "+this.streamid,2),this._ws.onmessage=JSJaC.bind(this._handleInitialResponse,this)):this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype._handleInitialResponse=function(e){var t=this._parseXml(e.data);this._parseStreamFeatures(t)?(this._connected=!0,this.register?this._doInBandReg():this._doAuth()):this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype.disconnect=function(){this._setStatus("disconnecting"),this.connected()&&(this._connected=!1,this.oDbg.log("Disconnecting",4),this._cleanupWebSocket(),this.oDbg.log("Disconnected",2),this._handleEvent("ondisconnect"))},JSJaCWebSocketConnection.prototype._onclose=function(){this.oDbg.log("websocket closed",2),"disconnecting"!==this._status&&(this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable")))},JSJaCWebSocketConnection.prototype._onerror=function(){this.oDbg.log("websocket error",1),this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"))},JSJaCWebSocketConnection.prototype._onJumpMessage=function(e){var o=this;if(e.data instanceof Blob){var t=e.data,n=new FileReader;n.onload=function(e){if(e.target.readyState==FileReader.DONE){var t=new Uint8Array(e.target.result),n=o._bytesToInteger(t.subarray(PACKET_STRUCT.PACKET_LEN.START,PACKET_STRUCT.PACKET_LEN.END)),r=t.subarray(PACKET_STRUCT.OPCODE.START,PACKET_STRUCT.OPCODE.END),i=t.subarray(PACKET_HEADER_SIZE,PACKET_HEADER_SIZE+n);o._parseUint8Array(r,i)}},n.readAsArrayBuffer(t)}},JSJaCWebSocketConnection.prototype._onmessage=function(e){var t,n,r;if(t=e.data,!0===this._connected&&this._setStatus("processing"),t&&""!==t){if((n=this._parseXml(t)).namespaceURI===NS_STREAM&&"error"===n.localName)return 0<n.getElementsByTagNameNS(NS_STREAMS,"conflict").length&&this._setStatus("session-terminate-conflict"),this._connected=!1,void this._handleEvent("onerror",JSJaCError("503","cancel","remote-stream-error"));(r=JSJaCPacket.wrapNode(n))&&(this.oDbg.log("async recv: "+e.data,4),this._handleEvent("packet_in",r),r.pType&&!this._handlePID(r)&&(this._handleEvent(r.pType()+"_in",r),this._handleEvent(r.pType(),r)))}},JSJaCWebSocketConnection.prototype._parseXml=function(e){var t;this.oDbg.log("Parsing: "+e,4);try{if(t=XmlDocument.create("stream",NS_STREAM),"</stream:stream>"==e.trim()){this.oDbg.log("session terminated",1),clearTimeout(this._timeout),clearInterval(this._interval),clearInterval(this._inQto);try{JSJaCCookie.read(this._cookie_prefix+"JSJaC_State").erase()}catch(e){}return this._connected=!1,this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate")),this.oDbg.log("Disconnected.",1),this._handleEvent("ondisconnect"),null}return-1===e.indexOf("<stream:stream")?(t.loadXML("<stream:stream xmlns:stream='"+NS_STREAM+"' xmlns='jabber:client'>"+e+"</stream:stream>"),void 0===t.documentElement.firstChild.xml&&(t.documentElement.firstChild.xml=e),t.documentElement.firstChild):(t.loadXML(e),t.documentElement)}catch(e){this.oDbg.log("Error: "+e),this._connected=!1,this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error"))}return null},JSJaCWebSocketConnection.prototype._getInitialRequestString=function(){var e,t;return e=this.domain,this.authhost&&(e=this.authhost),t='<stream:stream to="'+e+'" xmlns="jabber:client" xmlns:stream="'+NS_STREAM+'"',"sasl"!==this.authtype&&"saslanon"!==this.authtype||(t+=' version="1.0"'),t+=">"},JSJaCWebSocketConnection.prototype.send=function(e,t,n){if(this._ws.onmessage=JSJaC.bind(this._onmessage,this),!e||!e.pType)return this.oDbg.log("no packet: "+e,1),!1;if(!this.connected())return!1;t&&(e.getID()||e.setID("JSJaCID_"+this._ID++),this._registerPID(e,t,n));try{this._handleEvent(e.pType()+"_out",e),this._handleEvent("packet_out",e),this._ws.send(e.xml())}catch(e){return this.oDbg.log(e.toString(),1),!1}return!0},JSJaCWebSocketConnection.prototype.resume=function(){return!1},JSJaCWebSocketConnection.prototype.suspend=function(){return!1},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S1=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S1,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthScramSha1S2=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthScramSha1S2,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S1=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S1,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDigestMd5S2=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDigestMd5S2,this)(t)},JSJaCWebSocketConnection.prototype._doSASLAuthDone=function(e){var t=this._parseXml(e.data);return JSJaC.bind(JSJaCConnection.prototype._doSASLAuthDone,this)(t)},JSJaCWebSocketConnection.prototype._reInitStream=function(e){var t,n=this.domain;this.authhost&&(n=this.authhost),t='<stream:stream xmlns:stream="'+NS_STREAM+'" xmlns="jabber:client" to="'+n+'" version="1.0">',this._sendRaw(t,e)},JSJaCWebSocketConnection.prototype._sendRaw=function(e,t,n){return!!this._ws&&(t&&(this._ws.onmessage=JSJaC.bind(t,this,n)),this._ws.send(e),!0)},JSJaCWebSocketConnection.prototype._parseUint8Array=function(e,t){if(!0===this._connected&&this._setStatus("processing"),e&&t){var n=OPCODE_MAP.RECV.get(this._bytesToInteger(e));if(YYIMChat.log("【recv】\t"+OPCODE_MAP.RECV.get(this._bytesToInteger(e))+"\n\t"+this._uint8ArrayToString(t),3,new Date),0==t.byteLength)return this._handleEvent("packet_in"),void this._handleEvent(n);try{var r=JSON.parse(this._uint8ArrayToString(t));this._handlePID(r)||(this._handleEvent("packet_in",r),this._handleEvent(n,r))}catch(e){}}},function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=16)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMChat=t.YYIMManager=void 0;var r=l(n(2)),i=l(n(3)),o=n(8),s=n(33),a=n(12),c=n(4),u=n(13);function l(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(){(0,r.default)(this,e),this._user,this._token={},this.appkey,this.connectStatus=u.CONNECT_STATUS.INIT,this.offlineStatus=[u.CONNECT_STATUS.ERROR,u.CONNECT_STATUS.OFFLINE,u.CONNECT_STATUS.CONFLICT,u.CONNECT_STATUS.AUTHERROR,u.CONNECT_STATUS.ONCLIENTKICKOUT,u.CONNECT_STATUS.INIT,u.CONNECT_STATUS.ONUPDATEPASSWORD],this.onlineStatus=[u.CONNECT_STATUS.CONNECTED,u.CONNECT_STATUS.PROCESSING],this.apiKey,this.init()}return(0,i.default)(e,[{key:"log",value:function(e,t,n,r){this._logger=this._logger||new s.YYIMConsoleLogger(c.YYIMConfiguration.LOG.FILTER_LEVEL),this._logger.log(e,t,n,r)}},{key:"init",value:function(t){var n=this;t=t||{},this.onConnectStatusChanged=function(e){n.connectStatus=e||n.connectStatus,n.log("connectStatus: ",3,n.connectStatus)},this.onClosed=function(e){n.onConnectStatusChanged(u.CONNECT_STATUS.OFFLINE),t.onClosed&&t.onClosed(e)},this.onAuthError=function(e){n.onConnectStatusChanged(u.CONNECT_STATUS.AUTHERROR),t.onAuthError&&t.onAuthError(e)},this.onStatusChanged=function(e){YYIMCommonUtil.isStringAndNotEmpty(e)&&n.onConnectStatusChanged(e)},this.onOpened=function(e){n.onConnectStatusChanged(u.CONNECT_STATUS.CONNECTED),n.getTimeCorrection&&n.getTimeCorrection(),t.onOpened&&t.onOpened(e)},this.onUpdatePassword=function(e){n.disConnect(u.CONNECT_STATUS.ONUPDATEPASSWORD),t.onUpdatePassword&&t.onUpdatePassword(e)},this.onClientKickout=function(e){n.disConnect(u.CONNECT_STATUS.ONCLIENTKICKOUT),t.onClientKickout&&t.onClientKickout(e)},this.onConflicted=function(e){n.disConnect(u.CONNECT_STATUS.CONFLICT),t.onConflicted&&t.onConflicted(e)},this.onConnectError=function(e){n.connectStatus==u.CONNECT_STATUS.OFFLINE||n.connectStatus==u.CONNECT_STATUS.INIT||n.connectStatus==u.CONNECT_STATUS.CONFLICT||n.connectStatus==u.CONNECT_STATUS.AUTHERROR||n.connectStatus==u.CONNECT_STATUS.ONCLIENTKICKOUT||n.connectStatus==u.CONNECT_STATUS.ONUPDATEPASSWORD?n.ConnectErrorTimer&&(clearInterval(n.ConnectErrorTimer),n.ConnectErrorTimer=null):(n.onConnectStatusChanged(u.CONNECT_STATUS.ERROR),n.ConnectErrorTimer||(n.ConnectErrorTimer=setInterval(function(){n.connectStatus==u.CONNECT_STATUS.CONNECTED||n.connectStatus==u.CONNECT_STATUS.PROCESSING||n.connectStatus==u.CONNECT_STATUS.OFFLINE||n.connectStatus==u.CONNECT_STATUS.INIT?(clearInterval(n.ConnectErrorTimer),n.ConnectErrorTimer=null):n.connectStatus==u.CONNECT_STATUS.ERROR&&(n.log("连接出现异常，正在尝试重连！",3,e),n.connect(),n.onConnectStatusChanged(u.CONNECT_STATUS.CONNECTING))},500)),t.onConnectError&&t.onConnectError(e))},this.onUserBind=t.onUserBind||function(){},this.onExpiration=t.onExpiration,this.exeBackhander("initCallback",t),jQuery(window).on({"unload offline":function(){n.connectStatus!=u.CONNECT_STATUS.INIT&&n.disConnect()},online:function(){n.connectStatus!=u.CONNECT_STATUS.INIT&&n.connectStatus!=u.CONNECT_STATUS.CONFLICT&&n.connectStatus!=u.CONNECT_STATUS.AUTHERROR&&n.connectStatus!=u.CONNECT_STATUS.ONCLIENTKICKOUT&&n.connectStatus!=u.CONNECT_STATUS.ONUPDATEPASSWORD&&n.connect()}}),jQuery.ajaxSetup({statusCode:{401:function(){t.onExpirationed&&t.onExpirationed()}}})}},{key:"initSDK",value:function(e){c.ConfigSetting.init(e);var t=c.YYIMConfiguration.MULTI_TENANCY;this.appkey=t.SEPARATOR+t.APP_KEY+t.SEPARATOR+t.ETP_KEY,this.apiKey=e.apiKey}},{key:"logEnable",value:function(e){YYIMUtil.isWhateType(e,"Boolean")?c.YYIMConfiguration.LOG.ENABLE=e:c.YYIMConfiguration.LOG.ENABLE=!c.YYIMConfiguration.LOG.ENABLE}},{key:"getTenancy",value:function(){return c.YYIMConfiguration.MULTI_TENANCY}},{key:"getAppkey",value:function(){return this.appkey}},{key:"getApiKey",value:function(){return this.apiKey}},{key:"isOnline",value:function(){return-1<this.onlineStatus.indexOf(this.connectStatus)}},{key:"disConnect",value:function(e){this.getExpirationTimer&&(clearInterval(this.getExpirationTimer),this.getExpirationTimer=0),o.YYIMConnection.getInstance().disconnect(),this.onConnectStatusChanged(e||u.CONNECT_STATUS.OFFLINE)}},{key:"connect",value:function(){this.isOnline()||o.YYIMConnection.getInstance().connect()}},{key:"getToken",value:function(){var n=this;try{this.getExpiration()&&YYIMUtil.isWhateType(this.onExpiration,"Function")&&this.getExpiration()-this.getServerNow()<=c.YYIMConfiguration.EXPIRATION.INVALID&&this.onExpiration(function(e,t){e&&(n._token.token=e),t&&(n._token.expiration=t)})}catch(e){this.log("Token winll Invalid. Auto Get Token Error.",0)}return this._token.token}},{key:"getExpiration",value:function(){return this._token.expiration}},{key:"login",value:function(e){var t=this;e=e||{},this._token={token:e.token,expiration:e.expiration},e.username&&e.token?(this.isOnline()||o.YYIMConnection.getInstance().connect({username:a.YYIMJIDUtil.getNode(e.username),token:e.token,appType:e.appType,identify:e.identify}),YYIMUtil.isWhateType(this.onExpiration,"Function")&&(this.getExpirationTimer||(this.getExpirationTimer=setInterval(function(){t.getToken()},c.YYIMConfiguration.EXPIRATION.INSPECTION_INTERVAL)))):this.log((e.username?"":"Username ")+(e.token?"":"Token ")+" Illegal.",0)}},{key:"getConnectStatus",value:function(){return this.connectStatus}},{key:"logout",value:function(){this.disConnect.apply(this,arguments),this.onConnectStatusChanged(u.CONNECT_STATUS.INIT)}},{key:"getUserBareJID",value:function(){return this._user.jid.getBareJID()}},{key:"getUserFullJID",value:function(){return this._user.jid.toString()}},{key:"getUserNode",value:function(){return a.YYIMJIDUtil.getNode(this.getUserBareJID())}},{key:"getUserID",value:function(){return a.YYIMJIDUtil.getID(this.getUserBareJID())}},{key:"getResource",value:function(){return c.YYIMConfiguration.RESOURCE}},{key:"getServerName",value:function(){return c.YYIMConfiguration.CONNECTION.SERVER_NAME}},{key:"getServletPath",value:function(){return c.YYIMConfiguration.SERVLET}},{key:"getJIDUtil",value:function(){return a.YYIMJIDUtil}},{key:"getServerNow",value:function(){return c.YYIMConfiguration.TIMECORRECTION.AUTOCORRECTION?(new Date).getTime()+e.getInstance().getConfig().TIMECORRECTION.RESULT:(new Date).getTime()}},{key:"getBrowser",value:function(){return c.YYIMConfiguration.BROWSER}},{key:"getConstants",value:function(){return{FAVORITE_TYPE:u.FAVORITE_TYPE,STATUS:u.STATUS,TYPE:u.TYPE,PRESENCE_TYPE:u.PRESENCE_TYPE,COLLECT_TYPE:u.COLLECT_TYPE,CHAT_TYPE:u.CHAT_TYPE,MESSAGE_CONTENT_TYPE:u.MESSAGE_CONTENT_TYPE}}},{key:"getConfig",value:function(){return c.YYIMConfiguration}},{key:"getConnection",value:function(){return o.YYIMConnection.getInstance()}},{key:"getJIDUtil",value:function(){return a.YYIMJIDUtil}},{key:"getUtil",value:function(){return YYIMUtil}},{key:"setBackhander",value:function(e){if(e)for(var t in this.backhanders=this.backhanders||{},e)this.backhanders[t]=this.backhanders[t]||{},window.jQuery.extend(this.backhanders[t],e[t])}},{key:"exeBackhander",value:function(t,e){if(this.backhanders=this.backhanders||{},t&&this.backhanders[t])for(var n in this.backhanders[t])if(YYIMUtil.isWhateType(this.backhanders[t][n],"Function"))try{this.backhanders[t][n](e||{})}catch(e){this.log("exeBackhander: "+t+" "+n+" Error.",0)}}}]),e}();h.getInstance=function(){return h._instance||(h._instance=new h),h._instance};var d=h.getInstance();t.YYIMManager=h,t.YYIMChat=d},function(e,t,n){e.exports={default:n(36),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(18),o=(r=i)&&r.__esModule?r:{default:r};t.default=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}()},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),jQuery.support.cors=!0;var i,o,s,a,c,u,l,h={},n=(i="im.yyuap.com",o="stellar.yyuap.com",s=5227,a=7075,c="http://im.yyuap.com/",u="web",l="https://pubaccount.yonyoucloud.com/",{init:function(e){u=(e=e||{}).clientMark||u,o=e.wsurl||o,s=e.wsport||s,a=e.hbport||a,c=e.servlet||c,l=e.todoServlet||l;var t,n=function(){var e=navigator.userAgent.toLowerCase();return{version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],webkit:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)}};(t=n()).msie&&window.parseInt(t.version)<10&&(c=c.replace(/^https?:\/\//,window.location.protocol+"//")),(/https/.test(window.location.protocol)||!0===e.useHttps)&&(s=5225),r.YYIMConfiguration=h={YY_IM_DOMAIN:i,RESOURCE:u+"-v2.6",MULTI_TENANCY:{ENABLE:!0,ETP_KEY:e.etp||"etp",APP_KEY:e.app||"app",SEPARATOR:"."},SENDINTERVAL:30,GROUP:{MEMBERSLIMIT:5},BETCH_MAXLIMIT:{ROSTER:50,PUBACCOUNT:50},INPUT_STATE:{INTERVAL:2e3},UPLOAD:{AUTO_SEND:!0,MULTI_SELECTION:!1,PREVENT_DUPLICATES:!1,PREVIEW_SIZE:{WIDTH:100,HEIGHT:100},FLASH_SWF_URL:e.flash_swf_url||"./Moxie.swf",SILVERLIGHT_XAP_URL:e.silverlight_xap_url||"./Moxie.xap",MEDIATYPE:{IMAGE:1,FILE:2,DOC:3},IMAGE_TYPES:/\.(png|jpe?g|gif)$/i},TIMECORRECTION:{AUTOCORRECTION:!0,TIMES:3,RESIDUAL:50,RESULT:0,LOAD:!1},MULTIPARTYCALL:{ADDRESS:"http://dudu.yonyoutelecom.cn/httpIntf/createConference.do",ACCOUNT:"",KEY:"",PHONESMAXLENGTH:200},SERVLET:{REST_RESOURCE_SERVLET:c+"sysadmin/rest/resource/",REST_VERSION_SERVLET:c+"sysadmin/rest/version/",REST_USER_SERVLET:c+"sysadmin/rest/user/",REST_UPLOAD_SERVLET:c+"im_upload/rest/resource/",REST_DOWNLOAD_SERVLET:c+"im_download/rest/resource/",REST_TRANSFORM_SERVLET:c+"im_download/rest/transform/resource/",REST_SYSTEM_SERVLET:c+"sysadmin/rest/system/",REST_SYSTEM_CUSTOMER_USER:c+"sysadmin/rest/customer/user/",REST_TODO_USER:l+"todocenter/user/todo/"},SUPPORT:{isWebSocketSupport:(window.WebSocket=window.WebSocket||window.MozWebSocket,!!window.WebSocket)},CONNECTION:{TIMERVAL:2e3,WAIT:300,SECURE:!1,ALLOW_PLAIN:!0,ENABLE_WEBSOCKET:!0,ENABLE_LOCAL_CONNECTION:!0,USE_HTTPS:!(!/https/.test(window.location.protocol)&&!0!==e.useHttps),SERVER_NAME:i,HTTP_BASE:o,HTTP_BIND_PORT:a,WS_PORT:s},PING:{INTERVAL:1e4,SLOW_INTERVAL:3e4,TIMEOUT:1e4},DOMAIN:{CHATROOM:"conference."+i,SEARCH:"search."+i,PUBACCOUNT:"pubaccount."+i},EXPIRATION:{INVALID:216e5,INSPECTION_INTERVAL:18e5},LOG:{ENABLE:!!e.logEnable,FILTER_LEVEL:3},BROWSER:n()},h.getHttpBindUrl=function(){return(h.CONNECTION.USE_HTTPS?"https://":"http://")+h.CONNECTION.HTTP_BASE+":"+h.CONNECTION.HTTP_BIND_PORT+"/http-bind/"},h.getWebSocketUrl=function(){return(h.CONNECTION.USE_HTTPS?"wss://":"ws://")+h.CONNECTION.HTTP_BASE+":"+h.CONNECTION.WS_PORT},h.useWebSocket=function(){return h.SUPPORT.isWebSocketSupport&&h.CONNECTION.ENABLE_WEBSOCKET},h.getConnectionArgObj=function(){return{domain:h.CONNECTION.SERVER_NAME,resource:h.RESOURCE,allow_plain:h.CONNECTION.ALLOW_PLAIN,secure:h.CONNECTION.SECURE,register:!1}},h.getLocationOrigin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.host},h.getClientMark=function(){return u}}});n.init(),r.YYIMConfiguration=h,r.ConfigSetting=n},function(e,t,n){e.exports=!n(11)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){var n=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMConnection=void 0;var r=l(n(2)),i=l(n(3)),o=n(4),s=n(12),a=n(0),c=n(31),u=n(32);function l(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(){(0,r.default)(this,e),this.daemon=new c.YYIMConnectDaemon,this.eventHandler=new u.YYIMConnectEventHandler,this.connection=this.getConnection(),this.connectArg,this.waitingList=[],this.sending=!1,this.lastSendTime=0}return(0,i.default)(e,[{key:"getDaemon",value:function(){return this.daemon}},{key:"_init",value:function(){a.YYIMManager.getInstance().exeBackhander("monitor"),this.eventHandler._init(),this.registerHandler(OPCODE.AUTH.KEY,function(e){var t=new JSJaCJID(e.jid),n=s.YYIMJIDUtil.getID(e.jid);a.YYIMManager.getInstance()._user={jid:t,name:n},a.YYIMManager.getInstance().onUserBind(n,t.getResource())})}},{key:"registerHandler",value:function(e,t,n,r){if(!this.connection)throw"connection is undefined!";this.connection.registerHandler.apply(this.connection,arguments)}},{key:"connected",value:function(){return!(!this.connection||!this.connection.connected())}},{key:"getConnection",value:function(){return this.connection||(o.YYIMConfiguration.useWebSocket()?this.connection=new JSJaCWebSocketConnection({httpbase:o.YYIMConfiguration.getWebSocketUrl()}):this.connection=new JSJaCHttpBindingConnection({httpbase:o.YYIMConfiguration.getHttpBindUrl(),timerval:o.YYIMConfiguration.CONNECTION.TIMERVAL,wait:o.YYIMConfiguration.CONNECTION.WAIT})),this.connection}},{key:"connect",value:function(e){e=e||{},this.connectArg||(this.connectArg=o.YYIMConfiguration.getConnectionArgObj()),e.username&&(this.connectArg.username=e.username),e.token&&(this.connectArg.password=e.token),e.appType&&(this.connectArg.appType=e.appType),e.identify&&(this.connectArg.clientIdentify=e.identify),a.YYIMManager.getInstance()._user={jid:new JSJaCJID(this.connectArg.username+"@"+o.YYIMConfiguration.YY_IM_DOMAIN+"/"+this.connectArg.resource),name:this.connectArg.username},this.connection.connect(this.connectArg)}},{key:"disconnect",value:function(){this.daemon.stopPing(!1),this.connection&&this.connection.disconnect()}},{key:"send",value:function(e,t,n,r){this.waitingList.push({packet:e,callback:t,data:n,callbackContext:r}),this.sending||this.sendInterval()}},{key:"sendInterval",value:function(){var e=this;if(this.waitingList.length){this.sending=!0;var t=(new Date).getTime()-this.lastSendTime;if(t>=o.YYIMConfiguration.SENDINTERVAL){var n=this.waitingList.shift();this.sendJumpPacket(n),n.packet&&n.packet.opcode!=OPCODE.PING.SEND&&this.getDaemon().startPing(),n.packet&&n.packet.opcode==OPCODE.PING.SEND&&this.getDaemon().setTimeout(),this.lastSendTime=(new Date).getTime(),this.sendInterval()}else setTimeout(function(){e.sendInterval()},o.YYIMConfiguration.SENDINTERVAL-t)}else this.sending=!1}},{key:"sendJumpPacket",value:function(e){if(e)return e.callbackContext?this.connection.sendJumpPacket(e.packet,e.callback.bind(e.callbackContext),e.data):this.connection.sendJumpPacket(e.packet,e.callback,e.data)}}]),e}();h.getInstance=function(){return h._instance||(h._instance=new h,h._instance._init()),h._instance},t.YYIMConnection=h},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(25),i=n(26),o=n(28),s=Object.defineProperty;t.f=n(5)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMJIDUtil=void 0;var r=n(13),i=n(4),o=n(0),s={getNode:function(e){if(e=e.toString(),YYIMCommonUtil.isStringAndNotEmpty(e)){var t=o.YYIMManager.getInstance().getAppkey(),n=e;if(-1<n.indexOf("@")){if(0===n.indexOf("@"))throw'"'+e+'" Can\'t start with  "@"!';n=n.substring(0,n.indexOf("@"))}if(-1<n.indexOf(".")){if(0===n.indexOf("."))throw'"'+e+'" Can\'t start with "."!';n=n.substring(0,n.indexOf("."))}return n?n+t:n}throw'"'+e+"\" Can't be Number Or Empty!"},getResource:function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)&&-1!=e.indexOf("/")?e.substring(e.indexOf("/")+1):null},buildUserJID:function(e,t){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+i.YYIMConfiguration.YY_IM_DOMAIN+(t?"/"+t:""):null},getDomain:function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)&&-1!=e.indexOf("@")?e.substring(e.indexOf("@")+1):null},buildChatGroupJID:function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+i.YYIMConfiguration.DOMAIN.CHATROOM:null},buildPubAccountJID:function(e){return YYIMCommonUtil.isStringAndNotEmpty(e)?-1!=e.indexOf("@")?e:e+"@"+i.YYIMConfiguration.DOMAIN.PUBACCOUNT:null},getChatTypeByJid:function(e){if(e)switch(s.getDomain(e)){case i.YYIMConfiguration.DOMAIN.CHATROOM:return r.CHAT_TYPE.GROUP_CHAT;case i.YYIMConfiguration.DOMAIN.PUBACCOUNT:return r.CHAT_TYPE.PUB_ACCOUNT;default:return r.CHAT_TYPE.CHAT}},getBareJID:function(e){var t=o.YYIMManager.getInstance().getUserBareJID(),n=void 0;if(e){if(e instanceof JSJaCJID)return e.getBareJID()==t?e.toString():e.getBareJID();if("string"==typeof e)return(n=new JSJaCJID(e)).getBareJID()==t?n.toString():n.getBareJID();if(e.jid&&e.jid instanceof JSJaCJID)return(n=e.jid).getBareJID()==t?n.toString():n.getBareJID()}throw new JSJaCJIDInvalidException("invalid jid: "+e)},getID:function(e){var t=void 0,n=void 0,r=void 0,i=void 0;return(i=YYIMCommonUtil.isStringAndNotEmpty(e)?(t=o.YYIMManager.getInstance().getAppkey(),-1!=(r=e.indexOf("@"))?0<(n=e.substring(0,r)).indexOf(t)?n.replace(t,""):n:0<e.indexOf(t)?e.replace(t,""):e):null)?i.toString():i}};t.YYIMJIDUtil=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONNECT_STATUS={INIT:"init",OFFLINE:"offline",CONNECTING:"connecting",PROCESSING:"processing",CONFLICT:"conflict",CONNECTED:"connected",ERROR:"error",AUTHERROR:"AuthError",ONCLIENTKICKOUT:"onClientKickout",ONUPDATEPASSWORD:"onUpdatePassword"},t.FAVORITE_TYPE={FAVORITE:"favorite",REMOVE:"remove",NONE:"none"},t.STATUS={CHAT:"chat",AWAY:"away",XA:"xa",DND:"dnd",UNAVAILABLE:"unavailable"},t.TYPE={SET:"set",RESULT:"result",GET:"get",SUBMIT:"submit",UNAVAILABLE:"unavailable"},t.PRESENCE_TYPE={SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",PROBE:"probe",UNAVAILABLE:"unavailable",COLLECT:"collect"},t.COLLECT_TYPE={ADD:"add",REMOVE:"remove"},t.CHAT_TYPE={CHAT:"chat",GROUP_CHAT:"groupchat",PUB_ACCOUNT:"pubaccount"},t.MESSAGE_CONTENT_TYPE={TEXT:2,FILE:4,IMAGE:8,REDPACKET:9,SMALLVIDEO:10,REVOCATION:13,MERGEFORWARD:15,SINGLEGRAPHIC:16,MOREGRAPHIC:32,AUDO:64,LOCATION:128,SHARE:256,WHITEBOARD:1024}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(2)),i=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function t(e){(0,r.default)(this,t),this.childs={},this._byte=e||null,this._isWord=!1,this._count=0}return(0,i.default)(t,[{key:"isWord",value:function(){return this._isWord&&0==this._count}},{key:"asWord",value:function(){this._isWord=!0}},{key:"addCount",value:function(){this._count++}},{key:"getCount",value:function(){return this._count}}]),t}(),a=function(){function e(){(0,r.default)(this,e),this.root=new s(null)}return(0,i.default)(e,[{key:"toBytes",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):t=t.concat(this.toUTF8(r))}return t}},{key:"toUTF8",value:function(e){return[224|e>>12&15,128|e>>6&63,128|63&e]}},{key:"toUTF16",value:function(e,t,n){return(255&(e<<4|t>>2&15))<<8|((3&t)<<6|63&n)}},{key:"add",value:function(e){for(var t=this.root,n=this.toBytes(e),r=n.length,i=0;i<r;i++){var o=n[i];o in t.childs||(t.childs[o]=new s(o)),t=t.childs[o]}t.asWord()}},{key:"search",value:function(e){for(var t=this.root,n=e.length,r=[],i=[],o=0,s=0;s<n;s++){var a=e[s],c=t.childs;if(!(a in c))return r;if(a<128)i.push(String.fromCharCode(a));else if(++o%3==0){var u=e[s-2],l=e[s-1],h=a;i.push(String.fromCharCode(this.toUTF16(u,l,h)))}if(i.join("")in stop)return r;var d=c[a];d.isWord()&&(d.addCount(),r.push(i.join(""))),t=d}return r}},{key:"splitWords",value:function(e){for(var t=this.toBytes(e),n=0,r=t.length-1,i=[];n!=r;){for(var o=[],s=n;s<=r;s++){var a=t[s];o.push(a);var c=this.search(o);!1!==c&&0<c.length&&(i=i.concat(c))}n++}return i}},{key:"init",value:function(e){for(var t=0;t<e.length;t++)this.add(e[t])}}]),e}(),c=function(){function e(){(0,r.default)(this,e),this.dicts=[],this.stopKeyword={"的":1},this.isOpenFilter=!1,this.isAIAbility=!0}return(0,i.default)(e,[{key:"openAIAbility",value:function(e){this.isAIAbility=e}},{key:"openFilterWords",value:function(e){this.isOpenFilter=e}},{key:"setDictionaries",value:function(e){if(e)for(var t=0;t<e.length;t++)this.dicts.push(e[t])}},{key:"intelligentAnalysis",value:function(e){if(!this.isOpenFilter)return!0;if(e&&this.isAIAbility){var t=new a;return t.init(this.dicts),0<t.splitWords(e).length}return!1}}]),e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileUpload=void 0;var i=n(0);function r(){}r.prototype=new BaseList,r.getInstance=function(){return this._instance||(this._instance=new r),this._instance},r.prototype.init=function(e,t){var n={browse_button:"fileUpload",file_data_name:"file",url:this.getBaseUrl(),filters:{max_file_size:"100mb",prevent_duplicates:!!i.YYIMChat.getConfig().UPLOAD.PREVENT_DUPLICATES},flash_swf_url:i.YYIMChat.getConfig().UPLOAD.FLASH_SWF_URL,silverlight_xap_url:i.YYIMChat.getConfig().UPLOAD.SILVERLIGHT_XAP_URL,multi_selection:!!i.YYIMChat.getConfig().UPLOAD.MULTI_SELECTION,multipart:!0,max_retries:1,chunk_size:0,runtimes:"gears,html5,flash,silverlight,browserplus"};e.mediaType==i.YYIMChat.getConfig().UPLOAD.MEDIATYPE.IMAGE?n.filters.mime_types=[{title:"Image files",extensions:"jpg,gif,png,jpeg,bmp"}]:n.filters.mime_types=void 0,jQuery.extend(n,e);n.browse_button;var r=new plupload.Uploader(n);r.init(),r.refresh(),this.bindEvents(r,t)},r.prototype.getBaseUrl=function(){return i.YYIMChat.getServletPath().REST_RESOURCE_SERVLET+i.YYIMChat.getTenancy().ETP_KEY+"/"+i.YYIMChat.getTenancy().APP_KEY+"/upload"},r.prototype.getUploadingSize=function(){var e=0;for(var t in this.list)if(this.list.hasOwnProperty(t)){var n=this.list[t];if(n){var r=n.getFile(t);r.status!=plupload.FAILED&&r.status!=plupload.STOPPED&&e++}}return e},r.prototype.start=function(e){var t;e&&(t=this.get(e.id||e))&&((e=t.getFile(e.id||e))&&(e.status=1),t.start())},r.prototype.end=function(e){var t;if(e){var n=e.id||e;(t=this.get(n))&&((e=t.getFile(n))&&t.removeFile(e),this.remove(n))}else this.forEach(function(e){e.splice(0),e.destroy()}),this.clear()},r.prototype.bindEvents=function(e,i){var n=this;e.bind("init",function(e){i&&i.init&&i.init(e)}),e.bind("PostInit",function(e){i&&i.PostInit&&i.PostInit(e)}),e.bind("Refresh",function(e){i&&i.Refresh&&i.Refresh(e)}),e.bind("StateChanged",function(e){i&&i.StateChanged&&i.StateChanged(e)}),e.bind("UploadFile",function(e,t){i&&i.StateChanged&&i.UploadFile(e,t)}),e.bind("BeforeUpload",function(e,t){i&&i.BeforeUpload&&i.BeforeUpload(e,t)}),e.bind("QueueChanged",function(e){i&&i.QueueChanged&&i.QueueChanged(e)}),e.bind("OptionChanged",function(e,t,n,r){i&&i.OptionChanged&&i.OptionChanged(e,t,n,r)}),e.bind("UploadProgress",function(e,t){i&&i.UploadProgress&&i.UploadProgress(e,t)}),e.bind("FilesAdded",function(e,t){i&&i.FilesAdded&&i.FilesAdded(e,t)}),e.bind("FilesRemoved",function(e,t){t.forEach(function(e,t){n.remove(e.id)}),i&&i.FilesRemoved&&i.FilesRemoved(e,t)}),e.bind("FileFiltered",function(e,t){n.set(t.id,e),i&&i.FileFiltered&&i.FileFiltered(e,t)}),e.bind("FileUploaded",function(e,t,n){i&&i.FileUploaded&&i.FileUploaded(e,t,n)}),e.bind("ChunkUploaded",function(e,t,n){i&&i.ChunkUploaded&&i.ChunkUploaded(e,t,n)}),e.bind("UploadComplete",function(e,t){i&&i.UploadComplete&&i.UploadComplete(e,t)}),e.bind("Error",function(e,t){i&&i.Error&&i.Error(e,t)}),e.bind("Destroy",function(e){i&&i.Destroy&&i.Destroy(e)})},t.FileUpload=r},function(e,t,n){e.exports=n(17)},function(e,t,n){"use strict";var r=n(0);n(34),n(37),n(39),n(41),n(43),n(45),n(47),n(49),n(51),n(53),n(55),n(57),window.YYIMChat=r.YYIMChat},function(e,t,n){e.exports={default:n(19),__esModule:!0}},function(e,t,n){n(20);var r=n(6).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(21);r(r.S+r.F*!n(5),"Object",{defineProperty:n(10).f})},function(e,t,n){var f=n(9),m=n(6),_=n(22),C=n(24),E=n(30),I="prototype",y=function(e,t,n){var r,i,o,s=e&y.F,a=e&y.G,c=e&y.S,u=e&y.P,l=e&y.B,h=e&y.W,d=a?m:m[t]||(m[t]={}),p=d[I],g=a?f:c?f[t]:(f[t]||{})[I];for(r in a&&(n=t),n)(i=!s&&g&&void 0!==g[r])&&E(d,r)||(o=i?g[r]:n[r],d[r]=a&&"function"!=typeof g[r]?n[r]:l&&i?_(o,f):h&&g[r]==o?function(r){var e=function(e,t,n){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(e);case 2:return new r(e,t)}return new r(e,t,n)}return r.apply(this,arguments)};return e[I]=r[I],e}(o):u&&"function"==typeof o?_(Function.call,o):o,u&&((d.virtual||(d.virtual={}))[r]=o,e&y.R&&p&&!p[r]&&C(p,r,o)))};y.F=1,y.G=2,y.S=4,y.P=8,y.B=16,y.W=32,y.U=64,y.R=128,e.exports=y},function(e,t,n){var o=n(23);e.exports=function(r,i,e){if(o(r),void 0===i)return r;switch(e){case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(10),i=n(29);e.exports=n(5)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(7);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(5)&&!n(11)(function(){return 7!=Object.defineProperty(n(27)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(7),i=n(9).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var i=n(7);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMConnectDaemon=void 0;var r=c(n(2)),i=c(n(3)),o=n(4),s=n(8),a=n(0);function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,r.default)(this,e),this.lastPongTime=Date.now(),this.pingInterval,this.pingTimeout,this.interval=0}return(0,i.default)(e,[{key:"startPing",value:function(e){!0===e&&(this.isOnline=e),s.YYIMConnection.getInstance().connected()?(this.interval=this.interval?o.YYIMConfiguration.PING.INTERVAL:o.YYIMConfiguration.PING.SLOW_INTERVAL,this.ping()):this.stopPing()}},{key:"stopPing",value:function(e){!1===e&&(this.isOnline=e),clearTimeout(this.pingTimeout),clearTimeout(this.pingInterval)}},{key:"ping",value:function(){if(this.isOnline){if(!this.sending){this.stopPing(),this.interval=this.interval||o.YYIMConfiguration.PING.SLOW_INTERVAL;var e=Date.now()-(this.lastPongTime+this.interval);if(0<=e)try{this.sending=!0,this.interval=o.YYIMConfiguration.PING.SLOW_INTERVAL,s.YYIMConnection.getInstance().send(new JumpPacket(null,OPCODE.PING.SEND))}catch(e){this.stopPing(),a.YYIMManager.getInstance().log("Ping_Error.",0,e),a.YYIMManager.getInstance().onConnectError({errorCode:408,message:"连接失败"})}else this.pingInterval=setTimeout(this.ping.bind(this),-e)}}else this.stopPing()}},{key:"pong",value:function(){this.lastPongTime=Date.now(),this.isOnline?(a.YYIMManager.getInstance().log("【pong】\t"+new Date(this.lastPongTime),3,this.lastPongTime),this.sending=!1,this.ping()):this.stopPing()}},{key:"setTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){if(this.isOnline){var e=Date.now();a.YYIMManager.getInstance().log("【setPingTimeout】\t"+new Date(e),3,e),clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(this.timeoutHandler.bind(this),o.YYIMConfiguration.PING.TIMEOUT)}else this.stopPing()})},{key:"timeoutHandler",value:function(){this.sending=!1,this.stopPing(),a.YYIMManager.getInstance().log("Ping_Timeout.",0),a.YYIMManager.getInstance().onConnectError({errorCode:408,message:"连接失败"})}}]),e}();t.YYIMConnectDaemon=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMConnectEventHandler=void 0;var r=a(n(2)),i=a(n(3)),o=n(0),s=n(8);function a(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){(0,r.default)(this,e),this._inited=!1}return(0,i.default)(e,[{key:"_init",value:function(){if(o.YYIMManager.getInstance().log("YYIMConnectEventHandler.prototype.registerHandler",3),!this._inited){var e=s.YYIMConnection.getInstance();e.registerHandler("onConnect",this.onConnected),e.registerHandler("onError",this.onConnectError),e.registerHandler("onDisconnect",this.onDisConnect),e.registerHandler("onStatusChanged",this.connectStatusChangeHandler),e.registerHandler(OPCODE.STREAM_ERROR.KEY,this.onStreamError),e.registerHandler(OPCODE.PACKET_ERROR.KEY,this.onPacketError),e.registerHandler("packet_in",e.getDaemon().pong.bind(e.getDaemon())),this._inited=!0}}},{key:"onConnected",value:function(){o.YYIMManager.getInstance().onOpened(),s.YYIMConnection.getInstance().getDaemon().startPing(!0)}},{key:"onConnectError",value:function(e){o.YYIMManager.getInstance().log("YYIMConnectEventHandler.prototype.onConnectError ",0,e);var t=e.getAttribute("code");s.YYIMConnection.getInstance().getDaemon().stopPing(!1),401==t?o.YYIMManager.getInstance().onAuthError({errorCode:401,message:"用户名或密码错误"}):409==t?o.YYIMManager.getInstance().onConflicted({errorCode:409,message:"连接冲突"}):4010==t?o.YYIMManager.getInstance().onClientKickout({errorCode:4010,message:"被客户端踢掉"}):4011==t?o.YYIMManager.getInstance().onUpdatePassword({errorCode:4011,message:"修改密码"}):o.YYIMManager.getInstance().onConnectError({errorCode:t,message:"连接失败"})}},{key:"onStreamError",value:function(e){o.YYIMManager.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,e),s.YYIMConnection.getInstance().getDaemon().stopPing(!1);var t=e.code;401==t?o.YYIMManager.getInstance().onAuthError({errorCode:401,message:"用户名或密码错误"}):409==t?o.YYIMManager.getInstance().onConflicted({errorCode:409,message:"连接冲突"}):4010==t?o.YYIMManager.getInstance().onClientKickout({errorCode:4010,message:"被客户端踢掉"}):4011==t?o.YYIMManager.getInstance().onUpdatePassword({errorCode:4011,message:"修改密码"}):o.YYIMManager.getInstance().onConnectError({errorCode:t,message:"连接失败"})}},{key:"onPacketError",value:function(e){o.YYIMManager.getInstance().log("YYIMConnectEventHandler.prototype.onPacketError ",0,e)}},{key:"onDisConnect",value:function(){o.YYIMManager.getInstance().onClosed(),s.YYIMConnection.getInstance().getDaemon().stopPing(!1)}},{key:"connectStatusChangeHandler",value:function(e){o.YYIMManager.getInstance().onStatusChanged(e)}}]),e}();t.YYIMConnectEventHandler=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YYIMConsoleLogger=void 0;var r,i=n(2),o=(r=i)&&r.__esModule?r:{default:r},u=n(4);t.YYIMConsoleLogger=function e(t){var a=this,c=arguments;(0,o.default)(this,e),this.level=t||(0==t?0:3),this.start=function(){},this.log=function(e,t,n,r){if(u.YYIMConfiguration.LOG.ENABLE&&!((t=t||(0==t?0:3))>a.level)&&"undefined"!=typeof console&&void 0!==console.group)try{switch(console.group(e),t){case 0:console.error(e),console.trace();break;case 1:console.warn(e),console.trace();break;case 2:console.info(e);break;case 4:console.debug(e);break;default:console.log(e)}var i=c.length;if(2<i)for(var o=2;o<i;o++){var s=c[o];s&&(s instanceof JSJaCPacket?console.info(s.doc.xml):console.debug(s))}console.groupEnd()}catch(e){try{console.error(e)}catch(e){}}},this.logParam=function(e){e=e||3;var t=a.logParam.caller;a.log("arguments:",e,t.arguments)},this.setLevel=function(e){return a.level=e,a},this.getLevel=function(){return a.level}}},function(e,t,n){"use strict";var r,i=n(14),o=(r=i)&&r.__esModule?r:{default:r},s=n(0),a=n(35);s.YYIMManager.prototype.setAIAbility=function(e){(e=e||{}).intelligentable?(0,a.setAIAbility)(e):e.error&&e.error()},s.YYIMManager.prototype.getAIWords=function(e){(0,a.getAIWords)(e||{})},s.YYIMManager.prototype.openAIAbility=function(e){this.isAIAbility=e},s.YYIMManager.prototype.openFilterWords=function(e){o.default.openFilterWords(e)},s.YYIMManager.prototype.setDictionaries=function(t){window.localStorage.intelligentWordsTime!=t&&s.YYIMChat.getAIWords({success:function(e){o.default.setDictionaries(e.intelligentWords||[]),window.localStorage.intelligentWordsTime=t},error:function(e){try{arg.error&&arg.error(JSON.parse(e.responseText)),arg=null}catch(e){arg.error&&arg.error(),arg=null}}})},s.YYIMManager.prototype.intelligentAnalysis=function(e){o.default.intelligentAnalysis(e)},s.YYIMManager.prototype.getMultiTerminals=function(e){(0,a.getMultiTerminals)(e||{})},s.YYIMManager.prototype.sendMultiTerminalsCommand=function(e){(0,a.sendMultiTerminalsCommand)(e||{})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendMultiTerminalsCommand=t.getMultiTerminals=t.getAIWords=t.setAIAbility=void 0;var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},s=n(0);t.setAIAbility=function(t){var e=s.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+s.YYIMChat.getUserID()+"/profile/intelligentable?token="+s.YYIMChat.getToken(),type:"post",data:(0,o.default)(t),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.getAIWords=function(t){var e=s.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+s.YYIMChat.getUserID()+"/intelligent/words?token="+s.YYIMChat.getToken()+"&apiKey="+s.YYIMChat.getApiKey(),type:"get",data:"",dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.getMultiTerminals=function(t){var e=s.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+s.YYIMChat.getUserID()+"/multiterminals?token="+s.YYIMChat.getToken(),type:"get",data:"",dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.sendMultiTerminalsCommand=function(t){var e=s.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+s.YYIMChat.getUserID()+"/multiterminals/command?token="+s.YYIMChat.getToken(),type:"POST",data:t.data,dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}},function(e,t,n){var r=n(6),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){"use strict";var r=n(0),i=n(38);r.YYIMManager.prototype.getRecentDigset=function(e){e.startDate=YYIMUtil.isWhateType(e.startDate,"Number")&&0<e.startDate?e.startDate:0,YYIMUtil.isWhateType(e.size,"Number")&&0<e.size||delete e.size,(0,i.getRecentDigset)(e)},r.YYIMManager.prototype.removeRecentDigest=function(e){e.id?(0,i.removeRecentDigest)(e):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeRecentDigest=t.getRecentDigset=void 0;var o=n(0);function i(e,t){var n={from:o.YYIMChat.getJIDUtil().getID(e.sender),to:o.YYIMChat.getJIDUtil().getID(e.receiver||o.YYIMChat.getUserID()),id:e.packetId,dateline:e.dateline||e.ts,type:t,sessionVersion:e.sessionVersion};if(t&&(t==o.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?n.from={room:o.YYIMChat.getJIDUtil().getID(e.mucid),roster:o.YYIMChat.getJIDUtil().getID(e.sender)}:t==o.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT&&(n.from={room:o.YYIMChat.getJIDUtil().getID(e.sender),roster:o.YYIMChat.getJIDUtil().getID(o.YYIMChat.getJIDUtil().getResource(e.sender))})),e.content){n.data=n.data||{};try{var r=function(e,t){if(e){var n=JSON.parse(e);try{isNaN(Number(n.content))&&t!=o.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT&&(n.content=JSON.parse(n.content),n.content.content&&(n.content=n.content.content))}catch(e){}return n}return null}(e.content,e.contentType);r&&(r.content||""===r.content)?n.data=r:n.data.content=r}catch(e){}if(n.data.contentType=e.contentType,n.data.dateline=e.dateline||e.ts,n.data.content&&n.data.contentType&&(n.data.contentType==o.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.IMAGE||n.data.contentType==o.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.FILE)&&(n.data.content.attachId=n.data.content.path,n.data.content.path=o.YYIMChat.getFileUrl(n.data.content.path)),o.YYIMChat.getJIDUtil().getID(e.sender)!=o.YYIMChat.getUserID()){var i={to:o.YYIMChat.getJIDUtil().getID(e.mucid||e.sender),id:n.id,type:n.type,sessionVersion:n.sessionVersion};n.data.receipt=i}}return n}t.getRecentDigset=function(r){var e=o.YYIMChat.getConfig(),t={startDate:r.startDate};r.size&&(t.size=r.size),jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+o.YYIMChat.getUserID()+"/contactsmessage/digests?token="+o.YYIMChat.getToken(),type:"get",data:t,dataType:"json",cache:!1,success:function(e){for(var t in e.list)if(e.list.hasOwnProperty(t)){var n=e.list[t];n.id=o.YYIMChat.getJIDUtil().getID(n.jid),n.type=o.YYIMChat.getJIDUtil().getChatTypeByJid(n.jid);try{n.lastMessage&&(n.lastMessage=i(JSON.parse(n.lastMessage),n.type))}catch(e){}}r.success&&r.success(e),r=null},error:function(e){try{r.error&&r.error(JSON.parse(e.responseText)),r=null}catch(e){r.error&&r.error(),r=null}}})},t.removeRecentDigest=function(t){var e=o.YYIMChat.getConfig(),n={chat:"user",groupchat:"room",pubaccount:"pub"};jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+o.YYIMChat.getUserID()+"/contacts/"+(n[t.type]||n.chat)+"/"+t.id+"?token="+o.YYIMChat.getToken(),type:"DELETE",dataType:"json",cache:!1,success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}},function(e,t,n){"use strict";var r=n(0),i=n(40);r.YYIMManager.prototype.getTransformFileList=function(e){e&&e.attachId?(0,i.getTransformFileList)(e):e&&e.error&&e.error()},r.YYIMManager.prototype.getFileUrl=function(e,t){if(e)return(0,i.getFileUrl)(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFileUrl=t.getTransformFileList=void 0;var r=n(0);t.getTransformFileList=function(t){jQuery.ajax({url:r.YYIMChat.getConfig().SERVLET.REST_TRANSFORM_SERVLET+"docInfo",type:"get",data:{attachId:t.attachId,token:r.YYIMChat.getToken(),downloader:r.YYIMChat.getUserNode()},dataType:"json",cache:!1,success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.getFileUrl=function(e,t){var n=r.YYIMChat.getConfig();if(e)return/^https?:\/\/|^data:image\/jpeg;/.test(e)?e:n.SERVLET.REST_RESOURCE_SERVLET+n.MULTI_TENANCY.ETP_KEY+"/"+n.MULTI_TENANCY.APP_KEY+"/download?"+jQuery.param({attachId:e,downloader:r.YYIMChat.getUserNode(),token:r.YYIMChat.getToken(),mediaType:1===t?t:2})}},function(e,t,n){"use strict";var o=n(0),s=n(42);o.YYIMManager.prototype.multiPartyCall=function(e){if(void 0!==e&&void 0!==e.caller&&YYIMArrayUtil.isArray(e.phones)&&e.phones.length)if(YYIMRegExp.phone.test(e.caller)){var t=[];for(var n in e.phones){var r=e.phones[n].toString();if(YYIMRegExp.phone.test(r)&&-1===t.indexOf(r)){t.push(r);var i=t.join(",");if(t.length>o.YYIMChat.getConfig().MULTIPARTYCALL.PARTYMAXLENGTH||i.length>o.YYIMChat.getConfig().MULTIPARTYCALL.PHONESMAXLENGTH){t.pop();break}}}t.length?(e.caller=e.caller.toString(),e.phones=t,!0===e.accountMmanaged||(e.phones=t.join(","),e.account=e.account?e.account:o.YYIMChat.getConfig().MULTIPARTYCALL.ACCOUNT,e.key=e.key?e.key:o.YYIMChat.getConfig().MULTIPARTYCALL.KEY,void 0!==e.account&&void 0!==e.key)?(0,s.multiPartyCall)(e):e.error&&e.error()):e.error&&e.error()}else e.error&&e.error();else e.error&&e.error()},o.YYIMManager.prototype.getTimeCorrection=function(e){(0,s.getTimeCorrection)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeCorrection=t.multiPartyCall=void 0;var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},s=n(0);var a=[];t.multiPartyCall=function(t){if(!0===t.accountMmanaged){var e={etpId:s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY,appId:s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY,caller:t.caller,phones:t.phones,username:s.YYIMManager.getInstance().getUserNode()};jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+"voip/make?token="+s.YYIMManager.getInstance().getToken(),type:"post",data:(0,o.default)(e),dataType:"json",cache:!1,processData:!1,contentType:"application/json",headers:{},success:t.success,error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}else{var n=(new Date).getTime();e={caller:t.caller,phones:t.phones,account_identify:t.account,userId:s.YYIMManager.getInstance().getUserBareJID(),timestamp:n,sign:hex_sha1(t.account+t.key+n)},jQuery.ajax({url:s.YYIMChat.getConfig().MULTIPARTYCALL.ADDRESS,type:"get",data:e,dataType:"jsonp",cache:!1,jsonp:"callback",success:t.success,error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}},t.getTimeCorrection=function i(o){var t,n,r;s.YYIMChat.getConfig().TIMECORRECTION.LOAD?o&&o(s.YYIMChat.getConfig().TIMECORRECTION.RESULT):(t={success:function(e,t){if(t<s.YYIMChat.getConfig().TIMECORRECTION.RESIDUAL)return s.YYIMChat.getConfig().TIMECORRECTION.LOAD=!0,s.YYIMChat.getConfig().TIMECORRECTION.RESULT=Math.round(e),o&&o(s.YYIMChat.getConfig().TIMECORRECTION.RESULT);if(a.push(e),a.length<s.YYIMChat.getConfig().TIMECORRECTION.TIMES)i(o);else{var n=0;for(var r in a)YYIMUtil.isWhateType(a[r],"Number")&&(n+=a[r]);a.length=0,s.YYIMChat.getConfig().TIMECORRECTION.LOAD=!0,s.YYIMChat.getConfig().TIMECORRECTION.RESULT=Math.round(n/s.YYIMChat.getConfig().TIMECORRECTION.TIMES),o&&o(s.YYIMChat.getConfig().TIMECORRECTION.RESULT)}}},r=0,jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_SYSTEM_SERVLET+"time",type:"get",cache:!1,beforeSend:function(){n=(new Date).getTime()},success:function(e){r=(new Date).getTime(),t&&t.success&&t.success(e-(n+r)/2,r-n),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}}))}},function(e,t,n){"use strict";var r=n(0),i=n(44);r.YYIMChat.setBackhander({monitor:{groupMonitor:i.monitor},initCallback:{group:function(e){r.YYIMChat.onGroupUpdate=e.onGroupUpdate||function(){},r.YYIMChat.onTransferGroupOwner=e.onTransferGroupOwner||function(){},r.YYIMChat.onKickedOutGroup=e.onKickedOutGroup||function(){}}}}),r.YYIMManager.prototype.getChatGroups=function(e){(e=e||{}).startDate=YYIMUtil.isWhateType(e.startDate,"Number")&&0<e.startDate?e.startDate:0,e.membersLimit=YYIMCommonUtil.isNumber(e.membersLimit)&&0<e.membersLimit?e.membersLimit:r.YYIMChat.getConfig().GROUP.MEMBERSLIMIT,(0,i.getChatGroups)(e)},r.YYIMManager.prototype.queryChatGroup=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.keyword)?(0,i.queryChatGroup)(e):e&&e.error&&e.error()},r.YYIMManager.prototype.joinChatGroup=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?(0,i.joinChatGroup)({jid:r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.id)),success:e.success,error:e.error}):e&&e.error&&e.error()},r.YYIMManager.prototype.getChatGroupInfo=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?(0,i.getChatGroupInfo)({jid:r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.id)),membersLimit:YYIMCommonUtil.isNumber(e.membersLimit)&&0<e.membersLimit?e.membersLimit:r.YYIMChat.getConfig().GROUP.MEMBERSLIMIT,success:e.success,error:e.error}):e&&e.error&&e.error()},r.YYIMManager.prototype.createChatGroup=function(e){YYIMArrayUtil.isArray(e.members)||delete e.members,e.members?(0,i.createChatGroup)(e):e&&e.error&&e.error()},r.YYIMManager.prototype.transferChatGroup=function(e){e&&"string"==typeof e.newOwner&&e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.transferChatGroup)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.dismissChatGroup=function(e){e&&e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.dismissChatGroup)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.inviteGroupMember=function(e){e.members&&YYIMArrayUtil.isArray(e.members)&&e.members.length&&e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.inviteGroupMember)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.modifyChatGroupInfo=function(e){e.name&&e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.modifyChatGroupInfo)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.kickGroupMember=function(e){e.member&&"string"==typeof e.member&&e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.kickGroupMember)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.exitChatGroup=function(e){e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),(0,i.exitChatGroup)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.collectGroup=function(e){e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),e.type=this.getConstants().COLLECT_TYPE.ADD,(0,i.collectChatGroup)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.removeCollectGroup=function(e){e.to?(e.to=r.YYIMChat.getJIDUtil().buildChatGroupJID(r.YYIMChat.getJIDUtil().getNode(e.to)),e.type=this.getConstants().COLLECT_TYPE.REMOVE,(0,i.collectChatGroup)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.getSharedFiles=function(e){e&&e.id?(0,i.getSharedFiles)(e):e&&e.error&&e.error()},r.YYIMManager.prototype.getGroupMembers=function(e){e&&e.id?YYIMCommonUtil.isStringAndNotEmpty(e.id)&&(0,i.getGroupMembers)(e):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.collectChatGroup=t.exitChatGroup=t.kickGroupMember=t.modifyChatGroupInfo=t.inviteGroupMember=t.getSharedFiles=t.dismissChatGroup=t.transferChatGroup=t.createChatGroup=t.getChatGroups=t.getChatGroupInfo=t.joinChatGroup=t.getGroupMembers=t.queryChatGroup=t.monitor=void 0;var a=n(0);function o(e){if(e){for(var t=e.members.length,n=[];t--;){var r=e.members[t];r.id=a.YYIMChat.getJIDUtil().getID(r.jid),n.push(r)}return{id:a.YYIMChat.getJIDUtil().getID(e.from||e.jid),name:e.naturalLanguageName||e.roomname||e.name,photo:e.photo,numberOfMembers:e.numberOfMembers,superLarge:e.superLarge,collected:e.collected,type:e.type,safeModel:e.safeModel,creationdate:e.creationdate,creater:a.YYIMChat.getJIDUtil().getID(e.operator),members:n,owners:e.owners,tag:e.tag}}}function r(e){if(e){for(var t=e.memberItems.length,n=[];t--;){var r=e.memberItems[t];r.id=a.YYIMChat.getJIDUtil().getID(r.jid),n.push(r)}return{id:a.YYIMChat.getJIDUtil().getID(e.from),members:n}}}t.monitor=function(){a.YYIMChat.getConnection().registerHandler(OPCODE.ON_GROUP_UPDATE.KEY,function(e){var t=o(e);t&&a.YYIMChat.onGroupUpdate(t)}),a.YYIMChat.getConnection().registerHandler(OPCODE.ON_GROUP_TRANSFER.KEY,function(e){var t=r(e);t&&a.YYIMChat.onTransferGroupOwner(t)}),a.YYIMChat.getConnection().registerHandler(OPCODE.KICKED_GROUP.KEY,function(e){var t={id:e.id,from:a.YYIMChat.getJIDUtil().getID(e.from),to:a.YYIMChat.getJIDUtil().getID(e.to)};a.YYIMChat.onKickedOutGroup(t)})},t.queryChatGroup=function(e){var t={start:YYIMCommonUtil.isNumber(e.start)?e.start:0,size:YYIMCommonUtil.isNumber(e.size)?e.size:20,search:e.keyword};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.QUERY_CHATGROUP.SEND),function(e,t){for(var n=e.items||[],r=n.length;r--;){var i=n[r];n[r].id=a.YYIMChat.getJIDUtil().getID(i.jid),n[r].name=n[r].name||n[r].id}t.complete&&t.complete(),t.success&&t.success({start:e.start,total:e.total,items:n})},e)},t.getGroupMembers=function(n){var e=a.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+a.YYIMChat.getUserID()+"/room/members?mucId="+n.id+"&token="+a.YYIMChat.getToken(),type:"get",dataType:"json",cache:!1,success:function(e){if(e&&e.length)for(var t=e.length;t--;)e[t].id=a.YYIMChat.getJIDUtil().getID(e[t].jid);n.success&&n.success(e||[]),n=null},error:function(){try{n.error&&n.error(JSON.parse(xhr.responseText)),n=null}catch(e){n.error&&n.error(),n=null}}})},t.joinChatGroup=function(e){var t={to:e.jid+"/"+a.YYIMChat.getUserNode()};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.CHATGROUP.SEND),function(e,t){e&&"40301"==e.code?t.error&&t.error({code:e.code,message:e.message}):e&&(e.id=a.YYIMChat.getJIDUtil().getID(e.from),t.success&&t.success(e))},e)},t.getChatGroupInfo=function(n){var e=a.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+a.YYIMChat.getUserID()+"/room/info?membersLimit="+n.membersLimit+"&mucId="+n.jid+"&token="+a.YYIMChat.getToken(),type:"get",dataType:"json",cache:!1,success:function(e){var t=o(e);n.success&&n.success(t),n=null},error:function(e){try{n.error&&n.error(JSON.parse(e.responseText)),n=null}catch(e){n.error&&n.error(),n=null}}})},t.getChatGroups=function(i){var e=a.YYIMChat.getConfig();jQuery.ajax({url:e.SERVLET.REST_USER_SERVLET+e.MULTI_TENANCY.ETP_KEY+"/"+e.MULTI_TENANCY.APP_KEY+"/"+a.YYIMChat.getUserID()+"/room/contacts/increment?timestamp="+i.startDate+"&token="+a.YYIMChat.getToken()+"&membersLimit="+i.membersLimit,type:"get",dataType:"json",cache:!1,success:function(e){if(e){e.roomItems=e.roomItems||[],e.roomNames=e.roomNames||[],e.leftRooms=e.leftRooms||[];for(var t=e.roomItems.length||0;t--;)e.roomItems[t]=o(e.roomItems[t]);for(var n=e.roomNames.length||0;n--;)e.roomNames[n]=a.YYIMChat.getJIDUtil().getID(e.roomNames[n]);for(var r=e.leftRooms.length||0;r--;)e.leftRooms[r]=a.YYIMChat.getJIDUtil().getID(e.leftRooms[r])}i.success&&i.success(e||{}),i=null},error:function(e){try{i.error&&i.error(JSON.parse(e.responseText)),i=null}catch(e){i.error&&i.error(),i=null}}})},t.createChatGroup=function(e){var t={id:Math.uuid(),to:e.to,naturalLanguageName:e.name,from:a.YYIMChat.getUserBareJID(),invitees:e.members};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.CREATE_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(o(e))},e)},t.transferChatGroup=function(e){var t={id:Math.uuid(),to:e.to,from:a.YYIMChat.getUserBareJID(),newOwner:e.newOwner};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.TRANSFER_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(r(e))},e)},t.dismissChatGroup=function(e){var t={id:Math.uuid(),to:e.to,from:a.YYIMChat.getUserBareJID()};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.DISMISS_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success({id:e.id,from:a.YYIMChat.getJIDUtil().getID(e.from),to:a.YYIMChat.getJIDUtil().getID(e.to)})},e)},t.getSharedFiles=function(o){var e=a.YYIMChat.getConstants(),t=a.YYIMChat.getConfig(),s=-1<[e.CHAT_TYPE.CHAT,e.CHAT_TYPE.GROUP_CHAT,e.CHAT_TYPE.PUB_ACCOUNT].indexOf(o.type)?o.type:e.CHAT_TYPE.CHAT,n=t.SERVLET.REST_USER_SERVLET+t.MULTI_TENANCY.ETP_KEY+"/"+t.MULTI_TENANCY.APP_KEY+"/shareattachment/persional/attachment/"+a.YYIMChat.getUserID()+"/"+o.id;s==e.CHAT_TYPE.GROUP_CHAT&&(n=t.SERVLET.REST_USER_SERVLET+t.MULTI_TENANCY.ETP_KEY+"/"+t.MULTI_TENANCY.APP_KEY+"/shareattachment/room/attachment/"+o.id+"/"+a.YYIMChat.getUserID()),jQuery.ajax({url:n,data:{token:a.YYIMChat.getToken(),fileType:-1<["file","image","microvideo"].indexOf(o.fileType)?o.fileType:"file",start:parseInt(o.start)||0,size:parseInt(o.size)||20},type:"get",dataType:"json",cache:!1,success:function(e){var t=e.list||[];for(i=t.length;i--;){var n=t[i];if(n.id=n.packetId,n.creator=a.YYIMChat.getJIDUtil().getID(n.creator),n.owner=[],s==a.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT)n.owner.push({id:a.YYIMChat.getJIDUtil().getID(n.ownerId),type:s});else{var r=n.ownerId.split("::");r[0]=a.YYIMChat.getJIDUtil().getID(r[0]),r[1]=a.YYIMChat.getJIDUtil().getID(r[1]),n.owner.push({id:r[0],type:s},{id:r[1],type:s})}delete n.ownerId}o.success&&o.success(e),o=null},error:function(e){try{o.error&&o.error(JSON.parse(e.responseText)),o=null}catch(e){o.error&&o.error(),o=null}}})},t.inviteGroupMember=function(e){var t={id:Math.uuid(),to:e.to,from:a.YYIMChat.getUserBareJID(),invitees:e.members};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.INVITE_GROUP_MEMBER.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(o(e))},e)},t.modifyChatGroupInfo=function(e){var t={id:Math.uuid(),naturalLanguageName:e.name,from:a.YYIMChat.getUserBareJID(),to:e.to};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.MODIFY_GROUP_INFO.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(o(e))},e)},t.kickGroupMember=function(e){var t={id:Math.uuid(),member:e.member,from:a.YYIMChat.getUserBareJID(),to:e.to};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.KICK_GROUP_MEMBER.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(o(e))},e)},t.exitChatGroup=function(e){var t={id:Math.uuid(),from:a.YYIMChat.getUserBareJID(),to:e.to};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.EXIT_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success({from:a.YYIMChat.getJIDUtil().getID(e.from),id:e.id,to:a.YYIMChat.getJIDUtil().getID(e.to)})},e)},t.collectChatGroup=function(e){var t={id:Math.uuid(),from:a.YYIMChat.getUserBareJID(),to:e.to,type:e.type};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.COLLECT_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success({from:a.YYIMChat.getJIDUtil().getID(t.to),id:e.id,to:a.YYIMChat.getUserID(),type:t.type,code:e.code,message:e.message})},e)}},function(e,t,n){"use strict";var r=n(0),i=n(46);r.YYIMChat.setBackhander({monitor:{inputStateMonitor:i.monitor}}),r.YYIMManager.prototype.inputStateChange=function(e){e&&e.to?(e.contentType=e.contentType||r.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT,(0,i.inputStateChange)(e)):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputStateChange=t.monitor=void 0;var r=n(0);var i={};function o(e){var t={id:Math.uuid(),to:r.YYIMChat.getJIDUtil().buildUserJID(r.YYIMChat.getJIDUtil().getNode(e.to)),contentType:e.contentType,typing:e.typing};r.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.INPUT_STATE.SEND))}var s={};t.monitor=function(){r.YYIMChat.getConnection().registerHandler(OPCODE.INPUT_STATE.KEY,function(e){e&&e.from&&(e.from=r.YYIMChat.getJIDUtil().getID(e.from)),e&&e.to&&(e.to=r.YYIMChat.getJIDUtil().getID(e.to)),function(t){if(i[t.from]=i[t.from]||{timer:0,param:t},i[t.from].param=t,i[t.from].timer&&(clearTimeout(i[t.from].timer),i[t.from].timer=0),0==t.typing){var e=i[t.from].param;i[t.from]=null,r.YYIMChat.onInputStateChanged(e)}else r.YYIMChat.onInputStateChanged(i[t.from].param),i[t.from].timer=setTimeout(function(){var e=i[t.from].param;e.typing=0,i[t.from]=null,r.YYIMChat.onInputStateChanged(e)},i[t.from].param.timeout||r.YYIMChat.getConfig().INPUT_STATE.INTERVAL)}(e)})},t.inputStateChange=function(t){s[t.to]=s[t.to]||{timer:0,param:t,lastUpdateTime:0,lastSendTime:0},s[t.to].timer&&(clearTimeout(s[t.to].timer),s[t.to].timer=0),s[t.to].lastUpdateTime=(new Date).getTime(),(s[t.to].lastUpdateTime-s[t.to].lastSendTime>r.YYIMChat.getConfig().INPUT_STATE.INTERVAL||t.contentType!=s[t.to].param.contentType)&&(s[t.to].param=t,s[t.to].param.typing=1,s[t.to].lastSendTime=s[t.to].lastUpdateTime,o(s[t.to].param)),s[t.to].timer=setTimeout(function(){var e=s[t.to].param;e.typing=0,s[t.to]=null,o(e)},r.YYIMChat.getConfig().INPUT_STATE.INTERVAL)}},function(e,t,n){"use strict";var s=n(0),o=n(48);s.YYIMChat.setBackhander({monitor:{messageMonitor:o.monitor},initCallback:{message:function(e){s.YYIMChat.onReceipts=e.onReceipts||function(){},s.YYIMChat.onMessage=e.onMessage||function(){},s.YYIMChat.onTransparentMessage=e.onTransparentMessage||function(){}}}}),s.YYIMManager.prototype.getHistoryMessage=function(e){e=e||{},YYIMUtil.isWhateType(e.start,"Number")||(e.start=0),YYIMUtil.isWhateType(e.size,"Number")||(e.size=100),(0,o.getHistoryMessage)(e)},s.YYIMManager.prototype.sendReadedReceiptsPacket=function(e){e&&e.id&&(e.state=2,(0,o.sendReceiptsPacket)(e))},s.YYIMManager.prototype.sendTextMessage=function(e){e.content=e.msg||e.content,e.contentType=s.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT,this.sendMessage(e)},s.YYIMManager.prototype.sendPic=function(t){t=t||{},YYIMUtil.isWhateType(t.chatInfo,"Function")?this.uploader(jQuery("#"+t.fileInputId)[0]||t.fileInputId,{drop_element:t.drop_element,chatInfo:t.chatInfo,fileFiltered:t.fileFiltered,beforeUpload:t.beforeUpload,mediaType:1,success:function(e){(0,o.sendMessage)({id:e.chatInfo.messageId||Math.uuid(),spaceId:e.chatInfo.spaceId,body:{extend:e.chatInfo.extend,content:new IMFile({id:e.file.id,name:e.file.name,path:e.data&&e.data.attachId,size:e.file.size,original:1}),contentType:s.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.IMAGE},to:e.chatInfo.to,type:e.chatInfo.type,success:function(e){t.success&&t.success(e)}}),t.fileUploaded&&t.fileUploaded(e)},error:t.error,progress:t.progress}):t&&t.error&&t.error()},s.YYIMManager.prototype.sendFile=function(r){var i=this;r=r||{},YYIMUtil.isWhateType(r.chatInfo,"Function")?this.uploader(jQuery("#"+r.fileInputId)[0]||r.fileInputId,{drop_element:r.drop_element,chatInfo:r.chatInfo,fileFiltered:r.fileFiltered,beforeUpload:r.beforeUpload,mediaType:3,success:function(e){var t=3;s.YYIMChat.getConfig().UPLOAD.IMAGE_TYPES.test(e.file.name)&&(t=1);var n=new IMFile({id:e.file.id,name:e.file.name,path:e.data&&e.data.attachId,size:e.file.size});1===t&&n.build({original:1}),e&&e.data&&e.data.data&&e.data.data.fileUrl&&n.build({path:e.data.data.fileUrl,fid:e.data.data.fid}),YYIMUtil.isWhateType(e.data,"Array")&&(n=new IMFile({id:e.file.id,name:e.file.name,path:e.data[4],size:e.file.size,fid:e.data[0]})),(0,o.sendMessage)({id:e.chatInfo.messageId||Math.uuid(),spaceId:e.chatInfo.spaceId,body:{extend:e.chatInfo.extend,content:n,contentType:1===t?i.getConstants().MESSAGE_CONTENT_TYPE.IMAGE:i.getConstants().MESSAGE_CONTENT_TYPE.FILE},to:e.chatInfo.to,type:e.chatInfo.type,success:function(e){r.success&&r.success(e)}}),r.fileUploaded&&r.fileUploaded(e)},error:r.error,progress:r.progress}):r&&r.error&&r.error()},s.YYIMManager.prototype.sendShareMessage=function(e){e.contentType=s.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.SHARE,this.sendMessage(e)},s.YYIMManager.prototype.sendFormMessage=function(n){var r=this,i=n.file,o={token:this.getToken(),creator:this.getUserNode(),receiver:this.getJIDUtil().getNode(n.to),mediaType:n.mediaType||2,randomId:Math.uuid(),name:i.name,size:i.size},e=s.YYIMChat.getConfig().SERVLET.REST_RESOURCE_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/upload";e+="?"+jQuery.param(o),jQuery.ajax({xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;n.progress&&n.progress({loaded:e.loaded,total:e.total,percent:t})}},!1),e.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;n.progress&&n.progress({loaded:e.loaded,total:e.total,percent:t})}},!1),e},url:e,type:"post",dataType:"json",data:n.data,processData:!1,contentType:!1,success:function(e){if(e&&e.attachId){var t=s.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE;n.fileUploaded&&n.fileUploaded(e),r.sendMessage({id:n.id,to:n.to,spaceId:n.spaceId,type:n.type,content:new IMFile({name:i.name,path:e.attachId,size:i.size,original:1===o.mediaType?1:null}),contentType:1===o.mediaType?t.IMAGE:t.FILE,success:n.success,error:n.error})}else n.error&&n.error();n=null},error:n.error})},s.YYIMManager.prototype.sendMessage=function(e){e.id=e.id||Math.uuid(),e.type=e.type||s.YYIMChat.getConstants().CHAT_TYPE.CHAT,e.body={dateline:e.dateline,extend:e.extend,content:e.content,contentType:e.contentType,sceneParams:e.sceneParams},e.type===s.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT&&YYIMArrayUtil.isArray(e.atuser)&&(e.body.atuser=e.atuser),(0,o.sendMessage)(e)},s.YYIMManager.prototype.revokeMessage=function(e){e&&e.id?(0,o.revokeMessage)(e):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendReceiptsPacket=t.revokeMessage=t.getHistoryMessage=t.sendMessage=t.monitor=void 0;var a=r(n(1)),c=r(n(14)),u=n(0);function r(e){return e&&e.__esModule?e:{default:e}}var i=new BaseList;function o(t,e){if(!i.get(t.id)){if(i.set(t.id,t),t.type=e||u.YYIMChat.getJIDUtil().getChatTypeByJid(t.from),t.to=u.YYIMChat.getJIDUtil().getID(t.to)||u.YYIMChat.getUserID(),t.from=t.type!=u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?u.YYIMChat.getJIDUtil().getID(t.from):{room:u.YYIMChat.getJIDUtil().getID(t.from),roster:u.YYIMChat.getJIDUtil().getID(u.YYIMChat.getJIDUtil().getResource(t.from))},t.attributes&&(t.attributes.receiver&&(t.attributes.receiver=u.YYIMChat.getJIDUtil().getID(t.attributes.receiver)),t.attributes.bareJID&&(t.attributes.bareJID={id:u.YYIMChat.getJIDUtil().getID(t.attributes.bareJID),type:u.YYIMChat.getJIDUtil().getChatTypeByJid(t.attributes.bareJID)}),t.attributes.userJids&&u.YYIMChat.getUtil().isWhateType(t.attributes.userJids,"Array")))for(var n in t.attributes.userJids)t.attributes.userJids.hasOwnProperty(n)&&(t.attributes.userJids[n]=u.YYIMChat.getJIDUtil().getID(t.attributes.userJids[n]));try{u.YYIMChat.onTransparentMessage(t)}catch(e){u.YYIMChat.log("TransparentMessHandleError:",0,t)}}}function s(t,e){var n;try{if((n=JSON.parse(t.content))&&n.content)try{isNaN(Number(n.content))&&t.contentType!=u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT&&(n.content=JSON.parse(n.content))}catch(e){}}catch(e){n=t.content}var r=n;void 0!==n.content&&(r=n.content);var i={content:r,contentType:t.contentType,dateline:t.dateline||t.ts,atuser:n.atuser,extend:n.extend};if(t.contentType==u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.MERGEFORWARD&&(i.title=n.title,i.containfileNum=n.containfileNum,i.safeMode=n.safeMode,n.messages))for(var o in i.messages=[],n.messages)if(n.messages.hasOwnProperty(o)){var s=arguments.callee(n.messages[o],e);s&&i.messages.push(s)}var a=e==u.YYIMChat.getConstants().CHAT_TYPE.CHAT?u.YYIMChat.getJIDUtil().getID(t.sender||t.from):{room:u.YYIMChat.getJIDUtil().getID(t.mucid||t.sender||t.from),roster:u.YYIMChat.getJIDUtil().getID(u.YYIMChat.getJIDUtil().getResource(t.sender||t.from)||t.sender)},c={id:t.id||t.packetId,type:e,from:a,dateline:i.dateline,sessionVersion:t.sessionVersion,data:i};if(e==u.YYIMChat.getConstants().CHAT_TYPE.CHAT?(c.resource=u.YYIMChat.getJIDUtil().getResource(t.sender||t.from),c.to=u.YYIMChat.getJIDUtil().getID(t.receiver||t.to)):c.to=u.YYIMChat.getUserID(),i.contentType)return c.data.content&&c.data.content.path&&(c.data.content.attachId=c.data.content.path,c.data.content.path=u.YYIMChat.getFileUrl(c.data.content.path),i.contentType!=u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.FILE&&i.contentType!=u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.IMAGE||(c.data.content.size=c.data.content.size||0)),!c.data||!0!==t.receipts&&u.YYIMChat.getJIDUtil().getID(t.sender||t.from)==u.YYIMChat.getUserID()||(c.data.receipt={to:t.mucid||t.sender||t.from,id:t.id||t.packetId,type:e,sessionVersion:t.sessionVersion},!0===t.receipts&&d(c.data.receipt)),c}function l(e,t){if(!i.get(e.id)){i.set(e.id,e);var n=s(e,t);if(n)try{u.YYIMChat.onMessage(n)}catch(e){u.YYIMChat.log("ParseMessageError:",0,n,e)}}}function h(e,t,n){var r={id:e.id,type:e.type,sessionVersion:n.sessionVersion||0,data:{content:t.content,contentType:t.contentType,dateline:n.dateline,extend:t.extend}};return r.type!=u.YYIMChat.getConstants().CHAT_TYPE.CHAT?(r.to=u.YYIMChat.getUserID(),r.from={room:u.YYIMChat.getJIDUtil().getID(e.to),roster:u.YYIMChat.getUserID()}):(r.to=u.YYIMChat.getJIDUtil().getID(e.to),r.from=u.YYIMChat.getUserID(),r.resource=u.YYIMChat.getResource()),r.data.content.path&&(r.data.content.attachId=r.data.content.path,r.data.content.path=u.YYIMChat.getFileUrl(r.data.content.path)),r}function d(e){e=e||{};var t=u.YYIMChat.getJIDUtil().buildUserJID(u.YYIMChat.getJIDUtil().getNode(e.to));e.type==u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?t=u.YYIMChat.getJIDUtil().buildChatGroupJID(u.YYIMChat.getJIDUtil().getNode(e.to)):e.type==u.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT&&(t=u.YYIMChat.getJIDUtil().buildPubAccountJID(u.YYIMChat.getJIDUtil().getNode(e.to)));var n=new JumpPacket({to:t,dateline:(new Date).getTime(),sessionVersion:e.sessionVersion,id:e.id,state:e.state},OPCODE.RECEIPTS.SEND);u.YYIMChat.getConnection().send(n)}t.monitor=function(){u.YYIMChat.getConnection().registerHandler(OPCODE.USER_MESSAGE.KEY,function(e){l(e,u.YYIMChat.getConstants().CHAT_TYPE.CHAT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.CHATGROUP_MESSAGE.KEY,function(e){l(e,u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.PUBACCOUNT_MESSAGE.KEY,function(e){l(e,u.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.RECEIPTS.KEY,function(e){e.type=u.YYIMChat.getJIDUtil().getChatTypeByJid(e.to),e.from=u.YYIMChat.getJIDUtil().getID(e.from),e.to=u.YYIMChat.getJIDUtil().getID(e.to),u.YYIMChat.onReceipts(e)}),u.YYIMChat.getConnection().registerHandler(OPCODE.SYNC_MESSAGE.KEY,function(e){l(e,e.type)}),u.YYIMChat.getConnection().registerHandler(OPCODE.USERONLINEDELIVERPACKET.KEY,function(e){o(e,u.YYIMChat.getConstants().CHAT_TYPE.CHAT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.MUCONLINEDELIVERPACKET.KEY,function(e){o(e,u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.PUBONLINEDELIVERPACKET.KEY,function(e){o(e,u.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT)}),u.YYIMChat.getConnection().registerHandler(OPCODE.REMINDSETTINGONLINEDELIVERPACKET.KEY,function(e){o(e)})},t.sendMessage=function(t){var e,n,r=t.body||{};if(r.extend=(n={intelligentAnalysis:{}},(e=r).contentType&&e.contentType==u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT&&(e.extend&&"string"!=typeof e.extend&&(n=e.extend),c.default.intelligentAnalysis(e.content)&&(n.intelligentAnalysis.intelligentable=!0,e.sceneParams&&(n.intelligentAnalysis.params=e.sceneParams,delete e.sceneParams))),n),r.extend&&"string"!=typeof r.extend)try{r.extend=(0,a.default)(r.extend)}catch(e){delete r.extend,u.YYIMChat.log("ExtendIllegal",0,e.message)}var i,o={id:t.id,spaceId:t.spaceId,type:t.type||u.YYIMChat.getConstants().CHAT_TYPE.CHAT,contentType:r.contentType||u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT,dateline:r.dateline||(u.YYIMChat.getConfig().TIMECORRECTION.AUTOCORRECTION?(new Date).getTime()+u.YYIMChat.getConfig().TIMECORRECTION.RESULT:(new Date).getTime()),content:(0,a.default)({atuser:r.atuser,extend:r.extend,content:r.content})},s=OPCODE.USER_MESSAGE.SEND;r.contentType&&r.contentType!=u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE.TEXT||t.type!=u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT||YYIMUtil.isWhateType(r.atuser,"Array")&&r.atuser.length&&(-1!=r.atuser.indexOf("im_atall")?o.statRead=1:(o.statRead=2,o.statMem=r.atuser)),t.type==u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?(i=u.YYIMChat.getJIDUtil().buildChatGroupJID(u.YYIMChat.getJIDUtil().getNode(t.to)),s=OPCODE.CHATGROUP_MESSAGE.SEND):t.type==u.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT?(i=u.YYIMChat.getJIDUtil().buildPubAccountJID(u.YYIMChat.getJIDUtil().getNode(t.to)),s=OPCODE.PUBACCOUNT_MESSAGE.SEND):(o.receipts="1",i=t.resource&&t.to==u.YYIMChat.getUserID()?u.YYIMChat.getJIDUtil().buildUserJID(u.YYIMChat.getJIDUtil().getNode(t.to),t.resource):u.YYIMChat.getJIDUtil().buildUserJID(u.YYIMChat.getJIDUtil().getNode(t.to))),o.to=i,u.YYIMChat.getConnection().send(new JumpPacket(o,s),function(e){40302==e.code?(t.error&&t.error(),t=null):u.YYIMChat.getConfig().TIMECORRECTION.AUTOCORRECTION?e&&1==e.state&&u.YYIMChat.onReceipts(e):(t.success&&t.success(h(t,r,e)),t=null)}),u.YYIMChat.getConfig().TIMECORRECTION.AUTOCORRECTION&&t.success&&t.success(h(t,r,{dateline:o.dateline}))},t.getHistoryMessage=function(t){var e,n,r={token:u.YYIMChat.getToken(),start:t.start||0,size:t.size||100};if(t.type==u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT)n="groupchat";else if(t.type==u.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT)n="pubaccount";else if(n="user",t.contentType){var i=u.YYIMChat.getConstants().MESSAGE_CONTENT_TYPE;for(var o in i)if(t.contentType==i[o]){r.contentType=t.contentType;break}}e=u.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+u.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+u.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+u.YYIMChat.getUserID()+"/msghistory/"+n+"/"+t.id+"/version/"+(t.startVersion||0)+"/"+t.endVersion,e+="?"+jQuery.param(r),u.YYIMChat.log("历史记录：request URL",2,e),jQuery.ajax({url:e,dataType:"json",cache:!1,success:function(e){!function(e,t){u.YYIMChat.log("历史记录：data",2,e);var n=[];for(var r in e.list)if(e.list.hasOwnProperty(r)){var i=e.list[r],o=s(i,t.type);n.push(o)}t.success&&t.success({contactReadVersion:e.contactReadVersion,total:e.total,result:n})}(e,t),t=null},error:function(e){u.YYIMChat.log("getHistoryMessage_error:",0,e.statusText);try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.revokeMessage=function(t){var e,n;t.type==u.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?(e=u.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+u.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+u.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/revokeservice/groupmessage/"+t.id,n={token:u.YYIMChat.getToken(),userid:u.YYIMChat.getUserNode(),mucid:u.YYIMChat.getJIDUtil().getNode(t.to)}):(e=u.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+u.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+u.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/revokeservice/personalmessage/"+t.id,n={token:u.YYIMChat.getToken(),fromuserid:u.YYIMChat.getUserNode(),touserid:u.YYIMChat.getJIDUtil().getNode(t.to)}),e+="?"+jQuery.param(n),jQuery.ajax({url:e,type:"post",cache:!1,success:function(e){t.success&&t.success({id:t.id}),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.sendReceiptsPacket=d},function(e,t,n){"use strict";var r=n(0),i=n(50);r.YYIMManager.prototype.stick=function(e){(e=e||{}).to?(e.handle="stick",(0,i.muteStick)(e)):e.error&&e.error()},r.YYIMManager.prototype.cancelStick=function(e){e&&e.to?(e.handle="stick",(0,i.cancelMuteStick)(e)):e&&e.error&&e.error()},r.YYIMManager.prototype.mute=function(e){(e=e||{}).to?(e.handle="mute",(0,i.muteStick)(e)):e.error&&e.error()},r.YYIMManager.prototype.cancelMute=function(t){var n=this;t&&t.to?(0,i.cancelMuteStick)({to:t.to,type:t.type,handle:"mute",success:function(e){t.type==n.getConstants().CHAT_TYPE.GROUP_CHAT?n.removeGroupAssistant({id:t.to,success:function(){t.success&&t.success(e)},error:t.error}):t.success&&t.success(e)},error:t.error}):t&&t.error&&t.error()},r.YYIMManager.prototype.getProfile=function(n){(0,i.getProfile)({success:function(e){e.intelligentable;var t=e.intelligentWordsTime;t&&r.YYIMChat.setDictionaries(t),n.success&&n.success(e)},error:function(e){n.error&&n.error(errot)}})},r.YYIMManager.prototype.createProfile=function(e){(e=e||{}).profile?(0,i.createProfile)(e):e.error&&e.error()},r.YYIMManager.prototype.removeProfile=function(e){e=e||{},YYIMArrayUtil.isArray(e.profiles)?(0,i.removeProfile)(e):e.error&&e.error()},r.YYIMManager.prototype.clearProfile=function(e){(0,i.clearProfile)(e||{})},r.YYIMManager.prototype.removeGroupAssistant=function(e){e&&e.id?(0,i.removeGroupAssistant)(e):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeGroupAssistant=t.clearProfile=t.removeProfile=t.createProfile=t.cancelMuteStick=t.muteStick=t.getProfile=void 0;var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},s=n(0);t.getProfile=function(o){var e=s.YYIMManager.getInstance().getApiKey();e&&(e="&apiKey="+e),jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile?token="+s.YYIMManager.getInstance().getToken()+e,type:"get",cache:!1,datatype:"json",success:function(e){if(e.muteItems){var t={};for(var n in e.muteItems){var r=s.YYIMChat.getJIDUtil().getID(e.muteItems[n]),i=s.YYIMChat.getJIDUtil().getChatTypeByJid(e.muteItems[n]);t[r]={id:r,type:i}}e.muteItems=t}if(e.stickItems){for(var n in t={},e.stickItems)r=s.YYIMChat.getJIDUtil().getID(e.stickItems[n]),i=s.YYIMChat.getJIDUtil().getChatTypeByJid(e.stickItems[n]),t[r]={id:r,type:i};e.stickItems=t}e.userId&&(e.userId=s.YYIMChat.getJIDUtil().getID(e.userId)),o.success&&o.success(e),o=null},error:function(e){try{o.error&&o.error(JSON.parse(e.responseText)),o=null}catch(e){o.error&&o.error(),o=null}}})},t.muteStick=function(t){var e;e=t.type==s.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?s.YYIMChat.getJIDUtil().buildChatGroupJID(s.YYIMChat.getJIDUtil().getNode(t.to)):t.type==s.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT?s.YYIMChat.getJIDUtil().buildPubAccountJID(s.YYIMChat.getJIDUtil().getNode(t.to)):s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(t.to)),t.handle="mute"===t.handle?t.handle:"stick",jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile/"+t.handle+"?token="+s.YYIMManager.getInstance().getToken(),type:"post",data:(0,o.default)({bareJID:e}),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success({id:t.to,type:t.type}),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.cancelMuteStick=function(t){var e;e=t.type==s.YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT?s.YYIMChat.getJIDUtil().buildChatGroupJID(s.YYIMChat.getJIDUtil().getNode(t.to)):t.type==s.YYIMChat.getConstants().CHAT_TYPE.PUB_ACCOUNT?s.YYIMChat.getJIDUtil().buildPubAccountJID(s.YYIMChat.getJIDUtil().getNode(t.to)):s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(t.to)),jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile/"+("mute"===t.handle?"mute":"stick")+"?token="+s.YYIMManager.getInstance().getToken()+"&bareJID="+e,type:"DELETE",dataType:"json",success:function(e){t.success&&t.success({id:t.to,type:t.type}),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.createProfile=function(t){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile?token="+s.YYIMManager.getInstance().getToken(),type:"post",data:(0,o.default)(t.profile),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(t.profile),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.removeProfile=function(t){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile?token="+s.YYIMManager.getInstance().getToken(),type:"PUT",data:(0,o.default)(t.profiles),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(t.profiles),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.clearProfile=function(t){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile?token="+s.YYIMManager.getInstance().getToken(),type:"DELETE",dataType:"json",cache:!1,success:function(e){t.success&&t.success(),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.removeGroupAssistant=function(t){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+s.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+s.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+s.YYIMManager.getInstance().getUserID()+"/profile/groupassistant?token="+s.YYIMManager.getInstance().getToken()+"&bareJID="+s.YYIMChat.getJIDUtil().buildChatGroupJID(s.YYIMChat.getJIDUtil().getNode(t.id)),type:"DELETE",dataType:"json",cache:!1,success:function(e){t.success&&t.success(),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}},function(e,t,n){"use strict";var r=n(0),i=n(52);r.YYIMChat.setBackhander({monitor:{pubaccountMonitor:i.monitor},initCallback:{pubaccount:function(e){r.YYIMChat.onPubaccountUpdate=e.onPubaccountUpdate||function(){}}}}),r.YYIMManager.prototype.getPubAccount=function(e){(0,i.getPubAccountItems)(e)},r.YYIMManager.prototype.getPubAccounts=function(e){YYIMUtil.isWhateType(e.ids,"Array")?(0,i.getPubAccounts)(e):e&&e.error&&e.error()};var o,s=new BaseList,a=function(){var t=s;s=new BaseList,(0,i.getPubAccounts)({ids:t.keys(),success:function(e,n){t.forEach(function(e,t){try{e&&e.success&&e.success(n[e.id])}catch(e){r.YYIMChat.log("SuccessHandleBatchPubaccountInfoError.",0,e)}}),t.clear(),t=null},error:function(n){t.forEach(function(e,t){try{e&&e.error&&e.error(n)}catch(e){r.YYIMChat.log("ErrorHandleBatchPubaccountInfoError.",0,e)}}),t.clear(),t=null}})};r.YYIMManager.prototype.getBatchPubInfos=function(e){e&&e.id&&!s.get(e.id)?(s.set(e.id,e),clearTimeout(o),s.length()>=this.getConfig().BETCH_MAXLIMIT.PUBACCOUNT?a():o=setTimeout(function(){a()},200)):e.error&&e.error()},r.YYIMManager.prototype.getPubAccountInfo=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?(0,i.getPubAccountInfo)(e):e&&e.error&&e.error()},r.YYIMManager.prototype.addPubaccount=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?(0,i.addPubAccount)({jid:r.YYIMChat.getJIDUtil().buildPubAccountJID(r.YYIMChat.getJIDUtil().getNode(e.id)),success:e.success,error:e.error}):e&&e.error&&e.error()},r.YYIMManager.prototype.removePubaccount=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?(0,i.removePubAccount)({id:Math.uuid(),to:r.YYIMChat.getJIDUtil().buildPubAccountJID(r.YYIMChat.getJIDUtil().getNode(e.id)),success:e.success,error:e.error}):e&&e.error&&e.error()},r.YYIMManager.prototype.queryPubaccount=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.keyword)?(0,i.queryPubaccount)(e):e&&e.error&&e.error()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryPubaccount=t.removePubAccount=t.getPubAccountInfo=t.getPubAccountItems=t.getPubAccounts=t.addPubAccount=t.monitor=void 0;var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},a=n(0);t.monitor=function(){a.YYIMChat.getConnection().registerHandler(OPCODE.PUBACCOUNT_LIST.KEY,function(e){var t=e.items;if(0!==(t&&t.length||0)){for(var n=[],r=t.length;r--;){var i=t[r];i.id=a.YYIMChat.getJIDUtil().getID(i.jid),n.push(i)}a.YYIMChat.onPubaccountUpdate(n)}})},t.addPubAccount=function(e){a.YYIMChat.getConnection().send(new JumpPacket({type:a.YYIMChat.getConstants().PRESENCE_TYPE.SUBSCRIBE,to:e.jid},OPCODE.PRESENCE.SEND),function(e,t){t.complete&&t.complete(),e.from=a.YYIMChat.getJIDUtil().getID(e.from),e.to=a.YYIMChat.getJIDUtil().getID(e.to),t.success&&t.success(e)},e)},t.getPubAccounts=function(r){jQuery.ajax({url:a.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+a.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+a.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/pubaccount/"+a.YYIMChat.getUserID()+"/items",dataType:"json",data:{token:a.YYIMChat.getToken(),pubIds:(0,o.default)(r.ids)},cache:!1,success:function(e){for(var t={},n=(e=e||[]).length||0;n--;)e[n].id=a.YYIMChat.getJIDUtil().getID(e[n].jid),t[e[n].id]=e[n];r.success&&r.success(e,t),r=null},error:function(e){try{r.error&&r.error(JSON.parse(e.responseText)),r=null}catch(e){r.error&&r.error(),r=null}}})},t.getPubAccountItems=function(e){var t=new JumpPacket({type:a.YYIMChat.getConstants().TYPE.GET,ns:NS_PUBACCOUNT,to:a.YYIMChat.getConfig().DOMAIN.PUBACCOUNT},OPCODE.PUBACCOUNT_LIST.SEND);a.YYIMChat.getConnection().send(t,function(e,t){if(t){t.complete&&t.complete();for(var n=e.items||[],r=n.length||0;r--;)n[r].id=a.YYIMChat.getJIDUtil().getID(n[r].jid);t.success&&t.success((0,o.default)(n))}},e)},t.getPubAccountInfo=function(t){jQuery.ajax({url:a.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+a.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+a.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+t.id+"/"+a.YYIMChat.getUserID()+"/pubaccount/info",dataType:"json",data:{token:a.YYIMChat.getToken()},cache:!1,success:function(e){e&&e.data&&(e.data.id=a.YYIMChat.getJIDUtil().getID(e.data.jid),t.success&&t.success(e.data),t=null)},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.removePubAccount=function(e){a.YYIMChat.getConnection().send(new JumpPacket({id:e.id,type:a.YYIMChat.getConstants().PRESENCE_TYPE.UNSUBSCRIBE,to:e.to},OPCODE.PRESENCE.SEND),function(e,t){t.complete&&t.complete(),e.from=a.YYIMChat.getJIDUtil().getID(e.from),e.to=a.YYIMChat.getJIDUtil().getID(e.to)||a.YYIMChat.getUserID(),t.success&&t.success(e)},e)},t.queryPubaccount=function(e){var t={start:YYIMCommonUtil.isNumber(e.start)?e.start:0,size:YYIMCommonUtil.isNumber(e.size)?e.size:20,fields:["Accountname","Name"],search:e.keyword};a.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.QUERY_PUBACCOUNT.SEND),function(e,t){for(var n=e.items||[],r=[],i=n.length;i--;){var o=n[i],s=o.jid;r.push({id:a.YYIMChat.getJIDUtil().getID(s),name:YYIMCommonUtil.isStringAndNotEmpty(o.name)?o.name:a.YYIMChat.getJIDUtil().getID(s),type:o.type})}t.complete&&t.complete(),t.success&&t.success({start:e.start,total:e.total,items:r})},e)}},function(e,t,n){"use strict";var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},s=n(0),a=n(54);s.YYIMChat.setBackhander({monitor:{rosterMonitor:a.monitor},initCallback:{roster:function(e){s.YYIMChat.onPresence=e.onPresence||function(){},s.YYIMChat.onSubscribe=e.onSubscribe||function(){},s.YYIMChat.onRosterDeleted=e.onRosterDeleted||function(){},s.YYIMChat.onRosterUpdateded=e.onRosterUpdateded||function(){},s.YYIMChat.onRosterFavorited=e.onRosterFavorited||function(){}}}}),s.YYIMManager.prototype.setPresence=function(e){var t={};e&&e.show&&this.getConstants().STATUS[e.show.toUpperCase()]&&(t.show=e.show),e&&e.status&&(t.status=e.status),(0,a.setPresence)(t)},s.YYIMManager.prototype.getVCard=function(e){(e=e||{})?(0,a.getVCard)({id:e.id,success:e.success,error:e.error}):e.error&&e.error()};var c=new BaseList,u=void 0,l=function(){var e=c;c=new BaseList,(0,a.getBatchVCards)({ids:(0,o.default)(e.keys()),success:function(n){e.forEach(function(e,t){try{e&&e.success&&e.success(n[e.id])}catch(e){s.YYIMChat.log("SuccessHandleBatchVCardsError.",0,e)}}),e.clear(),e=null},error:function(n){e.forEach(function(e,t){try{e&&e.error&&e.error(n)}catch(e){s.YYIMChat.log("ErrorHandleBatchVCardsError.",0,e)}}),e.clear(),e=null}})};s.YYIMManager.prototype.getBatchVCards=function(e){e&&e.id&&!c.get(e.id)?(c.set(e.id,e),clearTimeout(u),c.length()>=this.getConfig().BETCH_MAXLIMIT.ROSTER?l():u=setTimeout(function(){l()},200)):e.error&&e.error()},s.YYIMManager.prototype.getVCards=function(e){e?(0,a.getVCards)({success:e.success,error:e.error,complete:e.complete}):e.error&&e.error()},s.YYIMManager.prototype.setVCard=function(e){(0,a.setVCard)({vcard:{nickname:e.nickname,photo:e.photo,email:e.email,mobile:e.mobile,telephone:e.telephone,organization:e.organization,gender:e.gender,number:e.number,remarks:e.remarks,location:e.location,position:e.position},success:e.success,error:e.error})},s.YYIMManager.prototype.setVCardTag=function(t){if(t=t||{},YYIMArrayUtil.isArray(t.tag)){var n=this;(0,a.setTag)({tag:t.tag,success:function(e){n.getVCard({id:e,success:function(e){t.success&&t.success(e)}})},error:t.error})}else t.error&&t.error()},s.YYIMManager.prototype.removeVCardTag=function(t){if(t=t||{},YYIMArrayUtil.isArray(t.tag)){var n=this;(0,a.removeTag)({tag:t.tag,success:function(e){n.getVCard({id:e,success:function(e){t.success&&t.success(e)}})},error:t.error})}else t.error&&t.error()},s.YYIMManager.prototype.setRosterTag=function(t){(t=t||{}).id&&YYIMArrayUtil.isArray(t.tag)&&t.id!=this.getUserID()?(0,a.setTag)({id:t.id,tag:t.tag,success:function(e){t.success&&t.success(e)},error:t.error}):t.error&&t.error()},s.YYIMManager.prototype.removeRosterTag=function(t){(t=t||{}).id&&YYIMArrayUtil.isArray(t.tag)&&t.id!=this.getUserID()?(0,a.removeTag)({id:t.id,tag:t.tag,success:function(e){t.success&&t.success(e)},error:t.error}):t.error&&t.error()},s.YYIMManager.prototype.getRosterItems=function(e){(0,a.getRosterItems)(e)},s.YYIMManager.prototype.addRosterItem=function(e){YYIMCommonUtil.isStringAndNotEmpty(e)&&(0,a.addRosterItem)(s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e)))},s.YYIMManager.prototype.approveSubscribe=function(e){YYIMCommonUtil.isStringAndNotEmpty(e)&&(0,a.approveSubscribe)(s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e)))},s.YYIMManager.prototype.rejectSubscribe=function(e){YYIMCommonUtil.isStringAndNotEmpty(e)&&(0,a.rejectSubscribe)(s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e)))},s.YYIMManager.prototype.deleteRosterItem=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)&&(0,a.deleteRosterItem)({jid:s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e.id)),success:e.success,error:e.error})},s.YYIMManager.prototype.queryRosterItem=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.keyword)&&(0,a.queryRosterItem)(e)},s.YYIMManager.prototype.getRostersPresence=function(e){YYIMArrayUtil.isArray(e.username)&&(e.username=(0,o.default)(e.username),(0,a.getRostersPresence)(e))},s.YYIMManager.prototype.updateRosterItem=function(e){e&&e.roster&&YYIMCommonUtil.isStringAndNotEmpty(e.roster.id)&&(0,a.updateRosterItem)({roster:{jid:s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e.roster.id)),name:e.roster.name,groups:e.roster.groups},success:e.success,error:e.error})},s.YYIMManager.prototype.favoriteRoster=function(e,t){if(YYIMUtil.isWhateType(e,"String")){var n=s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e));t==s.YYIMChat.getConstants().FAVORITE_TYPE.REMOVE?(0,a.cancelFavoriteRoster)(n):(0,a.favoriteRoster)(n)}},s.YYIMManager.prototype.updateFavoriteRoster=function(e,t){if(YYIMUtil.isWhateType(e,"String")&&YYIMUtil.isWhateType(t,"String")){var n=s.YYIMChat.getJIDUtil().buildUserJID(s.YYIMChat.getJIDUtil().getNode(e));(0,a.updateFavoriteRoster)(n,t)}},s.YYIMManager.prototype.getFavoriteRosterList=function(e){e=e||{},(0,a.getFavoriteRosterList)({success:e.success,error:e.error})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeTag=t.setTag=t.getRosterItems=t.getFavoriteRosterList=t.updateFavoriteRoster=t.cancelFavoriteRoster=t.favoriteRoster=t.addRosterItem=t.setVCard=t.getVCards=t.getBatchVCards=t.getVCard=t.setPresence=t.updateRosterItem=t.getRostersPresence=t.queryRosterItem=t.deleteRosterItem=t.rejectSubscribe=t.approveSubscribe=t.monitor=void 0;var r,o=n(1),l=(r=o)&&r.__esModule?r:{default:r},h=n(0);t.monitor=function(){h.YYIMChat.getConnection().registerHandler(OPCODE.FAVORITED_ROSTERT.KEY,function(e){e&&e.favoritedRosterItem&&(e.favoritedRosterItem.id=h.YYIMChat.getJIDUtil().getID(e.favoritedRosterItem.jid)),e&&e.to&&(e.to=h.YYIMChat.getJIDUtil().getID(e.to)),h.YYIMChat.onRosterFavorited(e)}),h.YYIMChat.getConnection().registerHandler(OPCODE.UPDATE_ROSTER.KEY,function(e){var t=e.item,n=h.YYIMChat.getJIDUtil().getID(e.item.jid);"both"===t.subscription?(h.YYIMChat.log("update or add: "+(0,l.default)(t)),t.id=n,h.YYIMChat.onRosterUpdateded(t)):"none"===t.subscription?(h.YYIMChat.log("delete: "+(0,l.default)(t)),t.id=n,h.YYIMChat.onRosterDeleted(t)):t.subscription}),h.YYIMChat.getConnection().registerHandler(OPCODE.PRESENCE.KEY,function(e){if(e.type&&e.type!=h.YYIMChat.getConstants().TYPE.UNAVAILABLE)h.YYIMChat.onSubscribe({from:h.YYIMChat.getJIDUtil().getID(e.from),type:e.type});else{var t={from:h.YYIMChat.getJIDUtil().getID(e.from),resource:h.YYIMChat.getJIDUtil().getResource(e.from),type:e.type,show:e.show,status:e.status};e.type&&e.type==h.YYIMChat.getConstants().TYPE.UNAVAILABLE&&(t.show=h.YYIMChat.getConstants().STATUS.UNAVAILABLE,t.status=h.YYIMChat.getConstants().STATUS.UNAVAILABLE,removeFromOnline(t.from)),YYIMCommonUtil.isStringAndNotEmpty(t.status)||(t.show=h.YYIMChat.getConstants().STATUS.CHAT,t.status=h.YYIMChat.getConstants().STATUS.CHAT),h.YYIMChat.onPresence(t)}})},t.approveSubscribe=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:h.YYIMChat.getConstants().PRESENCE_TYPE.SUBSCRIBED,to:e},OPCODE.PRESENCE.SEND))},t.rejectSubscribe=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:h.YYIMChat.getConstants().PRESENCE_TYPE.UNSUBSCRIBED,to:e},OPCODE.PRESENCE.SEND))},t.deleteRosterItem=function(e){var t={type:h.YYIMChat.getConstants().TYPE.SET,ns:NS_ROSTER,item:{jid:e.jid,subscription:"remove"}};h.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.UPDATE_ROSTER.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(h.YYIMChat.getJIDUtil().getID(t.jid))},e)},t.queryRosterItem=function(e){var t={start:YYIMCommonUtil.isNumber(e.start)?e.start:0,size:YYIMCommonUtil.isNumber(e.size)?e.size:20,fields:["Username","Name"],search:e.keyword};h.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.QUERY_USER.SEND),function(e,t){for(var n=e.items||[],r=[],i=n.length;i--;){var o=n[i],s=o.jid;s!==h.YYIMChat.getUserBareJID()&&r.push({id:h.YYIMChat.getJIDUtil().getID(s),name:YYIMCommonUtil.isStringAndNotEmpty(o.name)?o.name:h.YYIMChat.getJIDUtil().getID(s),photo:o.photo,email:o.email})}t.complete&&t.complete(),t.success&&t.success({start:e.start,total:e.total,items:r})},e)},t.getRostersPresence=function(t){jQuery.ajax({url:h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/presence/detail?token="+h.YYIMChat.getToken()+"&username="+t.username,type:"get",dataType:"json",cache:!1,timeout:5e3,success:function(e){t.success&&t.success(e),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.updateRosterItem=function(e){for(var t=e.roster,n={item:{jid:t.jid,name:t.name,groups:[]}},r=t.groups,i=r?r.length:0;i--&&YYIMCommonUtil.isStringAndNotEmpty(r[i]);)n.item.groups=n.item.groups.concat(r[i]);h.YYIMChat.getConnection().send(new JumpPacket(n,OPCODE.UPDATE_ROSTER.SEND),function(e,t){t.complete&&t.complete(),400===e.code?t.error&&t.error(e):(e.to=h.YYIMChat.getJIDUtil().getID(e.to),t.success&&t.success(e))},e)},t.setPresence=function(e){h.YYIMChat.getConnection().send(new JumpPacket(e,OPCODE.PRESENCE.SEND))},t.getVCard=function(e){var t={type:h.YYIMChat.getConstants().TYPE.GET};e&&e.id&&(t.to=h.YYIMChat.getJIDUtil().buildUserJID(h.YYIMChat.getJIDUtil().getNode(e.id))),h.YYIMChat.getConnection().send(new JumpPacket(t,OPCODE.VCARD.SEND),function(e,t){t.complete&&t.complete();var n=e.vcard||{};n.id=n.userId=h.YYIMChat.getJIDUtil().getID(n.username),e.enableFields&&(n.enableFields=!!e.enableFields),t.success&&t.success(n)},e)},t.getBatchVCards=function(i){var e=h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/vcard?token="+h.YYIMChat.getToken()+"&userids="+i.ids;jQuery.ajax({url:e,type:"get",dataType:"json",cache:!1,success:function(e){var t={};if(e&&e.list)for(var n in e.list)if(e.list.hasOwnProperty(n)){var r=e.list[n];r.id=h.YYIMChat.getJIDUtil().getID(r.username),t[r.id]=r}i.success&&i.success(t),i=null},error:function(e){try{i.error&&i.error(JSON.parse(e.responseText)),i=null}catch(e){i.error&&i.error(),i=null}}})},t.getVCards=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:"roster"},OPCODE.VCARDS.SEND),function(e,t){var n=e.vcards||[];for(vcards=[],i=n.length;i--;){var r=n[i];r.id=r.userId=h.YYIMChat.getJIDUtil().getID(r.username),vcards.push(r)}t.complete&&t.complete(),t.success&&t.success(vcards)},e)},t.setVCard=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:h.YYIMChat.getConstants().TYPE.SET,vcard:e.vcard},OPCODE.VCARD.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success()},e)},t.addRosterItem=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:h.YYIMChat.getConstants().PRESENCE_TYPE.SUBSCRIBE,to:e},OPCODE.PRESENCE.SEND))},t.favoriteRoster=function(e){h.YYIMChat.getConnection().send(new JumpPacket({type:h.YYIMChat.getConstants().PRESENCE_TYPE.COLLECT,to:e},OPCODE.PRESENCE.SEND))},t.cancelFavoriteRoster=function(e){h.YYIMChat.getConnection().send(new JumpPacket({favoritedRosterItem:{jid:e,subscription:h.YYIMChat.getConstants().FAVORITE_TYPE.REMOVE},from:h.YYIMChat.getUserFullJID()},OPCODE.FAVORITED_ROSTERT.SEND))},t.updateFavoriteRoster=function(e,t){h.YYIMChat.getConnection().send(new JumpPacket({favoritedRosterItem:{jid:e,name:t,subscription:h.YYIMChat.getConstants().FAVORITE_TYPE.FAVORITE},from:h.YYIMChat.getUserFullJID()},OPCODE.FAVORITED_ROSTERT.SEND))},t.getFavoriteRosterList=function(n){jQuery.ajax({url:h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/favoritedRosters",type:"get",data:{token:h.YYIMChat.getToken()},dataType:"json",cache:!1,success:function(e){if(e&&e.items)for(var t=e.items.length;t--;)e.items[t].id=h.YYIMChat.getJIDUtil().getID(e.items[t].jid);n.success&&n.success(e.items),n=null},error:function(e){try{n.error&&n.error(JSON.parse(e.responseText)),n=null}catch(e){n.error&&n.error(),n=null}}})},t.getRosterItems=function(e){var t=new JumpPacket({},OPCODE.ROSTER_LIST.SEND);h.YYIMChat.getConnection().send(t,function(e,t){if(t){t.complete&&t.complete();for(var n=e.items||[],r=[],i=n.length||0,o={};i--;){var s=n[i],a=s.jid,c={id:h.YYIMChat.getJIDUtil().getID(a),resource:h.YYIMChat.getJIDUtil().getResource(a),ask:s.ask,recv:s.recv,name:s.name,photo:s.photo,subscription:s.subscription,group:s.groups,tag:s.tag};h.YYIMChat.getJIDUtil().getDomain(a)!==h.YYIMChat.getConfig().DOMAIN.PUBACCOUNT&&(r.push(c),o[c.id]||"none"!==c.subscription||1===c.recv&&(o[c.id]=c))}for(var u in o)o[u].id&&h.YYIMChat.onSubscribe({from:o[u].id,type:h.YYIMChat.getConstants().PRESENCE_TYPE.SUBSCRIBE});t.success&&t.success((0,l.default)(r))}},e)},t.setTag=function(t){var e;e=t.id&&t.id!==h.YYIMChat.getUserID()?h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/"+t.id+"/roster/tag?token="+h.YYIMChat.getToken():h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/vcard/tag?token="+h.YYIMChat.getToken(),jQuery.ajax({url:e,type:"post",data:(0,l.default)({tag:t.tag}),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(e){t.success&&t.success(t.id),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})},t.removeTag=function(t){var e;e=t.id&&t.id!==h.YYIMChat.getUserID()?h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/"+t.id+"/roster/tag?token="+h.YYIMChat.getToken()+"&tag="+(0,l.default)(t.tag):h.YYIMChat.getConfig().SERVLET.REST_USER_SERVLET+h.YYIMChat.getConfig().MULTI_TENANCY.ETP_KEY+"/"+h.YYIMChat.getConfig().MULTI_TENANCY.APP_KEY+"/"+h.YYIMChat.getUserID()+"/vcard/tag?token="+h.YYIMChat.getToken()+"&tag="+(0,l.default)(t.tag),jQuery.ajax({url:e,type:"delete",dataType:"json",cache:!1,success:function(e){t.success&&t.success(t.id),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}},function(e,t,n){"use strict";var r=n(0),i=n(56);r.YYIMManager.prototype.getTodoDigset=function(e){(0,i.getTodoDigset)(e)},r.YYIMManager.prototype.sendToDoReceipts=function(e){(0,i.sendToDoReceipts)(e)},r.YYIMManager.prototype.getHistoryTodo=function(e){(0,i.getHistoryTodo)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendToDoReceipts=t.getHistoryTodo=t.getTodoDigset=void 0;var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r},s=n(0);t.getTodoDigset=function(n){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_TODO_USER+"abstract",type:"get",data:{token:s.YYIMChat.getToken(),userId:s.YYIMChat.getUserID()},dataType:"json",cache:!1,success:function(e){var t;e&&e.result&&e.result.abstractItem&&((t=e.result.abstractItem||{}).todoCount=e.result.todoCount||0,t.unReadCount=e.result.unReadCount||0,t.latestReadTs=e.result.latestReadTs||0),n&&n.success&&n.success(t),n&&(n=null)},error:function(e){try{n&&n.error&&n.error(JSON.parse(e.responseText)),n&&(n=null)}catch(e){n&&n.error&&n.error(),n&&(n=null)}}})},t.getHistoryTodo=function(n){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_TODO_USER+"items",type:"get",data:{token:s.YYIMChat.getToken(),userId:s.YYIMChat.getUserID(),beforeTs:n&&Number(n.beforeTs)||"",todoState:n&&n.todoState||"",pageSize:n&&Number(n.pageSize)||10},dataType:"json",cache:!1,success:function(e){var t=[];e&&e.result&&e.result.length&&(t=e.result),n&&n.success&&n.success(t),n&&(n=null)},error:function(e){try{n&&n.error&&n.error(JSON.parse(e.responseText)),n&&(n=null)}catch(e){n&&n.error&&n.error(),n&&(n=null)}}})},t.sendToDoReceipts=function(t){jQuery.ajax({url:s.YYIMChat.getConfig().SERVLET.REST_TODO_USER+"read/latest?token="+s.YYIMChat.getToken()+"&userId="+s.YYIMChat.getUserID(),type:"post",data:(0,o.default)({latestReadTs:t.latestReadTs||0}),dataType:"json",cache:!1,processData:!1,contentType:"application/json",success:function(){t&&t.success&&t.success(),t&&(t=null)},error:function(e){try{t&&t.error&&t.error(JSON.parse(e.responseText)),t&&(t=null)}catch(e){t&&t.error&&t.error(),t&&(t=null)}}})}},function(e,t,n){"use strict";var r=n(0),i=n(15);n(58),r.YYIMManager.prototype.startUpload=function(e){i.FileUpload.getInstance().start(e)},r.YYIMManager.prototype.cancelUpload=function(e){i.FileUpload.getInstance().end(e)},r.YYIMManager.prototype.getUploadingSize=function(){return i.FileUpload.getInstance().getUploadingSize()},r.YYIMManager.prototype.previewLocalImage=function(t){var e=(t=t||{}).file;if(e&&/image\//.test(e.type)){try{if("image/gif"==e.type){var n=new moxie.file.FileReader;n.onload=function(){t.success&&t.success(n.result),n.destroy(),n=null},n.readAsDataURL(e.getSource())}else{var r=new moxie.image.Image;r.onload=function(){var e="image/jpeg"==r.type?r.getAsDataURL("image/jpeg",80):r.getAsDataURL();t.success&&t.success(e),r.destroy(),r=null},r.load(e.getSource())}}catch(e){t.error&&t.error("Local address parsing errors.")}}else t.error&&t.error("The file isn`t Image.")}},function(e,t,n){"use strict";var r=n(0),a=n(15);r.YYIMManager.getInstance().uploader=function(t,s){s=s||{},"string"==typeof t&&(t=document.getElementById(t)),YYIMUtil.isWhateType(s.chatInfo,"Function")?a.FileUpload.getInstance().init({mediaType:s.mediaType||YYIMChat.getConfig().UPLOAD.MEDIATYPE.DOC,browse_button:t.id,drop_element:s.drop_element},{init:function(e){e.addFile(t),t=null},PostInit:function(e){},Refresh:function(e){},StateChanged:function(e){},UploadFile:function(e,t){},BeforeUpload:function(e,t){var n=e.getOption("chatInfo");if(n){var r=n[t.id];if(r){try{s.beforeUpload&&s.beforeUpload({file:t,chatInfo:r})}catch(e){}var i=e.getOption("mediaType");if(YYIMChat.getConfig().UPLOAD.IMAGE_TYPES.test(t.name)&&(i=1),r.file_data_name&&e.setOption("file_data_name",r.file_data_name),r.required_features&&e.setOption("required_features",r.required_features),1!==i&&r.uploadUrl)e.setOption("url",r.uploadUrl);else{var o=YYIMChat.getJIDUtil().buildUserJID(YYIMChat.getJIDUtil().getNode(r.to));r.type&&r.type==YYIMChat.getConstants().CHAT_TYPE.GROUP_CHAT&&(o=YYIMChat.getJIDUtil().buildChatGroupJID(YYIMChat.getJIDUtil().getNode(r.to))),e.setOption("url",a.FileUpload.getInstance().getBaseUrl()+"?"+jQuery.param({token:YYIMChat.getToken(),name:t.name,mediaType:i,creator:YYIMChat.getUserNode(),receiver:o,type:t.type,size:t.size,original:1}))}}}},QueueChanged:function(e){},OptionChanged:function(e,t,n,r){},UploadProgress:function(e,t){var n,r=e.getOption("chatInfo");r&&(n=r[t.id]),s&&s.progress&&s.progress({uploaded:e.total.uploaded,queued:e.total.queued,bytesPerSec:e.total.bytesPerSec,percent:e.total.percent,size:e.total.size,loaded:e.total.loaded,file:t,chatInfo:n})},FilesAdded:function(e,t){YYIMChat.getConfig().UPLOAD.AUTO_SEND&&e.start()},FilesRemoved:function(e,t){},FileFiltered:function(e,t){var n=s.chatInfo({fileName:t.name});if(n&&n.to)if(!YYIMUtil.isWhateType(n.checkType,"Function")||n.checkType(t.getSource().type)){var r=e.getOption("chatInfo")||{};r[t.id]=n,e.setOption("chatInfo",r),s&&s.fileFiltered&&s.fileFiltered({file:t,chatInfo:n})}else e.removeFile(t),s&&s.error&&s.error({file:t,chatInfo:n,error:"格式不支持"});else e.removeFile(t),s&&s.error&&s.error({file:t,chatInfo:n,error:"请指定接收方"})},FileUploaded:function(e,t,n){if(200===n.status){var r=e.getOption("chatInfo");t&&t.getNative()&&(t.path=t.getNative().path);var i=r[t.id];try{var o=JSON.parse(n.response);0===o.code||o.attachId||o[0]?(delete r[t.id],e.setOption("chatInfo",r),e.removeFile(t),a.FileUpload.getInstance().remove(t.id),s&&s.success&&s.success({data:o,file:t,chatInfo:i})):s&&s.error&&s.error({data:o,file:t,chatInfo:i})}catch(e){s&&s.error&&s.error({data:e.message,file:t,chatInfo:i})}}},ChunkUploaded:function(e,t,n){},UploadComplete:function(e,t){},Error:function(e,t){var n=t.file,r=e.getOption("chatInfo");r&&(t.chatInfo=r[n.id]),s&&s.error&&s.error(t)},Destroy:function(e){}}):s.error&&s.error("chatInfo isn`t Function.")}}]);